[{"createdAt":"2025-06-20T20:37:09.942Z","updatedAt":"2025-06-20T20:37:09.942Z","id":"fuazSRgmbkIXFcJB","name":"My workflow","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[0,0],"id":"10000ee2-deb8-4107-b37e-369b35ccca0e","name":"When clicking ‘Execute workflow’"}],"connections":{},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"6f8659af-1857-4955-bc18-0ecfaeab509b","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-06-20T20:37:09.953Z","updatedAt":"2025-06-20T20:37:09.953Z","role":"workflow:owner","workflowId":"fuazSRgmbkIXFcJB","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-06-20T21:57:02.328Z","updatedAt":"2025-06-21T02:38:41.000Z","id":"XAXAVmv78aOnqSuT","name":"My workflow 2","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[0,0],"id":"f954852c-635b-49c8-bc2e-22a7e5e86d4d","name":"When clicking ‘Execute workflow’"},{"parameters":{"inputText":"a small orange bird with a blue stripe","model":"Xenova/bert-base-NER"},"type":"n8n-nodes-rckflr-ner.namedEntityRecognition","typeVersion":1,"position":[200,280],"id":"665e6522-0ae1-4db8-8964-b02602521cc9","name":"Named Entity Recognition"}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"Named Entity Recognition","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"26f71926-7481-4eb6-96d5-2e137129c33f","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-06-20T21:57:02.351Z","updatedAt":"2025-06-20T21:57:02.351Z","role":"workflow:owner","workflowId":"XAXAVmv78aOnqSuT","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-14T13:47:52.602Z","updatedAt":"2025-07-14T17:50:25.000Z","id":"ZbfpqojcxZphKIv8","name":"My workflow 3","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-560,-180],"id":"600b018e-4c64-447a-a7d1-baecd998f556","name":"When clicking ‘Execute workflow’"},{"parameters":{"url":"https://fcdn.servicehoster.io/ccd882cf-2b37-4ff1-8d0e-6e35a47fcb1a/5f819950-72a9-4222-bb6a-eb23922b656d.pdf","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-320,-180],"id":"1d55d249-615f-472e-8f25-c04e68522324","name":"HTTP Request"},{"parameters":{"operation":"pdf","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-100,-180],"id":"dad18393-3cfc-44fb-b4de-31722c733a06","name":"Extract from File"},{"parameters":{"mode":"insert","tableName":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[120,180],"id":"269046cf-8970-47b4-a69d-971784e79f54","name":"Supabase Vector Store","retryOnFail":true,"credentials":{"supabaseApi":{"id":"BRl9UMltoupMn0uO","name":"Supabase account"}}},{"parameters":{"jsonMode":"expressionData","jsonData":"={{ $json.texto }}","options":{"metadata":{"metadataValues":[{"name":"Title","value":"={{ $('Extract from File').item.json.metadata['dc:title'] }}"},{"name":"Author","value":"={{ $('Extract from File').item.json.metadata['dc:creator'][0] }}"},{"name":"Chapter","value":"={{ $json.numero }}"},{"name":"Abouth","value":"={{ $json.tema }}"}]}}},"type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1.1,"position":[320,360],"id":"8eab8d83-548b-49ef-b779-cddb2b4ec7e4","name":"Default Data Loader"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[140,360],"id":"82b4496c-022e-48f3-b332-c6d54d907bd9","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"89IjBTL65KDWtJ7y","name":"OpenAi account"}}},{"parameters":{"jsCode":"const texto = $input.item.json.textoCompleto || \"\";\n\n// Dividir por la palabra \"Artículo\", pero manteniendo su contenido\nconst bloques = texto.split(/(?=Artículo\\s+\\d+\\.)/g);\n\nconst items = [];\n\nfor (const bloque of bloques) {\n  const textoArticulo = bloque.trim();\n\n  if (!textoArticulo) continue; // Ignorar vacíos\n\n  // Extraer el número del artículo\n  const match = textoArticulo.match(/^Artículo\\s+(\\d+)\\./);\n  const numero = match ? parseInt(match[1]) : null;\n\n  // Asegurarse de que sea realmente un artículo con número\n  if (numero !== null) {\n    items.push({\n      json: {\n        numero,\n        texto: textoArticulo\n      }\n    });\n  }\n}\n\nreturn items;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-600,140],"id":"40dd2e66-4bac-4161-91af-22fabeb4875b","name":"Code"},{"parameters":{"assignments":{"assignments":[{"id":"de7c5849-369b-4069-9360-20e85fe6f91d","name":"text","value":"={{ $json.text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[100,-180],"id":"45bc2850-c1c1-4b58-bb45-4cc2e0541eea","name":"Edit Fields"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-360,140],"id":"d7e9e967-ec25-4b07-a003-8428f1f2214d","name":"Loop Over Items"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1c891c42-1fb9-468d-b75e-f6572f5f0fdf","leftValue":"={{ $json.numero }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-100,160],"id":"21322876-f5f8-4d66-8cb6-eed38806c140","name":"If"},{"parameters":{"content":"## Extraer texto de PDF \n**Extrae el contenido del PDF** [El Arte de la Guerra\n](https://fcdn.servicehoster.io/ccd882cf-2b37-4ff1-8d0e-6e35a47fcb1a/70df6af8-635c-4bc0-9ae8-880af2a83e00.pdf) en texto plano.","height":280,"width":940},"type":"n8n-nodes-base.stickyNote","position":[-640,-280],"typeVersion":1,"id":"58dd360b-6d16-47cf-8d08-003676dc3117","name":"Sticky Note"},{"parameters":{"content":"## Estructura texto \n**Formatea el texto en un Json** con metadata.","height":320,"width":220,"color":6},"type":"n8n-nodes-base.stickyNote","position":[-640,0],"typeVersion":1,"id":"b7f3f558-f95f-416f-bf2a-f943502068ca","name":"Sticky Note1"},{"parameters":{"content":"## Itera por capitulo \n**Divide el texto por capitulo** para genera vectores","height":400,"width":480,"color":7},"type":"n8n-nodes-base.stickyNote","position":[-420,0],"typeVersion":1,"id":"5195be34-4bbf-4fe0-92ad-a5ab3907664e","name":"Sticky Note2"},{"parameters":{"content":"## Embedding \n**Vectoriza y carga en Supabase** texto y metadatos","height":500,"width":400,"color":3},"type":"n8n-nodes-base.stickyNote","position":[60,0],"typeVersion":1,"id":"efc08bc0-77ed-4a89-a6d7-6eff412acf2e","name":"Sticky Note3"}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Supabase Vector Store","type":"ai_document","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]},"Edit Fields":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"If","type":"main","index":0}]]},"Supabase Vector Store":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"If":{"main":[[{"node":"Loop Over Items","type":"main","index":0}],[{"node":"Supabase Vector Store","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"dde0bcc8-9760-45d6-aac5-804651662302","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-14T13:47:52.648Z","updatedAt":"2025-07-14T13:47:52.648Z","role":"workflow:owner","workflowId":"ZbfpqojcxZphKIv8","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-14T13:48:23.057Z","updatedAt":"2025-07-14T13:48:23.057Z","id":"HUohRSLSyFBkh8Di","name":"My workflow 3","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-320,0],"id":"600b018e-4c64-447a-a7d1-baecd998f556","name":"When clicking ‘Execute workflow’"},{"parameters":{"mode":"insert","tableName":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[220,0],"id":"e0f3c71d-d633-4d86-9b0d-34b71bc2dea9","name":"Supabase Vector Store","credentials":{"supabaseApi":{"id":"BRl9UMltoupMn0uO","name":"Supabase account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1.1,"position":[360,220],"id":"80aec40e-ac59-4ac1-9cb4-661ec22e9b07","name":"Default Data Loader"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.embeddingsGoogleGemini","typeVersion":1,"position":[140,220],"id":"edd6560a-a46b-4240-a8f4-c9d56813c9ff","name":"Embeddings Google Gemini","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"operation":"pdf","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-120,0],"id":"7fa38a05-e7db-4a5e-b37c-3b860efe6000","name":"Extract from File"},{"parameters":{"url":"https://fcdn.servicehoster.io/ccd882cf-2b37-4ff1-8d0e-6e35a47fcb1a/70df6af8-635c-4bc0-9ae8-880af2a83e00.pdf","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[100,0],"id":"1d55d249-615f-472e-8f25-c04e68522324","name":"HTTP Request"}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Supabase Vector Store","type":"ai_document","index":0}]]},"Embeddings Google Gemini":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"4faa9a02-2ecf-4ad5-9dcc-e7d8fb517ba6","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-14T13:48:23.191Z","updatedAt":"2025-07-14T13:48:23.191Z","role":"workflow:owner","workflowId":"HUohRSLSyFBkh8Di","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-14T13:48:23.070Z","updatedAt":"2025-07-14T13:48:23.070Z","id":"hnWoi0VpbVvzmaMm","name":"My workflow 3","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-320,0],"id":"600b018e-4c64-447a-a7d1-baecd998f556","name":"When clicking ‘Execute workflow’"},{"parameters":{"mode":"insert","tableName":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[220,0],"id":"e0f3c71d-d633-4d86-9b0d-34b71bc2dea9","name":"Supabase Vector Store","credentials":{"supabaseApi":{"id":"BRl9UMltoupMn0uO","name":"Supabase account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1.1,"position":[360,220],"id":"80aec40e-ac59-4ac1-9cb4-661ec22e9b07","name":"Default Data Loader"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.embeddingsGoogleGemini","typeVersion":1,"position":[140,220],"id":"edd6560a-a46b-4240-a8f4-c9d56813c9ff","name":"Embeddings Google Gemini","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"operation":"pdf","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-120,0],"id":"7fa38a05-e7db-4a5e-b37c-3b860efe6000","name":"Extract from File"},{"parameters":{"url":"https://fcdn.servicehoster.io/ccd882cf-2b37-4ff1-8d0e-6e35a47fcb1a/70df6af8-635c-4bc0-9ae8-880af2a83e00.pdf","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[100,0],"id":"1d55d249-615f-472e-8f25-c04e68522324","name":"HTTP Request"}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Supabase Vector Store","type":"ai_document","index":0}]]},"Embeddings Google Gemini":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"e3bb0b08-31d4-469d-9281-e7c4fbc3f44d","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-14T13:48:23.191Z","updatedAt":"2025-07-14T13:48:23.191Z","role":"workflow:owner","workflowId":"hnWoi0VpbVvzmaMm","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-14T13:48:23.074Z","updatedAt":"2025-07-14T13:48:23.074Z","id":"YfSfPmdaDv2vACnJ","name":"My workflow 3","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-320,0],"id":"600b018e-4c64-447a-a7d1-baecd998f556","name":"When clicking ‘Execute workflow’"},{"parameters":{"mode":"insert","tableName":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[220,0],"id":"e0f3c71d-d633-4d86-9b0d-34b71bc2dea9","name":"Supabase Vector Store","credentials":{"supabaseApi":{"id":"BRl9UMltoupMn0uO","name":"Supabase account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1.1,"position":[360,220],"id":"80aec40e-ac59-4ac1-9cb4-661ec22e9b07","name":"Default Data Loader"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.embeddingsGoogleGemini","typeVersion":1,"position":[140,220],"id":"edd6560a-a46b-4240-a8f4-c9d56813c9ff","name":"Embeddings Google Gemini","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"operation":"pdf","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-120,0],"id":"7fa38a05-e7db-4a5e-b37c-3b860efe6000","name":"Extract from File"},{"parameters":{"url":"https://fcdn.servicehoster.io/ccd882cf-2b37-4ff1-8d0e-6e35a47fcb1a/70df6af8-635c-4bc0-9ae8-880af2a83e00.pdf","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[100,0],"id":"1d55d249-615f-472e-8f25-c04e68522324","name":"HTTP Request"}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Supabase Vector Store","type":"ai_document","index":0}]]},"Embeddings Google Gemini":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"b3d9dce1-dc5d-4db2-8921-775de05f19f5","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-14T13:48:23.194Z","updatedAt":"2025-07-14T13:48:23.194Z","role":"workflow:owner","workflowId":"YfSfPmdaDv2vACnJ","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-14T18:00:58.763Z","updatedAt":"2025-07-14T18:00:58.763Z","id":"lZwT7kXpeqeEwKkE","name":"My workflow 4","active":false,"isArchived":false,"nodes":[{"parameters":{},"id":"c2c7b218-2f14-4348-a25a-0fa16239de2d","name":"File Ref","type":"n8n-nodes-base.noOp","position":[-1060,260],"typeVersion":1},{"parameters":{"respondWith":"json","responseBody":"={{\n{\n  \"error\": null,\n  \"meta\": {\n    \"hash\": $('Get File Hash').first().json.data,\n  },\n  \"result\": $json.response\n}\n}}","options":{"responseCode":200,"responseHeaders":{"entries":[{"name":"Content-Type","value":"application/json"}]}}},"id":"176d34e7-2989-4247-bf69-81e979f287e9","name":"Success1","type":"n8n-nodes-base.respondToWebhook","position":[920,-40],"typeVersion":1.1,"onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"a277fc5c-6873-49d5-b67b-39df0efc8a61","operator":{"type":"number","operation":"lte"},"leftValue":"={{ $('Get Filesize').item.json.filesize_in_bytes }}","rightValue":"={{ 10000000 }}"},{"id":"d908d5a9-3550-45ce-8645-19c08d3e5982","operator":{"type":"number","operation":"lte"},"leftValue":"={{ $json.numpages }}","rightValue":20}]},"options":{}},"id":"479a3145-da28-4a2c-a57f-cb478c03cfba","name":"Is Valid File?","type":"n8n-nodes-base.if","position":[-360,260],"typeVersion":2.2},{"parameters":{"mode":"runOnceForEachItem","jsCode":"function convertToBytes(size) {\n    const units = {\n        b: 1,\n        bytes: 1,\n        kb: 1024,\n        mb: 1024 * 1024,\n        gb: 1024 * 1024 * 1024,\n    };\n\n    // Extract the number and unit using regex\n    const regex = /([\\d.]+)\\s*(bytes|b|kb|mb|gb)/i;\n    const match = size.match(regex);\n\n    if (!match) {\n        throw new Error(`Invalid size format: \"${size}\"`);\n    }\n\n    const value = parseFloat(match[1]);\n    const unit = match[2].toLowerCase();\n\n    // Calculate the size in bytes\n    const factor = units[unit];\n    if (!factor) {\n        throw new Error(`Unsupported unit: \"${unit}\"`);\n    }\n\n    return Math.round(value * factor);\n}\n\nconst data = $('File Ref').first().binary.data;\n\nreturn {\n  json: { filesize_in_bytes: convertToBytes(data.fileSize) },\n  binary: { data }\n}"},"id":"8f64e83c-b210-49eb-8f4a-892595b157da","name":"Get Filesize","type":"n8n-nodes-base.code","position":[-680,260],"typeVersion":2},{"parameters":{"operation":"pdf","options":{}},"id":"073034f9-552c-43da-9fac-80e1504f8124","name":"Extract from File","type":"n8n-nodes-base.extractFromFile","position":[-520,260],"typeVersion":1},{"parameters":{"content":"### 2. Validate PDF File\nWe need to add validation here to meet service limits of our LLM. Here, we need to get for filesize and number of pages. ","height":480,"width":720,"color":7},"id":"e54fdbf7-82ea-413e-a11e-49b224da24f9","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[-740,120],"typeVersion":1},{"parameters":{"content":"### 3. Document Parsing with Gemini API \nGoogle Gemini is used to breakdown the PDF into topics and provide insights for each. The number of topics and insights are not set and can be variable.","height":480,"width":600,"color":7},"id":"59d10f65-09d3-4370-b65f-522fec15628d","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[20,-140],"typeVersion":1},{"parameters":{"content":"### 5. Format Response\nFinally, we'll format the output to return the summary as markdown.","height":280,"width":480,"color":7},"id":"477ec620-6b50-4d78-afde-39782e88f743","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","position":[640,-140],"typeVersion":1},{"parameters":{"text":"=Document as follows:\n{{ $json.text }}","schemaType":"manual","inputSchema":"{\n  \"type\": \"array\",\n  \"items\": {\n    \"type\": \"object\",\n     \"properties\": {\n       \"topic\": { \"type\": \"string\" },\n       \"insights\": {\n         \"type\": \"array\",\n         \"items\": {\n           \"type\": \"object\",\n           \"properties\": {\n             \"title\": { \"type\": \"string\" },\n             \"body\": { \"type\": \"string\" }\n           }\n         }\n       }\n     }\n  }\n}","options":{"systemPromptTemplate":"You are a note-taking agent helping the user to summarise this PDF in note form. Breakdown the document into distinct topics and provide a 3 paragraph summary of each topic discussed in the document."}},"id":"473d248d-ff73-4bce-8d33-1648c06cc122","name":"Information Extractor","type":"@n8n/n8n-nodes-langchain.informationExtractor","position":[120,20],"typeVersion":1,"onError":"continueErrorOutput"},{"parameters":{"assignments":{"assignments":[{"id":"10335d9e-7e0a-4ee1-a275-71d2f75b6bba","name":"response","type":"string","value":"={{\n$json.output.map(item => {\nreturn\n`## ${item.topic}\n${item.insights.map(insight =>\n`- **${insight.title}**: ${insight.body}`\n).join('\\n')}\n`;\n}).join('\\n\\n');\n}}"}]},"options":{}},"id":"7f12ab13-12d5-40b5-a61a-8c18793752df","name":"Format Response","type":"n8n-nodes-base.set","position":[740,-40],"typeVersion":3.4},{"parameters":{"respondWith":"json","responseBody":"{\n  \"error\": \"Unable to parse document. Please ensure file is less than 10mb with maximum of 20 pages.\",\n  \"result\": []\n}","options":{"responseCode":400}},"id":"3f555b03-8916-4713-8432-bf9b9efebd39","name":"400 Error","type":"n8n-nodes-base.respondToWebhook","position":[-180,420],"typeVersion":1.1},{"parameters":{"respondWith":"json","responseBody":"{\n  \"error\": \"Unable to parse document. An unknown error occurred.\",\n  \"result\": []\n}","options":{"responseCode":500}},"id":"c3db8c9f-7c01-4a16-8372-24ae189179d6","name":"500 Error","type":"n8n-nodes-base.respondToWebhook","position":[440,100],"typeVersion":1.1},{"parameters":{"content":"### POST /ai_pdf_summariser\nCall this endpoint to upload a document for summarising.","height":100,"width":280},"id":"91a77bb2-d0e0-45a5-8429-62cdc9a8aeff","name":"Sticky Note9","type":"n8n-nodes-base.stickyNote","position":[-1380,120],"typeVersion":1},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"id":"f3d5efbe-0263-4185-b757-464e4fa2bc11","name":"OpenAI Chat Model1","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[200,200],"typeVersion":1.2,"credentials":{"openAiApi":{"id":"89IjBTL65KDWtJ7y","name":"OpenAi account"}}},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-1520,260],"id":"24271004-b057-46bf-9de9-c611f6bfdd62","name":"When clicking ‘Execute workflow’"},{"parameters":{"url":"https://fcdn.servicehoster.io/ccd882cf-2b37-4ff1-8d0e-6e35a47fcb1a/70df6af8-635c-4bc0-9ae8-880af2a83e00.pdf","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1280,260],"id":"1efc9ba1-420d-45f0-baa6-d11a2a688c00","name":"HTTP Request"}],"connections":{"File Ref":{"main":[[{"node":"Get Filesize","type":"main","index":0}]]},"Get Filesize":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Is Valid File?":{"main":[[{"node":"Information Extractor","type":"main","index":0}],[{"node":"400 Error","type":"main","index":0}]]},"Format Response":{"main":[[{"node":"Success1","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"Is Valid File?","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Information Extractor","type":"ai_languageModel","index":0}]]},"Information Extractor":{"main":[[{"node":"Format Response","type":"main","index":0}],[{"node":"500 Error","type":"main","index":0}]]},"When clicking ‘Execute workflow’":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"File Ref","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"885d4518-b2a3-4702-94e4-d17e6e3bd15f","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-14T18:00:58.780Z","updatedAt":"2025-07-14T18:00:58.780Z","role":"workflow:owner","workflowId":"lZwT7kXpeqeEwKkE","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-14T18:01:02.503Z","updatedAt":"2025-07-14T18:02:31.000Z","id":"reM5w14hMT0wBMA6","name":"My workflow 4","active":false,"isArchived":false,"nodes":[{"parameters":{"respondWith":"json","responseBody":"={{\n{\n  \"error\": null,\n  \"meta\": {\n    \"hash\": $('Get File Hash').first().json.data,\n  },\n  \"result\": $json.response\n}\n}}","options":{"responseCode":200,"responseHeaders":{"entries":[{"name":"Content-Type","value":"application/json"}]}}},"id":"176d34e7-2989-4247-bf69-81e979f287e9","name":"Success1","type":"n8n-nodes-base.respondToWebhook","position":[920,-40],"typeVersion":1.1,"onError":"continueRegularOutput"},{"parameters":{"operation":"pdf","options":{}},"id":"073034f9-552c-43da-9fac-80e1504f8124","name":"Extract from File","type":"n8n-nodes-base.extractFromFile","position":[-520,260],"typeVersion":1},{"parameters":{"content":"### 2. Validate PDF File\nWe need to add validation here to meet service limits of our LLM. Here, we need to get for filesize and number of pages. ","height":480,"width":720,"color":7},"id":"e54fdbf7-82ea-413e-a11e-49b224da24f9","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[-740,120],"typeVersion":1},{"parameters":{"content":"### 3. Document Parsing with Gemini API \nGoogle Gemini is used to breakdown the PDF into topics and provide insights for each. The number of topics and insights are not set and can be variable.","height":480,"width":600,"color":7},"id":"59d10f65-09d3-4370-b65f-522fec15628d","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[20,-140],"typeVersion":1},{"parameters":{"content":"### 5. Format Response\nFinally, we'll format the output to return the summary as markdown.","height":280,"width":480,"color":7},"id":"477ec620-6b50-4d78-afde-39782e88f743","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","position":[640,-140],"typeVersion":1},{"parameters":{"text":"=Document as follows:\n{{ $json.text }}","schemaType":"manual","inputSchema":"{\n  \"type\": \"array\",\n  \"items\": {\n    \"type\": \"object\",\n     \"properties\": {\n       \"topic\": { \"type\": \"string\" },\n       \"insights\": {\n         \"type\": \"array\",\n         \"items\": {\n           \"type\": \"object\",\n           \"properties\": {\n             \"title\": { \"type\": \"string\" },\n             \"body\": { \"type\": \"string\" }\n           }\n         }\n       }\n     }\n  }\n}","options":{"systemPromptTemplate":"You are a note-taking agent helping the user to summarise this PDF in note form. Breakdown the document into distinct topics and provide a 3 paragraph summary of each topic discussed in the document."}},"id":"473d248d-ff73-4bce-8d33-1648c06cc122","name":"Information Extractor","type":"@n8n/n8n-nodes-langchain.informationExtractor","position":[120,20],"typeVersion":1,"onError":"continueErrorOutput"},{"parameters":{"assignments":{"assignments":[{"id":"10335d9e-7e0a-4ee1-a275-71d2f75b6bba","name":"response","type":"string","value":"={{\n$json.output.map(item => {\nreturn\n`## ${item.topic}\n${item.insights.map(insight =>\n`- **${insight.title}**: ${insight.body}`\n).join('\\n')}\n`;\n}).join('\\n\\n');\n}}"}]},"options":{}},"id":"7f12ab13-12d5-40b5-a61a-8c18793752df","name":"Format Response","type":"n8n-nodes-base.set","position":[740,-40],"typeVersion":3.4},{"parameters":{"respondWith":"json","responseBody":"{\n  \"error\": \"Unable to parse document. Please ensure file is less than 10mb with maximum of 20 pages.\",\n  \"result\": []\n}","options":{"responseCode":400}},"id":"3f555b03-8916-4713-8432-bf9b9efebd39","name":"400 Error","type":"n8n-nodes-base.respondToWebhook","position":[-180,420],"typeVersion":1.1},{"parameters":{"respondWith":"json","responseBody":"{\n  \"error\": \"Unable to parse document. An unknown error occurred.\",\n  \"result\": []\n}","options":{"responseCode":500}},"id":"c3db8c9f-7c01-4a16-8372-24ae189179d6","name":"500 Error","type":"n8n-nodes-base.respondToWebhook","position":[440,100],"typeVersion":1.1},{"parameters":{"content":"### POST /ai_pdf_summariser\nCall this endpoint to upload a document for summarising.","height":100,"width":280},"id":"91a77bb2-d0e0-45a5-8429-62cdc9a8aeff","name":"Sticky Note9","type":"n8n-nodes-base.stickyNote","position":[-1380,120],"typeVersion":1},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"id":"f3d5efbe-0263-4185-b757-464e4fa2bc11","name":"OpenAI Chat Model1","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[200,200],"typeVersion":1.2,"credentials":{"openAiApi":{"id":"89IjBTL65KDWtJ7y","name":"OpenAi account"}}},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-1520,260],"id":"24271004-b057-46bf-9de9-c611f6bfdd62","name":"When clicking ‘Execute workflow’"},{"parameters":{"url":"https://fcdn.servicehoster.io/ccd882cf-2b37-4ff1-8d0e-6e35a47fcb1a/70df6af8-635c-4bc0-9ae8-880af2a83e00.pdf","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1280,260],"id":"1efc9ba1-420d-45f0-baa6-d11a2a688c00","name":"HTTP Request"}],"connections":{"Format Response":{"main":[[{"node":"Success1","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"Information Extractor","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Information Extractor","type":"ai_languageModel","index":0}]]},"Information Extractor":{"main":[[{"node":"Format Response","type":"main","index":0}],[{"node":"500 Error","type":"main","index":0}]]},"When clicking ‘Execute workflow’":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Extract from File","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"68ccd6c7-dbee-4ce3-9ac5-f13acb7e09ea","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-14T18:01:02.513Z","updatedAt":"2025-07-14T18:01:02.513Z","role":"workflow:owner","workflowId":"reM5w14hMT0wBMA6","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-18T07:02:09.452Z","updatedAt":"2025-07-18T08:13:44.000Z","id":"C40GCk8y5omz8d1l","name":"My workflow 5","active":false,"isArchived":true,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[0,0],"id":"0108e2e4-a81e-42b1-a0f2-406d38bc58f0","name":"When clicking ‘Execute workflow’"},{"parameters":{"formTitle":"PDF","options":{}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[220,0],"id":"7f5ff8ee-02cd-4a3c-9162-985e786f8d6d","name":"On form submission","webhookId":"e1c172a0-3f9e-4855-97be-d99f831e3879"}],"connections":{"When clicking ‘Execute workflow’":{"main":[[]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"557e7dc5-e2a4-4e71-8a1f-7cd06d0d44ec","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-18T07:02:09.906Z","updatedAt":"2025-07-18T07:02:09.906Z","role":"workflow:owner","workflowId":"C40GCk8y5omz8d1l","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-18T07:02:21.655Z","updatedAt":"2025-07-23T01:34:50.000Z","id":"UomHUPKdLm9xk8Mf","name":"Check Data Extractor","active":false,"isArchived":false,"nodes":[{"parameters":{"formTitle":"PDF","formFields":{"values":[{"fieldLabel":"Archivo","fieldType":"file","acceptFileTypes":".pdf","requiredField":true}]},"options":{"appendAttribution":false}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[-260,-20],"id":"ff69b6ac-422d-498f-a21a-9b0b6b68525b","name":"On form submission","webhookId":"96d75070-c2ad-40a7-8045-e354ce2bb579"},{"parameters":{"operation":"pdf","binaryPropertyName":"Archivo","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-260,-220],"id":"c719e311-16b2-47b9-962a-a45d07fe40f7","name":"Extract from File","retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{"text":"={{ $json.text }}","schemaType":"fromJson","jsonSchemaExample":"{\n  \"emisor\": {\n    \"nombre\": \"ILS SERVICIOS LOGISTICOS\",\n    \"rfc\": \"ISL011017B7A\",\n    \"regimen_fiscal\": \"601 - General de Ley Personas Morales\"\n  },\n  \"receptor\": {\n    \"nombre\": \"MAURICIO JAVIER PERERA GONZALVEZ\",\n    \"rfc\": \"PEGM880601841\",\n    \"uso_cfdi\": \"G03 - Gastos en general\"\n  },\n  \"factura\": {\n    \"uuid\": \"BBD06928-A8B4-4BB7-A6A4-A970B3972803\",\n    \"fecha_emision\": \"2025-07-15T21:45:07\",\n    \"lugar_expedicion\": \"76150\",\n    \"forma_pago\": \"03\",\n    \"metodo_pago\": \"PUE\",\n    \"moneda\": \"MXN\"\n  },\n  \"conceptos\": [\n    {\n      \"cantidad\": 1,\n      \"unidad\": \"E48 - Unidad de servicio\",\n      \"descripcion\": \"Servicios de internet\",\n      \"precio_unitario\": 7500.00,\n      \"importe\": 7500.00,\n      \"impuestos\": {\n        \"tipo\": \"002 IVA\",\n        \"base\": 7500.00,\n        \"tasa\": 0.16,\n        \"importe\": 1200.00\n      }\n    }\n  ],\n  \"totales\": {\n    \"subtotal\": 7500.00,\n    \"iva\": 1200.00,\n    \"total\": 8700.00\n  }\n}\n","options":{"systemPromptTemplate":"You are an expert extraction algorithm.\nOnly extract relevant information from the text.\nIf you do not know the value of an attribute asked to extract, you may omit the attribute's value."}},"type":"@n8n/n8n-nodes-langchain.informationExtractor","typeVersion":1.2,"position":[-60,-220],"id":"410b3598-bbfd-45cf-90a4-c247c0a22a11","name":"Information Extractor"},{"parameters":{"modelName":"models/gemini-2.0-flash","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-60,0],"id":"57bc2ca1-5a31-4561-a442-2d931df1f734","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}}],"connections":{"On form submission":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"Information Extractor","type":"main","index":0}]]},"Information Extractor":{"main":[[]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"Information Extractor","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"On form submission":[{"json":{"Archivo":[{"filename":"factura_dummy_2.pdf","mimetype":"application/pdf","size":1854}],"submittedAt":"2025-07-22T21:32:03.817-04:00","formMode":"test"}}]},"versionId":"a2224dc6-103d-4605-8b32-77939ec24c1c","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-18T07:02:23.254Z","updatedAt":"2025-07-18T07:02:23.254Z","role":"workflow:owner","workflowId":"UomHUPKdLm9xk8Mf","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-18T08:14:07.139Z","updatedAt":"2025-07-18T08:53:48.000Z","id":"WaymTHP6JJUr5wLh","name":"Multiple Check Data Extractor","active":false,"isArchived":false,"nodes":[{"parameters":{"formTitle":"PDF","formFields":{"values":[{"fieldLabel":"Archivo","fieldType":"file","acceptFileTypes":".pdf","requiredField":true}]},"options":{"appendAttribution":false}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[-780,-420],"id":"f866ddc3-d472-496d-ba4f-f01a2c02579b","name":"On form submission","webhookId":"96d75070-c2ad-40a7-8045-e354ce2bb579"},{"parameters":{"operation":"pdf","binaryPropertyName":"file","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-820,-740],"id":"b3023ad2-a3bb-4590-a63a-ccf5edcad4e7","name":"Extract from File","retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{"text":"={{ $json.text }}","schemaType":"fromJson","jsonSchemaExample":"{\n  \"emisor\": {\n    \"nombre\": \"ILS SERVICIOS LOGISTICOS\",\n    \"rfc\": \"ISL011017B7A\",\n    \"regimen_fiscal\": \"601 - General de Ley Personas Morales\"\n  },\n  \"receptor\": {\n    \"nombre\": \"MAURICIO JAVIER PERERA GONZALVEZ\",\n    \"rfc\": \"PEGM880601841\",\n    \"uso_cfdi\": \"G03 - Gastos en general\"\n  },\n  \"factura\": {\n    \"uuid\": \"BBD06928-A8B4-4BB7-A6A4-A970B3972803\",\n    \"fecha_emision\": \"2025-07-15T21:45:07\",\n    \"lugar_expedicion\": \"76150\",\n    \"forma_pago\": \"03\",\n    \"metodo_pago\": \"PUE\",\n    \"moneda\": \"MXN\"\n  },\n  \"conceptos\": [\n    {\n      \"cantidad\": 1,\n      \"unidad\": \"E48 - Unidad de servicio\",\n      \"descripcion\": \"Servicios de internet\",\n      \"precio_unitario\": 7500.00,\n      \"importe\": 7500.00,\n      \"impuestos\": {\n        \"tipo\": \"002 IVA\",\n        \"base\": 7500.00,\n        \"tasa\": 0.16,\n        \"importe\": 1200.00\n      }\n    }\n  ],\n  \"totales\": {\n    \"subtotal\": 7500.00,\n    \"iva\": 1200.00,\n    \"total\": 8700.00\n  }\n}\n","options":{"systemPromptTemplate":"You are an expert extraction algorithm.\nOnly extract relevant information from the text.\nIf you do not know the value of an attribute asked to extract, you may omit the attribute's value."}},"type":"@n8n/n8n-nodes-langchain.informationExtractor","typeVersion":1.2,"position":[-620,-740],"id":"0b9f10bc-6aac-4cfa-a33a-a3b8067067cb","name":"Information Extractor"},{"parameters":{"modelName":"models/gemini-2.5-flash","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-600,-560],"id":"12d3e039-26af-40b6-9835-3aa6c970d1b5","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"options":{"reset":false}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-240,-420],"id":"2b466c51-53ae-4eb8-abf0-799b2f0c2a88","name":"Loop Over Items","notesInFlow":false,"alwaysOutputData":false},{"parameters":{"jsCode":"// items[0] es el único ítem que contiene múltiples archivos en .binary\nconst incoming = items[0];\n// obtenemos todas las keys de archivos subidos\nconst fileKeys = Object.keys(incoming.binary);\n\n// por cada key devolvemos un nuevo ítem con un solo archivo bajo .binary.file\nconst newItems = fileKeys.map(key => ({\n  json: incoming.json,               // si traías datos JSON, los copias\n  binary: { file: incoming.binary[key] }  // cada uno con .binary.file\n}));\n\nreturn newItems;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-560,-420],"id":"e6d646f2-a03a-49ed-94e3-3f189abcff72","name":"Code"}],"connections":{"On form submission":{"main":[[{"node":"Code","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"Information Extractor","type":"main","index":0}]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"Information Extractor","type":"ai_languageModel","index":0}]]},"Information Extractor":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Extract from File","type":"main","index":0}]]},"Code":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"e87e2025-840e-4af0-90ed-c861c5aea488","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-18T08:14:07.521Z","updatedAt":"2025-07-18T08:14:07.521Z","role":"workflow:owner","workflowId":"WaymTHP6JJUr5wLh","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-18T08:42:30.521Z","updatedAt":"2025-07-18T09:26:09.000Z","id":"F4srUoaK48xKcTOk","name":"Check to text","active":false,"isArchived":false,"nodes":[{"parameters":{"formTitle":"Contabilidad","formFields":{"values":[{"fieldLabel":"Archivo","fieldType":"file","multipleFiles":false,"acceptFileTypes":".pdf","requiredField":true}]},"responseMode":"lastNode","options":{"appendAttribution":false,"path":"facturas","respondWithOptions":{"values":{"formSubmittedText":"Factura cargada"}}}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[-300,-300],"id":"eaf4d2c5-62be-4b87-94aa-6c9d755f3f2a","name":"On form submission","webhookId":"da3caf18-7d47-4784-8e59-0d08d22cff4c"},{"parameters":{"operation":"pdf","binaryPropertyName":"Archivo","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-80,-300],"id":"963c13fc-3330-4c79-bbd2-813a731505d1","name":"Extract from File"}],"connections":{"On form submission":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Extract from File":{"main":[[]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"8c2325cc-43fc-4f42-8efa-40c8b0c3e340","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-18T08:42:30.554Z","updatedAt":"2025-07-18T08:42:30.554Z","role":"workflow:owner","workflowId":"F4srUoaK48xKcTOk","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-18T08:45:35.822Z","updatedAt":"2025-07-18T11:36:46.000Z","id":"q0iP2LtP5nmTX314","name":"Check Data Extractor to supabase","active":false,"isArchived":false,"nodes":[{"parameters":{"formTitle":"PDF","formFields":{"values":[{"fieldLabel":"Archivo","fieldType":"file","acceptFileTypes":".pdf","requiredField":true}]},"options":{"appendAttribution":false}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[-300,-300],"id":"c5365264-fb7a-4f2d-8adb-0c0361fe895e","name":"On form submission","webhookId":"053b0125-0a08-47dc-a75c-bb3f55c441dc"},{"parameters":{"operation":"pdf","binaryPropertyName":"Archivo","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-80,-300],"id":"547a9979-2b9e-4b8c-ae91-e19c79e55cd3","name":"Extract from File"},{"parameters":{"text":"={{ $json.text }}","schemaType":"fromJson","jsonSchemaExample":"{\n  \"emisor\": {\n    \"nombre\": \"ILS SERVICIOS LOGISTICOS\",\n    \"rfc\": \"ISL011017B7A\",\n    \"regimen_fiscal\": \"601 - General de Ley Personas Morales\"\n  },\n  \"receptor\": {\n    \"nombre\": \"MAURICIO JAVIER PERERA GONZALVEZ\",\n    \"rfc\": \"PEGM880601841\",\n    \"regimen_fiscal\": \"612 - Personas Físicas con Actividades Empresariales y Profesionales\",\n    \"uso_cfdi\": \"G03 - Gastos en general\",\n    \"domicilio_fiscal\": \"85457\"\n  },\n  \"factura\": {\n    \"uuid\": \"BBD06928-A8B4-4BB7-A6A4-A970B3972803\",\n    \"serie_certificado_sat\": \"00001000000516053874\",\n    \"serie_certificado_emisor\": \"00001000000707822514\",\n    \"fecha_certificacion\": \"2025-07-15T21:51:32\",\n    \"fecha_emision\": \"2025-07-15T21:45:07\",\n    \"lugar_expedicion\": \"76150\",\n    \"tipo_comprobante\": \"I\",\n    \"forma_pago\": \"03\",\n    \"metodo_pago\": \"PUE\",\n    \"moneda\": \"MXN\"\n  },\n  \"conceptos\": [\n    {\n      \"cantidad\": 1,\n      \"unidad\": \"E48 - Unidad de servicio\",\n      \"descripcion\": \"Servicios de internet\",\n      \"clave_producto_servicio\": \"81112100\",\n      \"precio_unitario\": 7500.00,\n      \"importe\": 7500.00,\n      \"impuestos\": {\n        \"tipo\": \"002 IVA\",\n        \"base\": 7500.00,\n        \"tasa\": 0.16,\n        \"importe\": 1200.00\n      }\n    }\n  ],\n  \"totales\": {\n    \"subtotal\": 7500.00,\n    \"iva\": 1200.00,\n    \"total\": 8700.00,\n    \"total_letra\": \"Ocho mil setecientos pesos 00/100 MXN\"\n  }\n}\n","options":{"systemPromptTemplate":"You are an expert extraction algorithm.\nOnly extract relevant information from the text.\nIf you do not know the value of an attribute asked to extract, you may omit the attribute's value."}},"type":"@n8n/n8n-nodes-langchain.informationExtractor","typeVersion":1.2,"position":[140,-300],"id":"03232a3f-0b32-4177-aaba-6dd771181dda","name":"Information Extractor"},{"parameters":{"modelName":"models/gemini-2.5-flash","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[140,-120],"id":"769e5c4c-e4d3-4cb7-bcb7-4c6f1edc4fa3","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"mode":"insert","tableName":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[500,-300],"id":"a7887337-aa12-47cb-86b1-27bee9e7413d","name":"Supabase Vector Store","credentials":{"supabaseApi":{"id":"gbJXO6tFvKk1P043","name":"Supabase account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[420,-80],"id":"b12832ce-4480-4cea-af69-2e1160f0eba5","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"89IjBTL65KDWtJ7y","name":"OpenAi account"}}},{"parameters":{"jsonMode":"expressionData","jsonData":"={{ $json.output.conceptos[0].descripcion }}","options":{"metadata":{"metadataValues":[{"name":"emisor","value":"={{ $json.output.emisor }}"},{"name":"receptor","value":"={{ $json.output.receptor }}"},{"name":"fecha_emision","value":"={{ $json.output.factura.fecha_emision }}"},{"name":"forma_pago","value":"={{ $json.output.factura.metodo_pago }}"},{"name":"moneda","value":"={{ $json.output.factura.moneda }}"},{"name":"subtotal","value":"={{ $json.output.totales.subtotal }}"},{"name":"total","value":"={{ $json.output.totales.total }}"}]}}},"type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1.1,"position":[600,-60],"id":"1e28cccf-8807-4acf-bda9-d308c322354f","name":"Default Data Loader"}],"connections":{"On form submission":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"Information Extractor","type":"main","index":0}]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"Information Extractor","type":"ai_languageModel","index":0}]]},"Information Extractor":{"main":[[{"node":"Supabase Vector Store","type":"main","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Supabase Vector Store","type":"ai_document","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"244c7379-c8f8-4adc-84c7-4baea9e8a522","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-18T08:45:35.906Z","updatedAt":"2025-07-18T08:45:35.906Z","role":"workflow:owner","workflowId":"q0iP2LtP5nmTX314","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-18T08:49:06.560Z","updatedAt":"2025-07-18T11:42:10.000Z","id":"gcpCG3bGB219TpU3","name":"Multiple Check Data Extractor to supabase","active":false,"isArchived":false,"nodes":[{"parameters":{"formTitle":"PDF","formFields":{"values":[{"fieldLabel":"Archivo","fieldType":"file","acceptFileTypes":".pdf","requiredField":true}]},"options":{"appendAttribution":false}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[-780,-420],"id":"ac77653f-5503-4a1d-ade2-1d8d1426922b","name":"On form submission","webhookId":"979ed948-4a3b-4349-bab5-67388bc03040"},{"parameters":{"operation":"pdf","binaryPropertyName":"file","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-1260,-180],"id":"92584d05-409f-4965-ab21-373afcfdfe9b","name":"Extract from File","retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{"text":"={{ $json.text }}","schemaType":"fromJson","jsonSchemaExample":"{\n  \"emisor\": {\n    \"nombre\": \"ILS SERVICIOS LOGISTICOS\",\n    \"rfc\": \"ISL011017B7A\",\n    \"regimen_fiscal\": \"601 - General de Ley Personas Morales\"\n  },\n  \"receptor\": {\n    \"nombre\": \"MAURICIO JAVIER PERERA GONZALVEZ\",\n    \"rfc\": \"PEGM880601841\",\n    \"uso_cfdi\": \"G03 - Gastos en general\"\n  },\n  \"factura\": {\n    \"uuid\": \"BBD06928-A8B4-4BB7-A6A4-A970B3972803\",\n    \"fecha_emision\": \"2025-07-15T21:45:07\",\n    \"lugar_expedicion\": \"76150\",\n    \"forma_pago\": \"03\",\n    \"metodo_pago\": \"PUE\",\n    \"moneda\": \"MXN\"\n  },\n  \"conceptos\": [\n    {\n      \"cantidad\": 1,\n      \"unidad\": \"E48 - Unidad de servicio\",\n      \"descripcion\": \"Servicios de internet\",\n      \"precio_unitario\": 7500.00,\n      \"importe\": 7500.00,\n      \"impuestos\": {\n        \"tipo\": \"002 IVA\",\n        \"base\": 7500.00,\n        \"tasa\": 0.16,\n        \"importe\": 1200.00\n      }\n    }\n  ],\n  \"totales\": {\n    \"subtotal\": 7500.00,\n    \"iva\": 1200.00,\n    \"total\": 8700.00\n  }\n}\n","options":{"systemPromptTemplate":"You are an expert extraction algorithm.\nOnly extract relevant information from the text.\nIf you do not know the value of an attribute asked to extract, you may omit the attribute's value."}},"type":"@n8n/n8n-nodes-langchain.informationExtractor","typeVersion":1.2,"position":[-1060,-180],"id":"f54d6608-4c7a-421f-b537-c6d8e34b90a1","name":"Information Extractor"},{"parameters":{"modelName":"models/gemini-2.5-flash","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-1080,0],"id":"006dd04a-0eba-468c-8974-9f5ff494d90e","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"options":{"reset":false}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-300,-420],"id":"c4f0bf70-141d-42eb-9e49-a407523e87b4","name":"Loop Over Items","notesInFlow":false,"alwaysOutputData":false},{"parameters":{"jsCode":"// items[0] es el único ítem que contiene múltiples archivos en .binary\nconst incoming = items[0];\n// obtenemos todas las keys de archivos subidos\nconst fileKeys = Object.keys(incoming.binary);\n\n// por cada key devolvemos un nuevo ítem con un solo archivo bajo .binary.file\nconst newItems = fileKeys.map(key => ({\n  json: incoming.json,               // si traías datos JSON, los copias\n  binary: { file: incoming.binary[key] }  // cada uno con .binary.file\n}));\n\nreturn newItems;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-560,-420],"id":"f517168f-cd7b-4172-a91f-b157b759d0c5","name":"Code"},{"parameters":{"mode":"insert","tableName":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[-760,-180],"id":"22b47cb1-fa50-4cbd-95d4-57b26667d570","name":"Supabase Vector Store","credentials":{"supabaseApi":{"id":"gbJXO6tFvKk1P043","name":"Supabase account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-800,20],"id":"dcff0a5c-3634-45ff-a638-54fd4ba807ac","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"89IjBTL65KDWtJ7y","name":"OpenAi account"}}},{"parameters":{"jsonMode":"expressionData","jsonData":"={{ $json.output.conceptos[0].descripcion }}","options":{"metadata":{"metadataValues":[{"name":"emisor","value":"={{ $json.output.emisor }}"},{"name":"receptor","value":"={{ $json.output.receptor }}"},{"name":"fecha_emision","value":"={{ $json.output.factura.fecha_emision }}"},{"name":"forma_pago","value":"={{ $json.output.factura.metodo_pago }}"},{"name":"moneda","value":"={{ $json.output.factura.moneda }}"},{"name":"subtotal","value":"={{ $json.output.totales.subtotal }}"},{"name":"total","value":"={{ $json.output.totales.total }}"}]}}},"type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1.1,"position":[-620,20],"id":"1e72f5a2-c428-477d-8cde-06c6ab75a404","name":"Default Data Loader"}],"connections":{"On form submission":{"main":[[{"node":"Code","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"Information Extractor","type":"main","index":0}]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"Information Extractor","type":"ai_languageModel","index":0}]]},"Information Extractor":{"main":[[{"node":"Supabase Vector Store","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Extract from File","type":"main","index":0}]]},"Code":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Supabase Vector Store","type":"ai_document","index":0}]]},"Supabase Vector Store":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"9f11e698-e081-451f-8fcf-99f94e165721","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-18T08:49:06.627Z","updatedAt":"2025-07-18T08:49:06.627Z","role":"workflow:owner","workflowId":"gcpCG3bGB219TpU3","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-18T08:56:20.305Z","updatedAt":"2025-07-18T08:57:32.000Z","id":"RU9gopJn5sAzyO27","name":"Multiple Check to text","active":false,"isArchived":false,"nodes":[{"parameters":{"formTitle":"PDF","formFields":{"values":[{"fieldLabel":"Archivo","fieldType":"file","acceptFileTypes":".pdf","requiredField":true}]},"options":{"appendAttribution":false}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[-780,-420],"id":"57180824-ed56-4cf2-aa41-3f605003de1d","name":"On form submission","webhookId":"4fee492b-6bd8-4ca1-b9b6-8484c98bbef3"},{"parameters":{"operation":"pdf","binaryPropertyName":"file","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-140,-400],"id":"33732809-88a3-4059-b033-394d670ef368","name":"Extract from File","retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{"options":{"reset":false}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-380,-420],"id":"62300965-030f-4c54-9752-f41837b5fdb3","name":"Loop Over Items","notesInFlow":false,"alwaysOutputData":false},{"parameters":{"jsCode":"// items[0] es el único ítem que contiene múltiples archivos en .binary\nconst incoming = items[0];\n// obtenemos todas las keys de archivos subidos\nconst fileKeys = Object.keys(incoming.binary);\n\n// por cada key devolvemos un nuevo ítem con un solo archivo bajo .binary.file\nconst newItems = fileKeys.map(key => ({\n  json: incoming.json,               // si traías datos JSON, los copias\n  binary: { file: incoming.binary[key] }  // cada uno con .binary.file\n}));\n\nreturn newItems;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-560,-420],"id":"4dcaf487-2945-48ca-a457-4ca1c7e09a65","name":"Code"}],"connections":{"On form submission":{"main":[[{"node":"Code","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Extract from File","type":"main","index":0}]]},"Code":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"3d92c969-ccbc-4a0f-9c87-ae29ae941e2d","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-18T08:56:20.601Z","updatedAt":"2025-07-18T08:56:20.601Z","role":"workflow:owner","workflowId":"RU9gopJn5sAzyO27","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-18T11:55:42.478Z","updatedAt":"2025-07-18T14:01:13.000Z","id":"eEAMuxBpShnj0FtP","name":"agente","active":false,"isArchived":false,"nodes":[{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[0,0],"id":"17e2b01a-2519-42f9-93da-7c35aca9014b","name":"When chat message received","webhookId":"1e4717a3-e49f-490e-95fa-b995a6ea5711"},{"parameters":{"options":{"systemMessage":"Eres un asistente de contabilidad, tu objetivo es buscar facturas según lo que te consulta el usuario.\nReformula la pregunta del usuario si es ambigua antes de enviarla como query."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[220,0],"id":"e6f349ef-5016-472f-b811-02685bbe497b","name":"AI Agent"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[320,220],"id":"452a78f5-7380-4d1a-9fc8-ef20b98862de","name":"Simple Memory"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[120,200],"id":"0a813837-89c4-41df-ab4e-5b82520e20eb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"89IjBTL65KDWtJ7y","name":"OpenAi account"}}},{"parameters":{"mode":"retrieve-as-tool","toolDescription":"Esta herramienta permite al agente realizar búsquedas semánticas eficientes de facturas dentro de una base de datos vectorial. Utiliza representaciones vectoriales de texto para encontrar documentos relevantes incluso cuando las consultas no coinciden exactamente con los términos originales. Es especialmente útil para localizar facturas por contenido, entidad, fecha, monto u otros atributos mencionados en lenguaje natural.\n\nCasos de uso típicos:\n\nEncontrar facturas asociadas a un proveedor específico aunque el nombre esté escrito de forma variable.\n\nLocalizar facturas con conceptos similares (por ejemplo, \"mantenimiento\" y \"reparaciones\").\n\nRecuperar documentos a partir de descripciones incompletas o imprecisas.","tableName":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"useReranker":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[600,260],"id":"05bb5263-e7d7-4e85-a468-7af2e748abb6","name":"Supabase Vector Store","credentials":{"supabaseApi":{"id":"gbJXO6tFvKk1P043","name":"Supabase account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.rerankerCohere","typeVersion":1,"position":[800,420],"id":"7e63b14a-752c-4c1b-843d-aaf2ae114af1","name":"Reranker Cohere","credentials":{"cohereApi":{"id":"9ZVa19BQVcYA7Gq3","name":"CohereApi account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[500,420],"id":"3e02b472-b4c9-4108-8113-87da057851dd","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"89IjBTL65KDWtJ7y","name":"OpenAi account"}}}],"connections":{"When chat message received":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Reranker Cohere":{"ai_reranker":[[{"node":"Supabase Vector Store","type":"ai_reranker","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]},"Supabase Vector Store":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"a91e8ebc-2966-4edf-8754-c0ddbe2eefd6","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-18T11:55:42.915Z","updatedAt":"2025-07-18T11:55:42.915Z","role":"workflow:owner","workflowId":"eEAMuxBpShnj0FtP","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-18T11:58:52.464Z","updatedAt":"2025-07-18T11:58:52.464Z","id":"zFt1zpR5Dnzihkql","name":"My Sub-Workflow 1","active":false,"isArchived":false,"nodes":[{"id":"c055762a-8fe7-4141-a639-df2372f30060","typeVersion":1.1,"name":"When Executed by Another Workflow","type":"n8n-nodes-base.executeWorkflowTrigger","position":[260,340],"parameters":{}},{"id":"b5942df6-0160-4ef7-965d-57583acdc8aa","name":"Replace me with your logic","type":"n8n-nodes-base.noOp","position":[520,340],"parameters":{}}],"connections":{"When Executed by Another Workflow":{"main":[[{"node":"Replace me with your logic","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"805526a2-e8f5-4ddb-921e-12a9b50af343","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-18T11:58:55.148Z","updatedAt":"2025-07-18T11:58:55.148Z","role":"workflow:owner","workflowId":"zFt1zpR5Dnzihkql","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-18T11:58:52.482Z","updatedAt":"2025-07-18T11:58:52.482Z","id":"wAZ66whMe7Z9H0OL","name":"My Sub-Workflow 1","active":false,"isArchived":false,"nodes":[{"id":"c055762a-8fe7-4141-a639-df2372f30060","typeVersion":1.1,"name":"When Executed by Another Workflow","type":"n8n-nodes-base.executeWorkflowTrigger","position":[260,340],"parameters":{}},{"id":"b5942df6-0160-4ef7-965d-57583acdc8aa","name":"Replace me with your logic","type":"n8n-nodes-base.noOp","position":[520,340],"parameters":{}}],"connections":{"When Executed by Another Workflow":{"main":[[{"node":"Replace me with your logic","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"5f2b1567-3c17-4942-a8d9-e2c2df6baf30","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-18T11:58:55.139Z","updatedAt":"2025-07-18T11:58:55.139Z","role":"workflow:owner","workflowId":"wAZ66whMe7Z9H0OL","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-18T11:58:52.496Z","updatedAt":"2025-07-18T11:58:52.496Z","id":"ije0nXPZneFR7tpQ","name":"My Sub-Workflow 1","active":false,"isArchived":false,"nodes":[{"id":"c055762a-8fe7-4141-a639-df2372f30060","typeVersion":1.1,"name":"When Executed by Another Workflow","type":"n8n-nodes-base.executeWorkflowTrigger","position":[260,340],"parameters":{}},{"id":"b5942df6-0160-4ef7-965d-57583acdc8aa","name":"Replace me with your logic","type":"n8n-nodes-base.noOp","position":[520,340],"parameters":{}}],"connections":{"When Executed by Another Workflow":{"main":[[{"node":"Replace me with your logic","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"bc782a5c-3f7d-4669-ae28-65273ebc15d6","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-18T11:58:55.140Z","updatedAt":"2025-07-18T11:58:55.140Z","role":"workflow:owner","workflowId":"ije0nXPZneFR7tpQ","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-18T11:58:52.559Z","updatedAt":"2025-07-18T11:58:52.559Z","id":"h7n5lGj7XCS8nHwc","name":"My Sub-Workflow 1","active":false,"isArchived":false,"nodes":[{"id":"c055762a-8fe7-4141-a639-df2372f30060","typeVersion":1.1,"name":"When Executed by Another Workflow","type":"n8n-nodes-base.executeWorkflowTrigger","position":[260,340],"parameters":{}},{"id":"b5942df6-0160-4ef7-965d-57583acdc8aa","name":"Replace me with your logic","type":"n8n-nodes-base.noOp","position":[520,340],"parameters":{}}],"connections":{"When Executed by Another Workflow":{"main":[[{"node":"Replace me with your logic","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"6450f16e-defc-4abe-9e39-d293155c1f9b","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-18T11:58:55.384Z","updatedAt":"2025-07-18T11:58:55.384Z","role":"workflow:owner","workflowId":"h7n5lGj7XCS8nHwc","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-18T11:58:56.609Z","updatedAt":"2025-07-18T11:58:56.609Z","id":"4tc7LLffIBuPnYpf","name":"My Sub-Workflow 1","active":false,"isArchived":false,"nodes":[{"id":"c055762a-8fe7-4141-a639-df2372f30060","typeVersion":1.1,"name":"When Executed by Another Workflow","type":"n8n-nodes-base.executeWorkflowTrigger","position":[260,340],"parameters":{}},{"id":"b5942df6-0160-4ef7-965d-57583acdc8aa","name":"Replace me with your logic","type":"n8n-nodes-base.noOp","position":[520,340],"parameters":{}}],"connections":{"When Executed by Another Workflow":{"main":[[{"node":"Replace me with your logic","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"f4f328af-8e43-4574-a783-173a5e78c6ef","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-18T11:58:59.323Z","updatedAt":"2025-07-18T11:58:59.323Z","role":"workflow:owner","workflowId":"4tc7LLffIBuPnYpf","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-18T11:59:28.097Z","updatedAt":"2025-07-18T12:59:05.000Z","id":"whKgAGNmwFtdjQeh","name":"MCP","active":true,"isArchived":false,"nodes":[{"parameters":{"path":"vector"},"type":"@n8n/n8n-nodes-langchain.mcpTrigger","typeVersion":1.1,"position":[-360,140],"id":"2864ef2b-5aa3-47ea-90e2-6bffdd702978","name":"MCP Server Trigger","webhookId":"fce45731-84d2-4a02-aae3-16fb43846de6"},{"parameters":{"mode":"retrieve-as-tool","toolDescription":"Esta herramienta permite al agente realizar búsquedas semánticas eficientes de facturas dentro de una base de datos vectorial. Utiliza representaciones vectoriales de texto para encontrar documentos relevantes incluso cuando las consultas no coinciden exactamente con los términos originales. Es especialmente útil para localizar facturas por contenido, entidad, fecha, monto u otros atributos mencionados en lenguaje natural.\n\nCasos de uso típicos:\n\nEncontrar facturas asociadas a un proveedor específico aunque el nombre esté escrito de forma variable.\n\nLocalizar facturas con conceptos similares (por ejemplo, \"mantenimiento\" y \"reparaciones\").\n\nRecuperar documentos a partir de descripciones incompletas o imprecisas.","tableName":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"useReranker":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[-480,360],"id":"bb84e81b-4815-4742-9af0-eaf84aa8a1e0","name":"Supabase Vector Store","credentials":{"supabaseApi":{"id":"gbJXO6tFvKk1P043","name":"Supabase account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.rerankerCohere","typeVersion":1,"position":[-320,540],"id":"48d255e2-531f-4ef6-93cf-f5242505f36c","name":"Reranker Cohere","credentials":{"cohereApi":{"id":"9ZVa19BQVcYA7Gq3","name":"CohereApi account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-480,540],"id":"0cc66932-d205-4e5a-8f1a-69c94482f767","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"89IjBTL65KDWtJ7y","name":"OpenAi account"}}}],"connections":{"Supabase Vector Store":{"ai_tool":[[{"node":"MCP Server Trigger","type":"ai_tool","index":0}]]},"Reranker Cohere":{"ai_reranker":[[{"node":"Supabase Vector Store","type":"ai_reranker","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"973e0bef-ce2c-40ed-b7ed-f83d385888b1","triggerCount":1,"tags":[],"shared":[{"createdAt":"2025-07-18T11:59:28.440Z","updatedAt":"2025-07-18T11:59:28.440Z","role":"workflow:owner","workflowId":"whKgAGNmwFtdjQeh","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-18T11:59:56.855Z","updatedAt":"2025-07-18T12:58:57.000Z","id":"EUlUwgJr0THxuTd0","name":"MCP con subworkflow","active":false,"isArchived":true,"nodes":[{"parameters":{"path":"663b6f74-b2e4-4ecf-896b-700f51ff7b5f"},"type":"@n8n/n8n-nodes-langchain.mcpTrigger","typeVersion":1.1,"position":[-360,140],"id":"291a170d-d385-478a-a8a2-c018e5c3f716","name":"MCP Server Trigger","webhookId":"663b6f74-b2e4-4ecf-896b-700f51ff7b5f"},{"parameters":{"description":"Utiliza esta herramienta cuando el usuario haga una pregunta relacionada con el contenido específico de una factura CFDI. Esto incluye consultas sobre:\n\nEl emisor o receptor de la factura\n\nMontos (subtotal, total, IVA)\n\nFecha de emisión\n\nForma o método de pago\n\nMoneda\n\nRégimen fiscal\n\nServicios o conceptos facturados\n\nEjemplos de preguntas del usuario:\n\n\"¿Qué servicios se facturaron?\"\n\n\"¿Cuál fue la forma de pago?\"\n\n\"¿Qué total tiene esta factura?\"\n\n\"¿Qué régimen fiscal tiene el receptor?\"\n\n⚙️ Cómo funciona:\nLa herramienta realiza una búsqueda semántica en una base de datos indexada con facturas CFDI. Usa IA (OpenAI + Cohere) para identificar la información más relevante relacionada con la pregunta del usuario.\n\nRecibe como entrada un objeto JSON con esta estructura:\n\njson\nCopy\nEdit\n{\n  \"query\": \"Consulta del usuario\",\n  \"total\": 12528,\n  \"emisor\": {\n    \"rfc\": \"RFC del emisor\",\n    \"nombre\": \"Nombre del emisor\",\n    \"regimen_fiscal\": \"Régimen fiscal del emisor\"\n  },\n  \"moneda\": \"MXN\",\n  \"receptor\": {\n    \"rfc\": \"RFC del receptor\",\n    \"nombre\": \"Nombre del receptor\",\n    \"uso_cfdi\": \"Uso CFDI\",\n    \"regimen_fiscal\": \"Régimen fiscal del receptor\",\n    \"domicilio_fiscal\": \"Código postal\"\n  },\n  \"subtotal\": 10800,\n  \"forma_pago\": \"PUE - Pago en una sola exhibición\",\n  \"fecha_emision\": \"2025-07-18T08:01:57\"\n}","workflowId":{"__rl":true,"value":"pD8FNKbAQ4TBp516","mode":"list","cachedResultName":"tool"},"workflowInputs":{"mappingMode":"defineBelow","value":{"emisor":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('emisor', ``, 'string') }}","receptor":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('receptor', ``, 'string') }}","factura":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('factura', ``, 'string') }}","conceptos":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conceptos', ``, 'string') }}","totales":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('totales', ``, 'string') }}","query":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', ``, 'string') }}"},"matchingColumns":[],"schema":[{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"emisor","displayName":"emisor","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"object","removed":false},{"id":"receptor","displayName":"receptor","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"object","removed":false},{"id":"factura","displayName":"factura","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"object","removed":false},{"id":"conceptos","displayName":"conceptos","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"array","removed":false},{"id":"totales","displayName":"totales","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"object","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-280,360],"id":"ee97e6b5-4646-4fba-98ec-99bcc24bfe08","name":"Call n8n Workflow Tool"},{"parameters":{"description":"Usa esta herramienta cuando el usuario haga una pregunta general cuya respuesta pueda encontrarse en documentos de texto previamente indexados (como políticas, contratos, manuales, correos, minutas, etc.).\n\n⚙️ Cómo funciona:\nEsta herramienta realiza una búsqueda semántica en una base de datos de Supabase, que contiene documentos de texto plano previamente indexados.\n\nGenera embeddings del query (pregunta del usuario) usando OpenAI.\n\nRecupera los fragmentos más relevantes desde Supabase.\n\nReordena los resultados con Cohere para ofrecer la mejor respuesta posible.\n\nEntrada esperada:\n\njson\nCopy\nEdit\n{\n  \"query\": \"Texto de la pregunta del usuario\"\n}","workflowId":{"__rl":true,"value":"pD8FNKbAQ4TBp516","mode":"list","cachedResultName":"tool"},"workflowInputs":{"mappingMode":"defineBelow","value":{"query":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', ``, 'string') }}"},"matchingColumns":["query"],"schema":[{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-100,360],"id":"f5258d49-9a78-4353-8cd7-5a14edcf84fe","name":"Call n8n Workflow Tool1"}],"connections":{"Call n8n Workflow Tool":{"ai_tool":[[]]},"Call n8n Workflow Tool1":{"ai_tool":[[{"node":"MCP Server Trigger","type":"ai_tool","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"dca8f0c5-e615-46ab-bd40-3ec335ce0ca1","triggerCount":1,"tags":[],"shared":[{"createdAt":"2025-07-18T11:59:57.274Z","updatedAt":"2025-07-18T11:59:57.274Z","role":"workflow:owner","workflowId":"EUlUwgJr0THxuTd0","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-18T12:00:30.972Z","updatedAt":"2025-07-18T12:58:48.000Z","id":"pD8FNKbAQ4TBp516","name":"tool","active":false,"isArchived":true,"nodes":[{"parameters":{"workflowInputs":{"values":[{"name":"query"}]}},"id":"c055762a-8fe7-4141-a639-df2372f30060","typeVersion":1.1,"name":"When Executed by Another Workflow","type":"n8n-nodes-base.executeWorkflowTrigger","position":[260,340]},{"parameters":{"mode":"load","tableName":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"prompt":"={{ $json.query }}","useReranker":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[480,340],"id":"05a55402-914c-408e-92d5-59649815b8f4","name":"Supabase Vector Store","credentials":{"supabaseApi":{"id":"gbJXO6tFvKk1P043","name":"Supabase account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[400,580],"id":"128926bd-0b6d-4317-821f-7057414df4d2","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"89IjBTL65KDWtJ7y","name":"OpenAi account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.rerankerCohere","typeVersion":1,"position":[640,580],"id":"bbe90d65-e6eb-4957-bbcd-f31018278082","name":"Reranker Cohere","credentials":{"cohereApi":{"id":"9ZVa19BQVcYA7Gq3","name":"CohereApi account"}}}],"connections":{"When Executed by Another Workflow":{"main":[[{"node":"Supabase Vector Store","type":"main","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]},"Reranker Cohere":{"ai_reranker":[[{"node":"Supabase Vector Store","type":"ai_reranker","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"a0de156a-e798-4464-b422-cc000588c913","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-18T12:00:31.189Z","updatedAt":"2025-07-18T12:00:31.189Z","role":"workflow:owner","workflowId":"pD8FNKbAQ4TBp516","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-22T20:01:04.711Z","updatedAt":"2025-07-22T20:01:04.711Z","id":"e7zmpm9x241nBbxI","name":"My workflow 6","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[0,0],"id":"53a3f885-9138-4269-aa8a-ff38351d932a","name":"When clicking ‘Execute workflow’"},{"parameters":{"method":"POST","url":"http://n8n-alb-1431437514.mx-central-1.elb.amazonaws.com/webhook/228af51d-f467-4867-bf23-c8653cab78ab","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"bodyParameters":{"parameters":[{"name":"query","value":"hola"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[220,0],"id":"795a3a49-3361-4402-9d27-9f60a9b8b253","name":"HTTP Request","credentials":{"httpHeaderAuth":{"id":"zwgXC5bDXel67Chu","name":"Header Auth account"}}}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"ca61b7b8-7802-4a7b-833c-a7531aba293a","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-22T20:01:04.719Z","updatedAt":"2025-07-22T20:01:04.719Z","role":"workflow:owner","workflowId":"e7zmpm9x241nBbxI","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-23T16:38:41.572Z","updatedAt":"2025-07-23T16:38:41.572Z","id":"Gma7qQvQgjexe74H","name":"My Sub-Workflow 6","active":false,"isArchived":false,"nodes":[{"id":"c055762a-8fe7-4141-a639-df2372f30060","typeVersion":1.1,"name":"When Executed by Another Workflow","type":"n8n-nodes-base.executeWorkflowTrigger","position":[260,340],"parameters":{}},{"id":"b5942df6-0160-4ef7-965d-57583acdc8aa","name":"Replace me with your logic","type":"n8n-nodes-base.noOp","position":[520,340],"parameters":{}}],"connections":{"When Executed by Another Workflow":{"main":[[{"node":"Replace me with your logic","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"7cfed481-ac26-4693-a4f4-0280ecc18fc1","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-23T16:38:41.591Z","updatedAt":"2025-07-23T16:38:41.591Z","role":"workflow:owner","workflowId":"Gma7qQvQgjexe74H","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-27T16:55:58.943Z","updatedAt":"2025-07-28T15:35:12.000Z","id":"tpuFbWgZJalow31T","name":"Nutrición","active":false,"isArchived":false,"nodes":[{"parameters":{"formTitle":"input","formFields":{"values":[{"fieldLabel":"img","fieldType":"file","multipleFiles":false,"requiredField":true},{"fieldLabel":"Alimento"}]},"options":{}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[-600,-200],"id":"13031ce4-366b-49e1-ae00-128936b383cb","name":"On form submission","webhookId":"92c192b7-79cc-4600-be96-357a5c7044a3"},{"parameters":{"assignments":{"assignments":[{"id":"768de210-0d28-46d5-a9f8-c7186a3e7000","name":"text","value":"={{ $json.candidates[0].content.parts[0].text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-600,0],"id":"4a99dbdd-b827-46d8-9af2-ab2c32582d69","name":"Edit Fields"},{"parameters":{"promptType":"define","text":"=Eres un experto en nutrición y salud metabólica. Tu tarea es analizar tablas nutricionales de productos alimenticios y generar reportes objetivos, claros y útiles para el usuario final.\n\nEvalúa cada alimento en función de sus valores por 100 g o por porción, considerando los siguientes criterios:\n\nCalificación general del 1 al 5:\n5 – Excelente: Alto en proteína o fibra, bajo en grasa saturada, azúcares y sodio.\n\n4 – Bueno: Balanceado, con un pequeño aspecto a mejorar.\n\n3 – Aceptable: Puede ser parte de una dieta balanceada, pero tiene limitaciones (ej. alto sodio o baja fibra).\n\n2 – Pobre: Desequilibrado o con nutrientes críticos en exceso.\n\n1 – No recomendable: Perjudicial o sin valor nutricional significativo.\n\nUmbrales guía (por cada 100 g):\nProteína: ≥10 g es alto\n\nGrasa saturada: >2 g es alta\n\nSodio: >400 mg es elevado\n\nAzúcares añadidos: cualquier cantidad es negativo\n\nFibra: ≥3 g es positivo\n\nInstrucciones de salida:\n\nDevuelve un análisis estructurado en tres secciones:\n\nCalificación Nutricional: Número y etiqueta (por ejemplo: \"3 – Aceptable\")\n\nAnálisis detallado: Lista de puntos clave del alimento con observaciones.\n\nConclusión: ¿Se recomienda o no? ¿Para qué tipo de consumo es ideal?\n\nUsa un lenguaje claro, profesional, sin alarmismo. Escribe como si el usuario fuera una persona preocupada por su salud y alimentación diaria.\n\nTu respuesta debe ser un json que incluya 3 elemntos: la clasificacion siendo unicamente un numero entre 1 y 5, el análisis (un texto largo sin comillas dobles) y la conclusión (un texto largo sin comillas).\n\nRecuerda nunca utilizar comillas docles si lo requeires usa comillas simples.\n\nAlimento:\n{{ $('Edit Fields').item.json.text }}","batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[-620,200],"id":"71e6d9f7-4070-45c8-af6b-0450a4f92a31","name":"Basic LLM Chain"},{"parameters":{"modelName":"models/gemma-3-27b-it","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-600,360],"id":"cbfe0bbc-2d51-409c-8d7b-d529303bac38","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"jsCode":"// items[0].binary.img.data es un Buffer\nconst buffer = items[0].binary.img.data;\nconst base64 = buffer.toString('base64');\n\nreturn [{\n  json: {\n    filename: items[0].json.img.filename,\n    mimetype: items[0].json.img.mimetype,\n    base64\n  }\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-460,-200],"id":"0f044f82-bcd8-43ba-a7e6-761a65e1d852","name":"IMG to BASE64"},{"parameters":{"jsCode":"// n8n Code node: extrae y parsea bloque Markdown con JSON\nreturn items.map(item => {\n  // 1. Localiza el texto Markdown\n  let markdown = item.json.markdown;\n  if (markdown === undefined) {\n    // Si no existe la propiedad markdown, busca cualquier string en item.json\n    const firstString = Object.values(item.json).find(v => typeof v === 'string');\n    markdown = firstString;\n  }\n  if (typeof markdown !== 'string') {\n    throw new Error('No se encontró ninguna cadena Markdown en item.json');\n  }\n\n  // 2. Busca bloque ```json ... ```\n  const match = markdown.match(/```json\\s*([\\s\\S]*?)```/i);\n  if (!match) {\n    throw new Error('No se encontró un bloque de código JSON en la entrada.');\n  }\n\n  // 3. Parsear el contenido JSON extraído\n  let parsed;\n  try {\n    parsed = JSON.parse(match[1].trim());\n  } catch (err) {\n    throw new Error('Error al parsear JSON: ' + err.message);\n  }\n\n  // 4. Devolver el item con el objeto JSON\n  return { json: parsed };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-460,0],"id":"047690a0-00ca-43f3-9ce9-3066553deab2","name":"TEXT to JSON"},{"parameters":{"method":"POST","url":"https://generativelanguage.googleapis.com/v1beta/models/gemma-3-27b-it:generateContent","authentication":"predefinedCredentialType","nodeCredentialType":"googlePalmApi","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"contents\": [\n    {\n      \"parts\": [\n        {\n          \"inline_data\": {\n            \"mime_type\": \"image/jpeg\",\n            \"data\": \"{{ $json.base64 }}\"\n          }\n        },\n        {\n          \"text\": \"Para la siguiente imagen analizala y extra los datos (Nombre, Porción, Categoría, Proteinas, Grasas totales, Grasas saturadas, Grasas trans, Hidratos de carbono, Azucares, Azucares añadidos, Fibra dietética, Sodio) de la tabla nutricional en un json. El alimento es {{ $('On form submission').item.json.Alimento }}\"\n        }\n      ]\n    }\n  ]\n}\n","options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-320,-200],"id":"cf89049f-43c5-40a0-b9eb-594c69812704","name":"GEMMA TEXT EXTRACTOR","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"jsCode":"// n8n Code node: extrae y parsea bloque Markdown con JSON\nreturn items.map(item => {\n  // 1. Localiza el texto Markdown\n  let markdown = item.json.markdown;\n  if (markdown === undefined) {\n    // Si no existe la propiedad markdown, busca cualquier string en item.json\n    const firstString = Object.values(item.json).find(v => typeof v === 'string');\n    markdown = firstString;\n  }\n  if (typeof markdown !== 'string') {\n    throw new Error('No se encontró ninguna cadena Markdown en item.json');\n  }\n\n  // 2. Busca bloque ```json ... ```\n  const match = markdown.match(/```json\\s*([\\s\\S]*?)```/i);\n  if (!match) {\n    throw new Error('No se encontró un bloque de código JSON en la entrada.');\n  }\n\n  // 3. Parsear el contenido JSON extraído\n  let parsed;\n  try {\n    parsed = JSON.parse(match[1].trim());\n  } catch (err) {\n    throw new Error('Error al parsear JSON: ' + err.message);\n  }\n\n  // 4. Devolver el item con el objeto JSON\n  return { json: parsed };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-300,200],"id":"4c816673-eb65-4d80-9038-9a77e8aaf0e7","name":"TEXT to JSON1"},{"parameters":{"method":"POST","url":"https://aitable.ai/fusion/v1/datasheets/dst7N7yWumlt1cTqZ2/records","authentication":"genericCredentialType","genericAuthType":"httpBearerAuth","sendQuery":true,"queryParameters":{"parameters":[{"name":"viewId","value":"viw7pfbaDF3AF"},{"name":"fieldKey","value":"name"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"records\": [\n    {\n      \"fields\": {\n        \"Nombre\": \"{{ $json.Nombre }}\",\n        \"Porción\": \"{{ $json['Porción'] }}\",\n        \"Categoría\": \"{{ $json['Categoría'] }}\",\n        \"Proteinas\": \"{{ $json.Proteinas }}\",\n        \"Grasas totales\": \"{{ $json['Grasas totales'] }}\",\n        \"Grasas saturadas\": \"{{ $json['Grasas saturadas'] }}\",\n        \"Grasas trans\": \"{{ $json['Grasas trans'] }}\",\n        \"Hidratos de carbono\": \"{{ $json['Hidratos de carbono'] }}\",\n        \"Azucares\": \"{{ $json.Azucares }}\",\n        \"Azucares añadidos\": \"{{ $json['Azucares añadidos'] }}\",\n        \"Fibra dietética\": \"{{ $json['Fibra dietética'] }}\",\n        \"Sodio\": \"{{ $json.Sodio }}\"\n      }\n    }\n  ],\n  \"fieldKey\": \"name\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-300,0],"id":"a30ec7e2-90e4-4905-b6bd-0ab8262df807","name":"AiTable Create","credentials":{"httpBearerAuth":{"id":"HurXxMMgbIlJofhu","name":"Aitable"}}},{"parameters":{"method":"PATCH","url":"https://aitable.ai/fusion/v1/datasheets/dst7N7yWumlt1cTqZ2/records","authentication":"genericCredentialType","genericAuthType":"httpBearerAuth","sendQuery":true,"queryParameters":{"parameters":[{"name":"viewId","value":"viw7pfbaDF3AF"},{"name":"fieldKey","value":"name"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"records\": [\n    {\n      \"recordId\": \"{{ $('AiTable Create').item.json.data.records[0].recordId }}\",\n      \"fields\": {\n        \"Nombre\": \"{{ $('AiTable Create').item.json.data.records[0].fields.Nombre }}\",\n        \"Porción\": \"{{ $('AiTable Create').item.json.data.records[0].fields['Porción'] }}\",\n        \"Categoría\": \"{{ $('AiTable Create').item.json.data.records[0].fields['Categoría'] }}\",\n        \"Proteinas\": \"{{ $('AiTable Create').item.json.data.records[0].fields.Proteinas }}\",\n        \"Grasas totales\": \"{{ $('AiTable Create').item.json.data.records[0].fields['Grasas totales'] }}\",\n        \"Grasas saturadas\": \"{{ $('AiTable Create').item.json.data.records[0].fields['Grasas saturadas'] }}\",\n        \"Grasas trans\": \"{{ $('AiTable Create').item.json.data.records[0].fields['Grasas trans'] }}\",\n        \"Hidratos de carbono\": \"{{ $('AiTable Create').item.json.data.records[0].fields['Hidratos de carbono'] }}\",\n        \"Azucares\": \"{{ $('AiTable Create').item.json.data.records[0].fields['Azucares'] }}\",\n        \"Azucares añadidos\": \"{{ $('AiTable Create').item.json.data.records[0].fields['Azucares añadidos'] }}\",\n        \"Fibra dietética\": \"{{ $('AiTable Create').item.json.data.records[0].fields['Fibra dietética'] }}\",\n        \"Sodio\": \"{{ $('AiTable Create').item.json.data.records[0].fields.Sodio }}\",\n        \"Calificacion\": {{ $json.clasificacion }},\n        \"Análisis\": \"{{ $json['análisis'] }}\",\n        \"Conclusión\": \"{{ $json['conclusión'] }}\"\n      }\n    }  \n],\n  \"fieldKey\": \"name\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-140,200],"id":"988ed450-9b28-40be-acb2-3cee3777e70a","name":"AiTable Update","credentials":{"httpBearerAuth":{"id":"HurXxMMgbIlJofhu","name":"Aitable"}}}],"connections":{"On form submission":{"main":[[{"node":"IMG to BASE64","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"TEXT to JSON","type":"main","index":0}]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"Basic LLM Chain","type":"ai_languageModel","index":0}]]},"IMG to BASE64":{"main":[[{"node":"GEMMA TEXT EXTRACTOR","type":"main","index":0}]]},"TEXT to JSON":{"main":[[{"node":"AiTable Create","type":"main","index":0}]]},"GEMMA TEXT EXTRACTOR":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Basic LLM Chain":{"main":[[{"node":"TEXT to JSON1","type":"main","index":0}]]},"TEXT to JSON1":{"main":[[{"node":"AiTable Update","type":"main","index":0}]]},"AiTable Create":{"main":[[{"node":"Basic LLM Chain","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"e9ab9401-6d71-4c68-a5e9-a4857e536031","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-27T16:55:59.019Z","updatedAt":"2025-07-27T16:55:59.019Z","role":"workflow:owner","workflowId":"tpuFbWgZJalow31T","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-28T00:06:57.079Z","updatedAt":"2025-07-28T02:45:15.000Z","id":"gaqyQSjQrJ9uj2dB","name":"My workflow 8","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[0,0],"id":"248d6213-358d-4f59-a8aa-f5729e08d49e","name":"When clicking ‘Execute workflow’"},{"parameters":{"url":"https://aitable.ai/fusion/v1/datasheets/dst7N7yWumlt1cTqZ2/records","authentication":"genericCredentialType","genericAuthType":"httpBearerAuth","sendQuery":true,"queryParameters":{"parameters":[{"name":"viewId","value":"viw7pfbaDF3AF"},{"name":"fieldKey","value":"name"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[280,-180],"id":"2b784c98-8df6-4955-8b44-8640c78ec8fd","name":"Get Alimentos","credentials":{"httpBearerAuth":{"id":"HurXxMMgbIlJofhu","name":"Aitable"}}}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"Get Alimentos","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"9fe139e0-b6d7-424f-938b-4db1de675e35","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-28T00:06:57.090Z","updatedAt":"2025-07-28T00:06:57.090Z","role":"workflow:owner","workflowId":"gaqyQSjQrJ9uj2dB","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-28T15:35:35.934Z","updatedAt":"2025-07-30T01:54:22.000Z","id":"TeTM0TcNLDWxsS5c","name":"Report","active":false,"isArchived":false,"nodes":[{"parameters":{"formTitle":"input","formFields":{"values":[{"fieldLabel":"img","fieldType":"file","multipleFiles":false,"requiredField":true},{"fieldLabel":"Alimento"}]},"options":{}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[-640,-208],"id":"063227c9-8999-43be-be93-861d07a2d666","name":"On form submission","webhookId":"93652889-3c00-4c81-a89a-9559e23d6030"},{"parameters":{"assignments":{"assignments":[{"id":"768de210-0d28-46d5-a9f8-c7186a3e7000","name":"text","value":"={{ $json.candidates[0].content.parts[0].text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-608,0],"id":"93ba9071-480f-4960-8fbd-be1c2dceb570","name":"Edit Fields"},{"parameters":{"promptType":"define","text":"=Eres un experto en nutrición y salud metabólica. Tu tarea es analizar tablas nutricionales de productos alimenticios y generar reportes objetivos, claros y útiles para el usuario final.\n\nEvalúa cada alimento en función de sus valores por 100 g o por porción, considerando los siguientes criterios:\n\nCalificación general del 1 al 5:\n5 – Excelente: Alto en proteína o fibra, bajo en grasa saturada, azúcares y sodio.\n\n4 – Bueno: Balanceado, con un pequeño aspecto a mejorar.\n\n3 – Aceptable: Puede ser parte de una dieta balanceada, pero tiene limitaciones (ej. alto sodio o baja fibra).\n\n2 – Pobre: Desequilibrado o con nutrientes críticos en exceso.\n\n1 – No recomendable: Perjudicial o sin valor nutricional significativo.\n\nUmbrales guía (por cada 100 g):\nProteína: ≥10 g es alto\n\nGrasa saturada: >2 g es alta\n\nSodio: >400 mg es elevado\n\nAzúcares añadidos: cualquier cantidad es negativo\n\nFibra: ≥3 g es positivo\n\nInstrucciones de salida:\n\nDevuelve un análisis estructurado en tres secciones:\n\nCalificación Nutricional: Número y etiqueta (por ejemplo: \"3 – Aceptable\")\n\nAnálisis detallado: Lista de puntos clave del alimento con observaciones.\n\nConclusión: ¿Se recomienda o no? ¿Para qué tipo de consumo es ideal?\n\nUsa un lenguaje claro, profesional, sin alarmismo. Escribe como si el usuario fuera una persona preocupada por su salud y alimentación diaria.\n\nTu respuesta debe ser un json que incluya 3 elemntos: la clasificacion siendo unicamente un numero entre 1 y 5, el análisis (un texto largo sin comillas dobles) y la conclusión (un texto largo sin comillas).\n\nRecuerda nunca utilizar comillas docles si lo requeires usa comillas simples.\n\nAlimento:\n{{ $('Edit Fields').item.json.text }}","batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[-624,208],"id":"bbdbb194-5ad6-40ef-a973-6394fd33c957","name":"Basic LLM Chain"},{"parameters":{"modelName":"models/gemma-3-27b-it","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-608,368],"id":"90a21d3f-28d8-4c02-99cc-8ebdaa351403","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"jsCode":"// items[0].binary.img.data es un Buffer\nconst buffer = items[0].binary.img.data;\nconst base64 = buffer.toString('base64');\n\nreturn [{\n  json: {\n    filename: items[0].json.img.filename,\n    mimetype: items[0].json.img.mimetype,\n    base64\n  }\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-464,-208],"id":"e6e877a3-e73d-48b7-9806-0f1077e23ec8","name":"IMG to BASE64"},{"parameters":{"jsCode":"// n8n Code node: extrae y parsea bloque Markdown con JSON\nreturn items.map(item => {\n  // 1. Localiza el texto Markdown\n  let markdown = item.json.markdown;\n  if (markdown === undefined) {\n    // Si no existe la propiedad markdown, busca cualquier string en item.json\n    const firstString = Object.values(item.json).find(v => typeof v === 'string');\n    markdown = firstString;\n  }\n  if (typeof markdown !== 'string') {\n    throw new Error('No se encontró ninguna cadena Markdown en item.json');\n  }\n\n  // 2. Busca bloque ```json ... ```\n  const match = markdown.match(/```json\\s*([\\s\\S]*?)```/i);\n  if (!match) {\n    throw new Error('No se encontró un bloque de código JSON en la entrada.');\n  }\n\n  // 3. Parsear el contenido JSON extraído\n  let parsed;\n  try {\n    parsed = JSON.parse(match[1].trim());\n  } catch (err) {\n    throw new Error('Error al parsear JSON: ' + err.message);\n  }\n\n  // 4. Devolver el item con el objeto JSON\n  return { json: parsed };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-464,0],"id":"ad3877b2-6399-42b5-aedd-f491bd12776c","name":"TEXT to JSON"},{"parameters":{"method":"POST","url":"https://generativelanguage.googleapis.com/v1beta/models/gemma-3-27b-it:generateContent","authentication":"predefinedCredentialType","nodeCredentialType":"googlePalmApi","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"contents\": [\n    {\n      \"parts\": [\n        {\n          \"inline_data\": {\n            \"mime_type\": \"image/jpeg\",\n            \"data\": \"{{ $json.base64 }}\"\n          }\n        },\n        {\n          \"text\": \"Para la siguiente imagen analizala y extra los datos (Nombre, Porción, Categoría, Proteinas, Grasas totales, Grasas saturadas, Grasas trans, Hidratos de carbono, Azucares, Azucares añadidos, Fibra dietética, Sodio) de la tabla nutricional en un json. El alimento es {{ $('On form submission').item.json.Alimento }}\"\n        }\n      ]\n    }\n  ]\n}\n","options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-320,-208],"id":"8f0b05f2-ac30-4434-bc67-e009604d0bbb","name":"GEMMA TEXT EXTRACTOR","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"jsCode":"// n8n Code node: extrae y parsea bloque Markdown con JSON\nreturn items.map(item => {\n  // 1. Localiza el texto Markdown\n  let markdown = item.json.markdown;\n  if (markdown === undefined) {\n    // Si no existe la propiedad markdown, busca cualquier string en item.json\n    const firstString = Object.values(item.json).find(v => typeof v === 'string');\n    markdown = firstString;\n  }\n  if (typeof markdown !== 'string') {\n    throw new Error('No se encontró ninguna cadena Markdown en item.json');\n  }\n\n  // 2. Busca bloque ```json ... ```\n  const match = markdown.match(/```json\\s*([\\s\\S]*?)```/i);\n  if (!match) {\n    throw new Error('No se encontró un bloque de código JSON en la entrada.');\n  }\n\n  // 3. Parsear el contenido JSON extraído\n  let parsed;\n  try {\n    parsed = JSON.parse(match[1].trim());\n  } catch (err) {\n    throw new Error('Error al parsear JSON: ' + err.message);\n  }\n\n  // 4. Devolver el item con el objeto JSON\n  return { json: parsed };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-304,208],"id":"4032c0f3-0f95-44a0-9924-becba54865a4","name":"TEXT to JSON1"},{"parameters":{"method":"POST","url":"https://aitable.ai/fusion/v1/datasheets/dst7N7yWumlt1cTqZ2/records","authentication":"genericCredentialType","genericAuthType":"httpBearerAuth","sendQuery":true,"queryParameters":{"parameters":[{"name":"viewId","value":"viw7pfbaDF3AF"},{"name":"fieldKey","value":"name"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"records\": [\n    {\n      \"fields\": {\n        \"Nombre\": \"{{ $json.Nombre }}\",\n        \"Porción\": \"{{ $json['Porción'] }}\",\n        \"Categoría\": \"{{ $json['Categoría'] }}\",\n        \"Proteinas\": \"{{ $json.Proteinas }}\",\n        \"Grasas totales\": \"{{ $json['Grasas totales'] }}\",\n        \"Grasas saturadas\": \"{{ $json['Grasas saturadas'] }}\",\n        \"Grasas trans\": \"{{ $json['Grasas trans'] }}\",\n        \"Hidratos de carbono\": \"{{ $json['Hidratos de carbono'] }}\",\n        \"Azucares\": \"{{ $json.Azucares }}\",\n        \"Azucares añadidos\": \"{{ $json['Azucares añadidos'] }}\",\n        \"Fibra dietética\": \"{{ $json['Fibra dietética'] }}\",\n        \"Sodio\": \"{{ $json.Sodio }}\"\n      }\n    }\n  ],\n  \"fieldKey\": \"name\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-304,0],"id":"3c4fe7b9-fc1d-40ee-b90d-f15faf89ea74","name":"AiTable Create","credentials":{"httpBearerAuth":{"id":"HurXxMMgbIlJofhu","name":"Aitable"}}},{"parameters":{"method":"PATCH","url":"https://aitable.ai/fusion/v1/datasheets/dst7N7yWumlt1cTqZ2/records","authentication":"genericCredentialType","genericAuthType":"httpBearerAuth","sendQuery":true,"queryParameters":{"parameters":[{"name":"viewId","value":"viw7pfbaDF3AF"},{"name":"fieldKey","value":"name"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"records\": [\n    {\n      \"recordId\": \"{{ $('AiTable Create').item.json.data.records[0].recordId }}\",\n      \"fields\": {\n        \"Nombre\": \"{{ $('AiTable Create').item.json.data.records[0].fields.Nombre }}\",\n        \"Porción\": \"{{ $('AiTable Create').item.json.data.records[0].fields['Porción'] }}\",\n        \"Categoría\": \"{{ $('AiTable Create').item.json.data.records[0].fields['Categoría'] }}\",\n        \"Proteinas\": \"{{ $('AiTable Create').item.json.data.records[0].fields.Proteinas }}\",\n        \"Grasas totales\": \"{{ $('AiTable Create').item.json.data.records[0].fields['Grasas totales'] }}\",\n        \"Grasas saturadas\": \"{{ $('AiTable Create').item.json.data.records[0].fields['Grasas saturadas'] }}\",\n        \"Grasas trans\": \"{{ $('AiTable Create').item.json.data.records[0].fields['Grasas trans'] }}\",\n        \"Hidratos de carbono\": \"{{ $('AiTable Create').item.json.data.records[0].fields['Hidratos de carbono'] }}\",\n        \"Azucares\": \"{{ $('AiTable Create').item.json.data.records[0].fields['Azucares'] }}\",\n        \"Azucares añadidos\": \"{{ $('AiTable Create').item.json.data.records[0].fields['Azucares añadidos'] }}\",\n        \"Fibra dietética\": \"{{ $('AiTable Create').item.json.data.records[0].fields['Fibra dietética'] }}\",\n        \"Sodio\": \"{{ $('AiTable Create').item.json.data.records[0].fields.Sodio }}\",\n        \"Calificacion\": {{ $json.clasificacion }},\n        \"Análisis\": \"{{ $json['análisis'] }}\",\n        \"Conclusión\": \"{{ $json['conclusión'] }}\"\n      }\n    }  \n],\n  \"fieldKey\": \"name\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-144,208],"id":"321ad184-53f4-4fa5-8d9d-747cf8585f6e","name":"AiTable Update","credentials":{"httpBearerAuth":{"id":"HurXxMMgbIlJofhu","name":"Aitable"}}}],"connections":{"On form submission":{"main":[[{"node":"IMG to BASE64","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"TEXT to JSON","type":"main","index":0}]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"Basic LLM Chain","type":"ai_languageModel","index":0}]]},"IMG to BASE64":{"main":[[{"node":"GEMMA TEXT EXTRACTOR","type":"main","index":0}]]},"TEXT to JSON":{"main":[[{"node":"AiTable Create","type":"main","index":0}]]},"GEMMA TEXT EXTRACTOR":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Basic LLM Chain":{"main":[[{"node":"TEXT to JSON1","type":"main","index":0}]]},"TEXT to JSON1":{"main":[[{"node":"AiTable Update","type":"main","index":0}]]},"AiTable Create":{"main":[[{"node":"Basic LLM Chain","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"ddd95c2a-b2fd-4b35-8570-093b6de08909","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-28T15:35:35.983Z","updatedAt":"2025-07-28T15:35:35.983Z","role":"workflow:owner","workflowId":"TeTM0TcNLDWxsS5c","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-30T00:42:30.490Z","updatedAt":"2025-07-30T00:45:24.000Z","id":"8tuz497BmAqsKENg","name":"My workflow 9","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[0,0],"id":"50e9718f-06f0-43e0-a242-e6cb6b192d96","name":"When clicking ‘Execute workflow’"},{"parameters":{"url":"https://generativelanguage.googleapis.com/v1beta/models","authentication":"predefinedCredentialType","nodeCredentialType":"googlePalmApi","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[208,0],"id":"f2bfd510-1ca4-45e9-9235-9581a4c4a7a0","name":"HTTP Request","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"e8a9099c-c8e9-4ce8-94c9-2346f7f1e661","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-30T00:42:31.018Z","updatedAt":"2025-07-30T00:42:31.018Z","role":"workflow:owner","workflowId":"8tuz497BmAqsKENg","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-30T01:58:11.210Z","updatedAt":"2025-07-30T01:58:11.210Z","id":"9A0yGIBTwwHMnoRK","name":"My workflow 10","active":false,"isArchived":false,"nodes":[{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"models/gemma-3-4b-it","mode":"list","cachedResultName":"models/gemma-3-4b-it"},"text":"Extrae el reporte de la imagen en un formato estructurado","inputType":"binary","options":{}},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[208,0],"id":"e9b26757-0579-41be-897d-ede4d25892f4","name":"Analyze image","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"formTitle":"prueba","formDescription":"Form","formFields":{"values":[{"fieldLabel":"Img","fieldType":"file"}]},"options":{}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[0,0],"id":"a9f3dcfb-4949-47e0-8a4f-ba324e7b433f","name":"On form submission","webhookId":"364c7892-64c2-4772-b889-53d3bafd7913"}],"connections":{},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"291ff901-ca1b-4abe-a981-cb628b7eac10","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-30T01:58:11.230Z","updatedAt":"2025-07-30T01:58:11.230Z","role":"workflow:owner","workflowId":"9A0yGIBTwwHMnoRK","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-07-30T02:08:44.814Z","updatedAt":"2025-07-30T17:48:37.000Z","id":"WoUzn3EimTQ7iOMe","name":"My workflow 11","active":false,"isArchived":false,"nodes":[{"parameters":{"formTitle":"Demo","formDescription":"Demo","formFields":{"values":[{"fieldLabel":"data","fieldType":"file","multipleFiles":false,"requiredField":true}]},"options":{}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[-608,416],"id":"28bb106a-2ade-4316-9277-dad0afb6fa65","name":"On form submission","webhookId":"4a7056f6-7ef4-488c-9062-656e63ce965c"},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"models/gemma-3-4b-it","mode":"list","cachedResultName":"models/gemma-3-4b-it"},"text":"Extrae la información en la imagen en un json estructurado. Tu respuesta debe sr únicamente un json sin comentarios ni texto extra.","inputType":"binary","options":{}},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[304,-96],"id":"b4f79b13-072a-41bc-9fd2-9b02eb9fb834","name":"Analyze image","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.data.mimetype }}","rightValue":"image/","operator":{"type":"string","operation":"startsWith"},"id":"fc204635-e27e-41e0-87e8-eb27925efa95"}],"combinator":"and"},"renameOutput":true,"outputKey":"IMAGE"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"cb38014e-6315-4a78-b4db-cc6f48d89845","leftValue":"={{ $json.data.mimetype }}","rightValue":"video","operator":{"type":"string","operation":"startsWith"}}],"combinator":"and"},"renameOutput":true,"outputKey":"VIDEO"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"a39810b2-1d23-4f2c-a782-ea535bccebec","leftValue":"={{ $json.data.mimetype }}","rightValue":"audio","operator":{"type":"string","operation":"startsWith"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"49e2ac73-bfba-413d-97e0-847aac7bd275","leftValue":"={{ $json.data.mimetype }}","rightValue":"application/pdf","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"PDF"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"ad70386b-2856-4b51-aed5-dd98d5e8d155","leftValue":"={{ $json.data.mimetype }}","rightValue":"text/plain","operator":{"type":"string","operation":"startsWith"}}],"combinator":"and"},"renameOutput":true,"outputKey":"TXT"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"51038dec-57d2-4935-824f-b2bf4a2291b5","leftValue":"={{ $json.data.mimetype }}","rightValue":"text/csv","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"CSV"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"aa53ec49-d81b-45af-ba59-7e667bd98671","leftValue":"={{ $json.data.mimetype }}","rightValue":"=application/octet-stream","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Markdown"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-384,336],"id":"5fd13d74-7f11-42e9-b539-50fe299e5889","name":"Switch"},{"parameters":{"assignments":{"assignments":[{"id":"768de210-0d28-46d5-a9f8-c7186a3e7000","name":"text","value":"={{ $json.content.parts[0].text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[464,-96],"id":"3351cf72-ab32-43da-bd01-7925538afcbb","name":"Edit Fields"},{"parameters":{"jsCode":"const markdownText = items[0].json.text;\n\n// 1. Elimina ```json y ``` (case-insensitive)\nlet cleaned = markdownText.replace(/```(?:json)?/gi, '').trim();\n\n// 2. Quita comas finales antes de } o ]\ncleaned = cleaned\n  .replace(/,\\s*}/g, '}')\n  .replace(/,\\s*]/g, ']');\n\n// 3. Envuelve en comillas valores que contengan letras (p.ej. 2253kcal)\ncleaned = cleaned.replace(\n  /\"([\\w]+)\":\\s*([^,\"\\}\\]\\r\\n]*[A-Za-z][^,\"\\}\\]\\r\\n]*)(?=\\s*[,\\}])/g,\n  (_match, key, val) => `\"${key}\": \"${val}\"`\n);\n\nlet parsed;\ntry {\n  parsed = JSON.parse(cleaned);\n} catch (e) {\n  throw new Error(\n    'Error al convertir el texto a JSON: ' + e.message +\n    '\\n\\nJSON limpio:\\n' + cleaned\n  );\n}\n\nreturn [\n  {\n    json: parsed\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[624,-96],"id":"4b93a7ea-6c97-46e7-83bc-af6b9282a149","name":"TEXT to JSON"},{"parameters":{"resource":"audio","modelId":{"__rl":true,"value":"models/gemini-2.0-flash","mode":"list","cachedResultName":"models/gemini-2.0-flash"},"inputType":"binary","options":{}},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[304,192],"id":"cc3a7b3c-4418-416c-a69c-0833a7813d7d","name":"Transcribe a recording","retryOnFail":true,"credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"resource":"audio","operation":"analyze","modelId":{"__rl":true,"value":"models/gemini-2.0-flash","mode":"list","cachedResultName":"models/gemini-2.0-flash"},"inputType":"binary","options":{}},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[304,336],"id":"c96a565a-37a4-4444-b0f6-ce07fff4276d","name":"Analyze audio","retryOnFail":true,"credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"resource":"document","modelId":{"__rl":true,"value":"models/gemma-3-4b-it","mode":"list","cachedResultName":"models/gemma-3-4b-it"},"text":"Eres un analista de datos experto en extracción y limpieza de datos para utilizar en db vectoriales.\nExtrae el texto del documento, y formatéalo en un json ordenado. Tu respuesta debe incluir el texto resumido eliminando modismos y otros rasgos que ensucian la data.","inputType":"binary","options":{}},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[304,480],"id":"b334a8d1-ef7e-4cbd-9b4b-e473e5750e18","name":"Analyze document","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"jsCode":"const markdownText = items[0].json.text;\n\n// 1. Elimina ```json y ``` (case-insensitive)\nlet cleaned = markdownText.replace(/```(?:json)?/gi, '').trim();\n\n// 2. Quita comas finales antes de } o ]\ncleaned = cleaned\n  .replace(/,\\s*}/g, '}')\n  .replace(/,\\s*]/g, ']');\n\n// 3. Envuelve en comillas valores que contengan letras (p.ej. 2253kcal)\ncleaned = cleaned.replace(\n  /\"([\\w]+)\":\\s*([^,\"\\}\\]\\r\\n]*[A-Za-z][^,\"\\}\\]\\r\\n]*)(?=\\s*[,\\}])/g,\n  (_match, key, val) => `\"${key}\": \"${val}\"`\n);\n\nlet parsed;\ntry {\n  parsed = JSON.parse(cleaned);\n} catch (e) {\n  throw new Error(\n    'Error al convertir el texto a JSON: ' + e.message +\n    '\\n\\nJSON limpio:\\n' + cleaned\n  );\n}\n\nreturn [\n  {\n    json: parsed\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[640,480],"id":"e6c91e70-703b-4b3c-be0f-3f3deb9945a9","name":"TEXT to JSON1"},{"parameters":{"assignments":{"assignments":[{"id":"768de210-0d28-46d5-a9f8-c7186a3e7000","name":"text","value":"={{ $json.content.parts[0].text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[480,480],"id":"81ff792a-de25-451c-b56c-8423ac7bb003","name":"Edit Fields1"},{"parameters":{"resource":"video","operation":"analyze","modelId":{"__rl":true,"value":"models/gemini-2.5-flash","mode":"list","cachedResultName":"models/gemini-2.5-flash"},"text":"Describe el video","inputType":"binary","options":{}},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[304,48],"id":"972d3867-7160-47d2-a727-1181724c1cfd","name":"Analyze video1","retryOnFail":true,"credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"resource":"document","modelId":{"__rl":true,"value":"models/gemma-3-4b-it","mode":"list","cachedResultName":"models/gemma-3-4b-it"},"text":"Eres un analista de datos experto en extracción y limpieza de datos para utilizar en db vectoriales.\nExtrae el texto del documento, y formatéalo en un json ordenado. Tu respuesta debe incluir el texto resumido eliminando modismos y otros rasgos que ensucian la data.","inputType":"binary","options":{}},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[320,784],"id":"f89cc326-40cd-4932-97fa-b212ba3cd870","name":"Analyze document1","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"jsCode":"return items.flatMap(item => {\n    const markdown = item.json.text; // Obtener el texto markdown del input\n    const startMarker = '```json\\n'; // Marcador de inicio del bloque JSON\n    const endMarker = '\\n```';       // Marcador de fin del bloque JSON\n    \n    // Buscar las posiciones del inicio y fin del bloque JSON\n    const startIndex = markdown.indexOf(startMarker);\n    if (startIndex === -1) {\n        throw new Error(\"No se encontró un bloque de código JSON en el markdown\");\n    }\n    const endIndex = markdown.indexOf(endMarker, startIndex + startMarker.length);\n    if (endIndex === -1) {\n        throw new Error(\"El bloque de código JSON no está terminado correctamente\");\n    }\n    \n    // Extraer el JSON como string y eliminar espacios innecesarios\n    const code = markdown.substring(startIndex + startMarker.length, endIndex).trim();\n    \n    let parsed;\n    try {\n        parsed = JSON.parse(code); // Parsear el string a JSON\n    } catch (error) {\n        throw new Error(`JSON inválido: ${error.message}`);\n    }\n    \n    // Verificar que el JSON parseado sea un arreglo\n    if (!Array.isArray(parsed)) {\n        throw new Error(\"El JSON parseado no es un arreglo\");\n    }\n    \n    // Transformar cada elemento del arreglo en un ítem para n8n\n    return parsed.map(element => ({ json: element }));\n});"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[640,784],"id":"770f9d58-10b4-4ef7-911c-ace691d2e76a","name":"TEXT to JSON2"},{"parameters":{"assignments":{"assignments":[{"id":"768de210-0d28-46d5-a9f8-c7186a3e7000","name":"text","value":"={{ $json.content.parts[0].text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[480,784],"id":"7e62e8b7-ddd3-420e-b722-cd1bb33e535c","name":"Edit Fields2"},{"parameters":{"resource":"document","modelId":{"__rl":true,"value":"models/gemini-2.5-pro","mode":"list","cachedResultName":"models/gemini-2.5-pro"},"text":"Eres un analista de datos experto en extracción y limpieza de datos para utilizar en db vectoriales.\nExtrae el texto del documento, y formatéalo en un json ordenado. Tu respuesta debe incluir el texto resumido eliminando modismos y otros rasgos que ensucian la data.","inputType":"binary","options":{}},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[320,960],"id":"e966b98f-f977-46bd-91bf-0e19c2807061","name":"Analyze document2","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"resource":"document","modelId":{"__rl":true,"value":"models/gemma-3-4b-it","mode":"list","cachedResultName":"models/gemma-3-4b-it"},"text":"Eres un analista de datos experto en extracción y limpieza de datos para utilizar en db vectoriales.\nExtrae el texto del documento, y formatéalo en un json ordenado. Tu respuesta debe incluir el texto resumido eliminando modismos y otros rasgos que ensucian la data.","inputType":"binary","options":{}},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[304,624],"id":"26a712a8-23b4-469b-9335-d8f0a997ad2f","name":"Analyze document3","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"assignments":{"assignments":[{"id":"768de210-0d28-46d5-a9f8-c7186a3e7000","name":"text","value":"={{ $json.content.parts[0].text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[480,624],"id":"d135c8b4-1e82-4c09-9720-b54401d3c657","name":"Edit Fields3"},{"parameters":{"jsCode":"return items.flatMap(item => {\n    const markdown = item.json.text; // Obtener el texto markdown del input\n    const startMarker = '```json\\n'; // Marcador de inicio del bloque JSON\n    const endMarker = '\\n```';       // Marcador de fin del bloque JSON\n    \n    // Buscar las posiciones del inicio y fin del bloque JSON\n    const startIndex = markdown.indexOf(startMarker);\n    if (startIndex === -1) {\n        throw new Error(\"No se encontró un bloque de código JSON en el markdown\");\n    }\n    const endIndex = markdown.indexOf(endMarker, startIndex + startMarker.length);\n    if (endIndex === -1) {\n        throw new Error(\"El bloque de código JSON no está terminado correctamente\");\n    }\n    \n    // Extraer el JSON como string y eliminar espacios innecesarios\n    const code = markdown.substring(startIndex + startMarker.length, endIndex).trim();\n    \n    let parsed;\n    try {\n        parsed = JSON.parse(code); // Parsear el string a JSON\n    } catch (error) {\n        throw new Error(`JSON inválido: ${error.message}`);\n    }\n    \n    // Verificar que el JSON parseado sea un arreglo\n    if (!Array.isArray(parsed)) {\n        throw new Error(\"El JSON parseado no es un arreglo\");\n    }\n    \n    // Transformar cada elemento del arreglo en un ítem para n8n\n    return parsed.map(element => ({ json: element }));\n});"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[640,624],"id":"5ad632a5-a9ae-46a4-8a00-9d20b5e7e862","name":"TEXT to JSON3"}],"connections":{"On form submission":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Analyze image","type":"main","index":0}],[{"node":"Analyze video1","type":"main","index":0}],[{"node":"Analyze audio","type":"main","index":0},{"node":"Transcribe a recording","type":"main","index":0}],[{"node":"Analyze document","type":"main","index":0}],[{"node":"Analyze document3","type":"main","index":0}],[{"node":"Analyze document1","type":"main","index":0}],[{"node":"Analyze document2","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"TEXT to JSON","type":"main","index":0}]]},"Analyze image":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Transcribe a recording":{"main":[[]]},"Analyze document":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"TEXT to JSON1","type":"main","index":0}]]},"Analyze document1":{"main":[[{"node":"Edit Fields2","type":"main","index":0}]]},"Edit Fields2":{"main":[[{"node":"TEXT to JSON2","type":"main","index":0}]]},"Analyze document2":{"main":[[]]},"Analyze document3":{"main":[[{"node":"Edit Fields3","type":"main","index":0}]]},"Edit Fields3":{"main":[[{"node":"TEXT to JSON3","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"6c76d7d5-52fb-4583-8a0c-cd6e650bc0e5","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-07-30T02:08:44.846Z","updatedAt":"2025-07-30T02:08:44.846Z","role":"workflow:owner","workflowId":"WoUzn3EimTQ7iOMe","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-01T01:10:00.387Z","updatedAt":"2025-08-01T16:07:00.000Z","id":"XmwEy9UqvIS1qYvR","name":"wo_load image","active":false,"isArchived":false,"nodes":[{"parameters":{"formTitle":"image","formDescription":"image","formFields":{"values":[{"fieldLabel":"data","fieldType":"file","acceptFileTypes":".jpg, .png","requiredField":true}]},"options":{}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[-192,-240],"id":"bdf271ad-5f8b-432b-8142-ee01ecbaa11f","name":"On form submission","webhookId":"678e36f6-3a04-4479-898b-9c0f8707e450"},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"models/gemma-3-27b-it","mode":"list","cachedResultName":"models/gemma-3-27b-it"},"text":"Para la siguinete imagen responde unica emnte con un Json como el del ejemplo:\n{\n    \"title\": \"Mi imagen de prueba\",\n    \"alt_text\": \"Una imagen muy bonita\",\n    \"caption\": \"Esta es la leyenda\",\n    \"descripción\": \"Descripción completa de la imagen subida\"\n  }\n\nTu respuesta debe ser estrictamente un json sin markdown, y cada valor debe ser generado a partir de la información obtenida de la imagen","imageUrls":"={{ $json.guid.rendered }}","options":{}},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[96,-240],"id":"fa779f7c-aae3-44ab-9867-dcc4310035c6","name":"Analyze image","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"assignments":{"assignments":[{"id":"643e0845-e08e-4a98-bb0b-66c319bffc23","name":"text","value":"={{ $json.content.parts[0].text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-176,-32],"id":"e50e4db3-144a-4b09-86d6-d5f32ffaf2ae","name":"Edit Fields"},{"parameters":{"jsCode":"// Entrada: [{\"text\": \"```json\\n{...}\\n```\"}]\n// Objetivo: limpiar el bloque de código y parsearlo a objeto JSON\n\nconst rawText = items[0].json.text;\n\n// Elimina las marcas de bloque de código (```json ... ```)\nconst cleanedText = rawText.replace(/```json\\s*|\\s*```/g, '');\n\n// Intenta parsear el JSON\nlet parsed;\ntry {\n  parsed = JSON.parse(cleanedText);\n} catch (err) {\n  throw new Error('Error al parsear JSON: ' + err.message);\n}\n\n// Devuelve el objeto JSON limpio como salida\nreturn [{ json: parsed }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-32,-32],"id":"77586d64-baa8-45c8-894d-429caa903c9e","name":"Code"},{"parameters":{"method":"POST","url":"http://localhost:8881/wp-json/wp/v2/media","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Disposition","value":"=attachment; filename={{ $('On form submission').item.json.data[0].filename }}"}]},"sendBody":true,"contentType":"binaryData","inputDataFieldName":"data","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-48,-240],"id":"0a99bc4e-e309-43d1-956a-a04946b21107","name":"Cargar_MEDIA","credentials":{"httpBasicAuth":{"id":"jXchQ4VYl9TuF48c","name":"WP_local"}}},{"parameters":{"method":"POST","url":"=http://localhost:8881/wp-json/wp/v2/media/{{ $('Cargar_MEDIA').item.json.id }}","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendHeaders":true,"headerParameters":{"parameters":[{}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"title\": \"{{ $json.title }}\",\n  \"alt_text\": \"{{ $json.alt_text }}\",\n  \"caption\": \"{{ $json.caption }}\",\n  \"description\": \"{{ $json['descripción'] }}\"\n} ","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[112,-32],"id":"fc6864fa-9e88-4201-a6f4-29668b55012f","name":"Actualizar_MEDIA","credentials":{"httpBasicAuth":{"id":"jXchQ4VYl9TuF48c","name":"WP_local"}}}],"connections":{"On form submission":{"main":[[{"node":"Cargar_MEDIA","type":"main","index":0}]]},"Analyze image":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Actualizar_MEDIA","type":"main","index":0}]]},"Cargar_MEDIA":{"main":[[{"node":"Analyze image","type":"main","index":0}]]},"Actualizar_MEDIA":{"main":[[]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"1fa3ea1d-f72b-4e5f-bea9-1e412f6a40f6","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-08-01T01:10:07.596Z","updatedAt":"2025-08-01T01:10:07.596Z","role":"workflow:owner","workflowId":"XmwEy9UqvIS1qYvR","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-05T15:11:33.689Z","updatedAt":"2025-08-05T15:11:33.689Z","id":"LWp8ajGfEKG77qe8","name":"My workflow 12","active":false,"isArchived":false,"nodes":[{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-nano-2025-04-14","cachedResultName":"gpt-4.1-nano-2025-04-14"},"options":{}},"id":"8903b392-de70-4c05-87ea-86b9009bea4e","name":"OpenAI Chat Model1","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[3120,544],"typeVersion":1.2},{"parameters":{"promptType":"define","text":"={{ $json.message.text }}","options":{"systemMessage":"=Hoje é {{$now}}\nPAPEL:  \nVocê é um assistente interno de reagendamento na clínica, acionado diretamente por um profissional via Telegram para gerenciar situações de remarcação de consultas ou incluir lembretes na lista de compras.\n\nOBJETIVO GERAL:  \n1. Reagendar consultas a pedido do profissional.  \n2. Adicionar lembretes na lista de compras quando solicitado.  \n\nRESUMO DE RESPONSABILIDADES:  \n1. Reagendamento de pacientes  \n   - Acesse o Google Calendar por meio da ferramenta \"MCP Google Calendar\" para identificar as consultas afetadas.  \n   - Extraia o número de telefone na descrição do evento.  \n   - Use a ferramenta \"Reagendar no WhatsApp\" para enviar mensagens de reagendamento aos pacientes.  \n   - Lembre-se de que você apenas envia a mensagem; a resposta do paciente é tratada por outro agente.  \n\n2. Lista de compras da clínica  \n   - Se o profissional solicitar pelo Telegram a inclusão de um item na lista de compras, utilize a ferramenta \"Google Tasks\" para adicionar o lembrete.  \n\nORIENTAÇÕES DE LINGUAGEM E PROCEDIMENTO:  \n- Use uma abordagem empática, profissional e acolhedora.  \n- Nunca envie mensagens para pacientes sem autorização explícita do profissional.  \n- Quando listar eventos ou tarefas, seja objetivo e organizado.  \n- Mantenha clareza e concisão em todas as interações.  \n\nFERRAMENTAS DISPONÍVEIS:  \n- Reagendar no WhatsApp  \n- Google Tasks  \n- MCP Google Calendar  \n\nINSTRUÇÕES FINAIS:  \n- Atenda exclusivamente às solicitações de reagendamento e inclusão de lembretes.  \n- A remarcação de consultas ocorre somente quando o profissional pede, utilizando o MCP Google Calendar para identificar os pacientes e o \"Reagendar no WhatsApp\" para enviar a mensagem.  \n- Para a lista de compras, sempre registre no \"Google Tasks\".  \n"}},"id":"d033a4c9-2570-445f-bfa8-537de1fb2fad","name":"Assistente clinica interno","type":"@n8n/n8n-nodes-langchain.agent","position":[3232,304],"typeVersion":1.8},{"parameters":{"task":"bDQ5ZlNVV2lPQ3pYT3NsNA","title":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Title', ``, 'string') }}","additionalFields":{"notes":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Notes', ``, 'string') }}","status":"needsAction"}},"id":"03d12c4b-50bc-4425-b856-8e17ddc67114","name":"Google Tasks","type":"n8n-nodes-base.googleTasksTool","position":[3568,592],"typeVersion":1},{"parameters":{"sseEndpoint":"https://engaging-seahorse-19.rshare.io/mcp/ceb17fa5-1937-405f-8000-ea3be7d2b032/mcp/:tool/calendar/sse"},"id":"71afb516-77dc-4082-8450-b2ce050ed54c","name":"MCP Google Calendar","type":"@n8n/n8n-nodes-langchain.mcpClientTool","position":[3408,592],"typeVersion":1},{"parameters":{"updates":["message"],"additionalFields":{}},"id":"1f5f1e8d-4455-4cc2-bb6d-a98ce3f98dcc","name":"Receber Mensagem Telegram","type":"n8n-nodes-base.telegramTrigger","position":[2960,304],"webhookId":"f2b29356-d5d3-4f5d-9ef1-273001c0a820","typeVersion":1.2},{"parameters":{"sessionIdType":"customKey","sessionKey":"100","contextWindowLength":10},"id":"3db07a37-fb53-47ce-b713-c31896273d8e","name":"Postgres Chat Memory","type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","position":[3280,576],"typeVersion":1.3},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini-2025-04-14","cachedResultName":"gpt-4.1-mini-2025-04-14"},"options":{}},"id":"53829ca8-3d1b-4cab-9789-e29ae4e5365f","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[720,2256],"typeVersion":1.2},{"parameters":{"promptType":"define","text":"={{ $json.text }}{{ $json.output}}","options":{"systemMessage":"=HOJE É: {{ $now }}\nCONTATO DA CLÍNICA: \n{ coloque o seu contato aqui }\n\nINSTRUÇÃO IMPORTANTE:\n\nAo criar ou editar qualquer evento via MCP_CALENDAR, inclua na descrição do agendamento:\n\nTelefone do paciente\n\nNome completo\n\nData de nascimento\n\nInformações adicionais (convênio, condição de saúde etc.)\n\nPAPEL:\nVocê é uma atendente do WhatsApp da Clínica Moreira, especializada em atendimento humanizado. Sua missão:\n\nAtender pacientes de forma ágil e eficiente\n\nResponder dúvidas sobre clínica e serviços\n\nAgendar, remarcar e cancelar consultas pelo MCP_CALENDAR\n\nPERSONALIDADE E TOM DE VOZ:\n\nSimpática, acolhedora e respeitosa\n\nFormal, sem emojis ou gírias\n\nFERRAMENTAS DISPONÍVEIS:\n\nMCP_CALENDAR (trigger /mcp/:tool/calendar)\n\nAVALIABILITY_CALENDAR: verifica horários livres entre Start_Time e End_Time\n\nGET_ALL_CALENDAR: lista todos os eventos entre After e Before\n\nCREATE_CALENDAR: cria novo evento com start, end e Description (inclua sempre telefone, nome e data de nascimento)\n\nUPDATE_CALENDAR: atualiza campos de um evento existente (Event_ID)\n\nDELETE_CALENDAR: remove evento (Event_ID)\n\nGET_CALENDAR: obtém detalhes de um evento específico (Event_ID)\n\nCallToHuman (workflow id A95kslcW4H82nJuR)\n\nEncaminha atendimento humano via EvolutionAPI em n8n\n\nDisparar IMEDIATAMENTE quando:\n\nUrgência ou mal-estar grave\n\nPedido de diagnóstico/opinião médica\n\nInsatisfação expressa do paciente\n\nAssuntos fora do escopo da clínica\n\nExemplo de chamada:\n\n{\n  \"tool\": \"CallToHuman\",\n  \"telefone\": \"<telefone>\",\n  \"nome\": \"<nome completo>\",\n  \"ultima_mensagem\": \"<texto da última mensagem>\"\n}\n\nEnviar telegram cancelamento\n\nApós DELETE_CALENDAR, envie ao gestor via Telegram: nome, data, hora\n\nSOP (Fluxo de Atendimento):\n\nInício e coleta de dados\n\nCumprimente e informe o link da agenda: https://calendar.google.com/calendar/embed?src=a57a3781407f42b1ad7fe24ce76f558dc6c86fea5f349b7fd39747a2294c1654%40group.calendar.google.com&ctz=America%2FArgentina%2FBuenos_Aires\n\nPeça: nome completo, data de nascimento e confirme o telefone\n number: {{ $('Webhook1').item.json.body.data.key.remoteJid.replaceAll(\"@s.whatsapp.net\",\"\") }}\n\nVerificação de disponibilidade\n\nPergunte data e turno preferidos\n\nChame AVALIABILITY_CALENDAR com Start_Time 08:00 e End_Time 19:00 (ou turno)\n\nInforme horários livres\n\nAgendamento\n\nApós escolha do paciente, use CREATE_CALENDAR com start, end e Description\n\nAguarde retorno para confirmar criação antes de responder\n\nRemarcação\n\nSolicite dados e nova preferência de data/turno\n\nLocalize evento antigo via GET_ALL_CALENDAR\n\nUse DELETE_CALENDAR no Event_ID antigo\n\nCrie novo com CREATE_CALENDAR\n\nConfirme após sucesso\n\nCancelamento\n\nSolicite dados do paciente\n\nIdentifique Event_ID via GET_ALL_CALENDAR ou GET_CALENDAR\n\nExecute DELETE_CALENDAR\n\nUse Enviar telegram cancelamento\n\nConfirme cancelamento ao paciente\n\nConfirmação de consulta (follow-up)\n\nSe paciente responder “Confirmar, ID”: use UPDATE_CALENDAR para prefixar título com [Confirmado]\n\nSe “Reagendar, ID”: DELETE_CALENDAR e oriente para usar link da agenda\n\nREGRAS DE ESCALONAMENTO:\n\nUse CallToHuman IMEDIATAMENTE em situações de:\n\nUrgência/mal-estar\n\nPedidos de diagnóstico/opinião médica\n\nInsatisfação ou reclamações\n\nAssuntos fora do escopo\n\nMANTENHA SEMPRE:\n\nTom profissional e respeitoso\n\nLinguagem clara e objetiva\n\nAgendamentos apenas em datas futuras\n\nNunca confirmar sem retorno do MCP_CALENDAR\n\nHORÁRIOS DE FUNCIONAMENTO:\n\nSeg–Sáb: 08h–19h | Dom e feriados: fechado\n\nLOCALIZAÇÃO:\nRua Rio Casca, 417 – Belo Horizonte, MG\n\nLINK DA AGENDA:\nhttps://calendar.google.com/calendar/embed?src=a57a3781407f42b1ad7fe24ce76f558dc6c86fea5f349b7fd39747a2294c1654%40group.calendar.google.com&ctz=America%2FArgentina%2FBuenos_Aires\n\n"}},"id":"91cb9936-5915-4d51-a3e5-573eadc49fd4","name":"Assistente Clínica","type":"@n8n/n8n-nodes-langchain.agent","position":[816,2032],"retryOnFail":true,"typeVersion":1.8,"waitBetweenTries":1000},{"parameters":{"chatId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Chat_ID', ``, 'string') }}","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Text', ``, 'string') }}","additionalFields":{}},"id":"091a8141-c345-4237-9935-cfd8b5d42a7c","name":"Enviar alerta de cancelamento","type":"n8n-nodes-base.telegramTool","position":[1248,2256],"webhookId":"d045a8c1-ec1b-4d20-8226-457aa18934af","typeVersion":1.2},{"parameters":{"rule":{"interval":[{"field":"cronExpression","expression":"0 8 * * 1-5"}]}},"id":"8ef88861-2fd9-4652-9e1c-a955d22474b9","name":"Gatilho diário","type":"n8n-nodes-base.scheduleTrigger","position":[2912,1056],"typeVersion":1.2},{"parameters":{"promptType":"define","text":"=Hoje é {{ $now }}. Você é um agente especializado em **confirmação de consultas** para a clínica. Sua função principal é:\n\n1. **Listar os eventos** agendados para o próximo dia no MCP Calendar.\n2. **Obter o numero** na descrição de cada evento.\n3. **Enviar uma mensagem de confirmação** usando a ferramenta “relembraAGENDAMENTO”, perguntando se o paciente confirma a consulta ou prefere reagendar.\n\nImportante:\n- Você **não recebe respostas** diretamente; o retorno do paciente é tratado por outro agente.\n\n","options":{"systemMessage":""}},"id":"a9e5d4e2-eef5-4941-b84f-03fd28b0611a","name":"Assistente de confirmação","type":"@n8n/n8n-nodes-langchain.agent","position":[3136,960],"typeVersion":1.8},{"parameters":{"promptType":"define","text":"={{ $json.output }}","options":{"systemMessage":"=Você é especialista em formatação de mensagem para whataspp, trabalhando somente na formatação e não alterando o conteúdo da menssagem.\n\n- Substitua ** por *\n- Remova #"}},"id":"e1e0bd24-6dd1-4125-a470-92e49dd88eca","name":"AI Agent","type":"@n8n/n8n-nodes-langchain.agent","position":[688,2736],"typeVersion":1.8},{"parameters":{"content":"# \"Appointment Confirmation Assistant\"\nDescription:\n\nPurpose:\nThis section contains the configuration for the Appointment Confirmation Assistant, an agent specialized in confirming scheduled appointments with patients.\n\nInstructions for Use:\n\nIt is triggered automatically every weekday (Monday to Friday) at 08:00 AM via the Daily Trigger (Gatilho diário).\n\nThe agent retrieves all appointments scheduled for the next day using MCP Google Calendar.\n\nIt extracts each patient's phone number from the event description field.\n\nA confirmation message is sent to each patient using the relembraAGENDAMENTO tool, asking for confirmation or rescheduling.\n\nImportant: This agent does not handle responses from patients; another agent or workflow is responsible for follow-ups.\n\nMake sure event descriptions in Google Calendar are correctly filled to avoid errors.\n\n","height":600,"width":1940,"color":5},"id":"b25246d7-0822-4f91-8a3c-7dd5f6d7cca5","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[1808,864],"typeVersion":1},{"parameters":{"content":"# \"Agent Core Components (Tools, MCP, Memory, LLM Model)\"\nDescription:\n\nPurpose:\n\nThis sticky note represents the essential structure of any intelligent agent: it includes access to external tools,\n persistent memory, the MCP system for calendar management, and a Language Model (LLM) to process natural language tasks.\n\nInstructions for Use:\n\nLanguage Model nodes (OpenAI, OpenRouter) are responsible for natural language understanding and generation.\n\nMemory nodes (Postgres Chat Memory) maintain conversation context over multiple interactions.\n\nMCP Tools interact with Google Calendar and other services to perform real-world actions.\n\nAlways ensure memory synchronization between the agent's context and actions performed.\n\nIf new tools are added, they must be connected both to the agent and properly described in the system message.\n\n","height":640,"width":1780,"color":3},"id":"7bab9b64-25e3-4c76-850c-14a41c877271","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[-400,1904],"typeVersion":1},{"parameters":{"content":"# \"Processing and Sending WhatsApp Responses\"\nDescription:\n\nPurpose:\nThis section is responsible for processing, formatting, and sending outbound WhatsApp messages to patients through the Evolution API.\n\nInstructions for Use:\n\nMessages received from the assistant agent are first reformatted by the AI Agent node to comply with WhatsApp markdown syntax (e.g., replacing **bold** with *bold*).\n\nOnce formatted, the messages are forwarded to WhatsApp using the Evolution API2 node.\n\nEnsure proper formatting before sending to maintain a professional communication tone and avoid delivery errors.\n\nAny future text-processing improvements should be implemented here.","height":640,"width":1800,"color":4},"id":"279ce31d-e6f4-4f86-aebe-88f319cf1d90","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[-512,2576],"typeVersion":1},{"parameters":{"sessionIdType":"customKey","sessionKey":"= {{ $('Webhook1').item.json.body.data.key.id }}","contextWindowLength":50},"id":"a2f427cc-66c2-4827-ad87-67db08f4de7b","name":"Postgres Chat Memory1","type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","position":[848,2256],"typeVersion":1.3},{"parameters":{"sseEndpoint":"https://engaging-seahorse-19.rshare.io/mcp/ceb17fa5-1937-405f-8000-ea3be7d2b032/mcp/:tool/calendar/sse"},"id":"3c3c2682-80a3-47ad-bccf-ee69aaac38f2","name":"MCP Google Calendar2","type":"@n8n/n8n-nodes-langchain.mcpClientTool","position":[976,2256],"typeVersion":1},{"parameters":{"sseEndpoint":"https://engaging-seahorse-19.rshare.io/mcp/82a7a338-618c-44f5-a1c3-f2e32b6b4833/mcp/:tool/gmail/sse"},"id":"5fb89dce-2ac5-4dbc-a3a0-0cba79df6ffd","name":"MCP GMAIL","type":"@n8n/n8n-nodes-langchain.mcpClientTool","position":[3392,1280],"typeVersion":1},{"parameters":{"sseEndpoint":"https://engaging-seahorse-19.rshare.io/mcp/ceb17fa5-1937-405f-8000-ea3be7d2b032/mcp/:tool/calendar/sse"},"id":"fd945e1c-66f5-42c2-b0dc-e534be13f2ba","name":"MCP CALENDAR","type":"@n8n/n8n-nodes-langchain.mcpClientTool","position":[3232,1280],"typeVersion":1},{"parameters":{"chatId":"={{ $('Receber Mensagem Telegram').item.json.message.chat.id }}","text":"={{ $json.output }}","additionalFields":{}},"id":"bc30fa7a-00f1-4347-9af2-badb0ce27996","name":"Telegram","type":"n8n-nodes-base.telegram","position":[3600,304],"webhookId":"5bba05fc-2859-4225-aa85-7c4bc5ff532d","typeVersion":1.2},{"parameters":{"model":"google/gemini-2.0-flash-exp:free","options":{}},"id":"6a468e76-6a50-452b-9d92-f81efd9cd53a","name":"OpenRouter Chat Model1","type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","position":[608,2960],"typeVersion":1},{"parameters":{"httpMethod":"POST","path":"evolutionAPIKORE","options":{}},"id":"a25ef6f5-6a6f-4476-9340-983dbc6c1310","name":"Webhook1","type":"n8n-nodes-base.webhook","position":[608,384],"webhookId":"405dab7c-a0ea-4f5b-a6cc-ede9d5ba78a0","typeVersion":2},{"parameters":{"assignments":{"assignments":[{"id":"3e6335ae-74c3-4655-b68f-cdf0c68b864f","name":"number","type":"string","value":"={{ $json.body.data.key.remoteJid }}"},{"id":"15f399cf-a98e-45e7-91ce-61b4fad340fd","name":"name","type":"string","value":"={{ $json.body.data.pushName }}"},{"id":"b1943003-1f47-40e1-b418-6a52557ec44e","name":"key_id","type":"string","value":"={{ $json.body.data.key.id }}"},{"id":"ed23194b-22ca-455b-a085-7dae706d0569","name":"text","type":"string","value":"={{ $json.body.data.message.conversation }}"},{"id":"b35f8b61-da15-42e3-a078-4cd901e1f273","name":"type","type":"string","value":"={{ $json.body.data.message.imageMessage.mimetype }}"},{"id":"a62bf96a-51aa-44c3-9e5d-f592e32a31d6","name":"image.url","type":"string","value":"={{ $json.body.data.message.imageMessage.url }}"},{"id":"b004987d-3527-4040-a5e6-5fe06b25c9b9","name":"audio.url","type":"string","value":"={{ $json.body.data.message.audioMessage.url }}"},{"id":"4c2cc03a-c104-4a87-9d31-6a7c256890ad","name":"document.url","type":"string","value":"={{ $json.body.data.message.documentMessage.url }}"}]},"options":{}},"id":"c3755d73-894b-45ec-9d9d-aacc149af3fb","name":"Edit Fields1","type":"n8n-nodes-base.set","position":[848,384],"typeVersion":3.4},{"parameters":{"rules":{"values":[{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"2f9854ac-26b3-446c-9d0d-ae25157c61bb","operator":{"type":"string","operation":"notEmpty","singleValue":true},"leftValue":"={{ $json.text }}","rightValue":"="}]},"renameOutput":true,"outputKey":"text"},{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"73b7d93a-928e-42ec-9c8e-ae8e9b97a867","operator":{"type":"string","operation":"notEmpty","singleValue":true},"leftValue":"={{ $json.image.url }}","rightValue":"="}]},"renameOutput":true,"outputKey":"image"},{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"2f9915b9-e2b4-4528-ad36-515a848ab1be","operator":{"type":"string","operation":"notEmpty","singleValue":true},"leftValue":"={{ $json.audio.url }}","rightValue":"[null]"}]},"renameOutput":true,"outputKey":"audio"},{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"9fcbe89a-c9d7-4dc6-bb6f-27c1cacbfddc","operator":{"type":"string","operation":"notEmpty","singleValue":true},"leftValue":"={{ $json.document.url }}","rightValue":"[null]"}]},"renameOutput":true,"outputKey":"document"}]},"options":{}},"id":"a1112a87-350d-43b6-9631-f827e0a8d499","name":"Switch","type":"n8n-nodes-base.switch","position":[1088,352],"typeVersion":3.2},{"parameters":{"content":"# Incoming WhatsApp Webhook and Message Type Handling\"\nDescription:\n\nPurpose:\nManages the initial reception and classification of incoming WhatsApp messages from patients via the webhook system.\n\nInstructions for Use:\n\nThe Webhook1 node captures incoming messages.\n\nEdit Fields1 extracts structured fields such as text, image URL, audio URL, and document URL.\n\nSwitch node analyzes which type of content was received and directs the flow accordingly:\n\nText → Forwarded to the assistant for handling.\n\nImage → Sent for OCR analysis.\n\nAudio → Sent for transcription.\n\nDocument → (Currently unused, but ready for future workflows).\n\nKeep webhook credentials updated to ensure system reliability.\n\n","height":640,"width":1580,"color":6},"id":"94c0158d-9588-4c75-a9f7-f1080f09b400","name":"Sticky Note5","type":"n8n-nodes-base.stickyNote","position":[-192,112],"typeVersion":1},{"parameters":{"resource":"audio","operation":"transcribe","binaryPropertyName":"=data","options":{}},"id":"27d1f542-93a7-474a-b00a-c8e218d83b4b","name":"OpenAI","type":"@n8n/n8n-nodes-langchain.openAi","position":[1232,1536],"typeVersion":1.8},{"parameters":{},"id":"9ca960e0-9ecf-4745-8eaa-ad8ffdc8b8bc","name":"Evolution API","type":"n8n-nodes-evolution-api.evolutionApi","position":[720,1536],"typeVersion":1,"credentials":{}},{"parameters":{"operation":"toBinary","sourceProperty":"data.base64","options":{}},"id":"59c6a03d-f126-4cdc-aae3-be45375b2312","name":"Convert to File","type":"n8n-nodes-base.convertToFile","position":[960,1536],"typeVersion":1.1},{"parameters":{"content":"## \"Download Audio and Convert to MP4\"\nDescription:\n\nPurpose:\nHandles retrieval, conversion, and transcription of audio files sent by patients via WhatsApp.\n\nInstructions for Use:\n\nEvolution API downloads the audio in base64 format.\n\nConvert to File transforms base64 into a binary file compatible with transcription engines.\n\nOpenAI Whisper API (via OpenAI node) transcribes the audio into text, preparing it for natural language processing.\n\nEnsure audio formats are correctly handled (e.g., MP4/MP3) to avoid conversion or transcription failures.\n\nMonitor for potential heavy file size issues (>25MB) which may impact performance.","height":480,"width":1760},"id":"73415d64-dfd7-4137-ba2d-e024d17966b4","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[-176,1376],"typeVersion":1},{"parameters":{"content":"# \"Extract Text from Images\"\nDescription:\n\nPurpose:\nProcesses images received via WhatsApp to extract text (OCR) and describe their visual content for further contextual analysis.\n\nInstructions for Use:\n\nThe OpenAI1 node uses a Vision model to transcribe and describe any text or scene from incoming images.\n\nThe resulting data is interpreted by the AI Agent2, which prepares insights and recommends appropriate responses.\n\nImage-to-text extraction is especially useful for handling prescriptions, notes, or medical documents sent by patients.\n\nMaintain quality standards: images must be clear and high-resolution for best transcription results.","height":480,"width":1820},"id":"6b0dbf83-d9a5-414b-a46e-401c31dcf0c3","name":"Sticky Note6","type":"n8n-nodes-base.stickyNote","position":[-240,816],"typeVersion":1},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"mode":"list","value":"chatgpt-4o-latest","cachedResultName":"CHATGPT-4O-LATEST"},"text":"TRANSCRIBE OS TEXTOS e describe a imagem","imageUrls":"={{ $json.image }}","options":{}},"id":"2f9231b0-c7c0-4d77-90aa-e0e92fc7c317","name":"OpenAI1","type":"@n8n/n8n-nodes-langchain.openAi","position":[832,896],"typeVersion":1.8},{"parameters":{"promptType":"define","text":"={{$json.output}}","options":{"systemMessage":"voce e encarregado de analizar o texto proveniente do analisis de uma iamgem ela pode conter texto, a ideia e que voce explique ao proximo agente como debe responder as mensagens"}},"id":"0f665fe4-e7d5-4c49-856b-2a5c277cbbc6","name":"AI Agent2","type":"@n8n/n8n-nodes-langchain.agent","position":[1056,896],"typeVersion":1.9},{"parameters":{"model":"google/gemini-2.5-pro-exp-03-25:free","options":{}},"id":"819b0139-0dd9-4e5f-9fc2-0617a413031b","name":"OpenRouter Chat Model2","type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","position":[960,1136],"typeVersion":1},{"parameters":{},"id":"54941856-57a2-41ab-b4cd-55aaebc712a6","name":"Evolution API2","type":"n8n-nodes-evolution-api.evolutionApi","position":[1056,2736],"typeVersion":1,"credentials":{}},{"parameters":{"content":"## \"Internal Clinic Assistant\"\nDescription:\n\nPurpose:\nRepresents the Internal Assistant for the clinic, used exclusively by the internal team via Telegram to manage patient rescheduling and manage a purchasing reminder list.\n\nInstructions for Use:\n\nTriggered by staff messages sent via Telegram.\n\nRescheduling tasks:\n\nAccess the MCP Google Calendar to locate and manage appointments.\n\nExtract patient contact from the event description.\n\nSend rescheduling messages through WhatsApp using the dedicated tool.\n\nShopping list tasks:\n\nInsert shopping list reminders into Google Tasks based on the staff's instructions.\n\nAlways maintain professional and empathetic tone when interacting with patients, even if the communication is indirect.\n\nAvoid unauthorized direct patient contact without staff permission.","height":680,"width":1960},"id":"76ffbb44-4372-426d-95b8-22295fd45e3c","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","position":[1808,112],"typeVersion":1},{"parameters":{"name":"escalar_humano","description":"=Use essa ferramenta ao perceber que o paciente fala de:\n- Situações urgentes (sentindo-se mal, etc.)\n- Assuntos não relacionados à clínica\n- Insatisfação extrema ou pedidos de falar com um humano\n","workflowId":{"__rl":true,"mode":"list","value":"A95kslcW4H82nJuR","cachedResultName":"callToHuman"},"workflowInputs":{"value":{"nome":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nome', ``, 'string') }}","telefone":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('telefone', ``, 'string') }}","ultima_mensagem":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('ultima_mensagem', ``, 'string') }}"},"schema":[{"id":"telefone","type":"string","display":true,"required":false,"displayName":"telefone","defaultMatch":false,"canBeUsedToMatch":true},{"id":"nome","type":"string","display":true,"required":false,"displayName":"nome","defaultMatch":false,"canBeUsedToMatch":true},{"id":"ultima_mensagem","type":"string","display":true,"required":false,"displayName":"ultima_mensagem","defaultMatch":false,"canBeUsedToMatch":true}],"mappingMode":"defineBelow","matchingColumns":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"id":"8e922b3d-4f90-4ec6-9f11-6f6a65366229","name":"CallToHuman","type":"@n8n/n8n-nodes-langchain.toolWorkflow","position":[1088,2272],"typeVersion":2.1},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini","cachedResultName":"gpt-4.1-mini"},"options":{}},"id":"33fd4c88-8722-48aa-9f36-fcc88c361e37","name":"OpenAI Chat Model2","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[3120,1120],"typeVersion":1.2},{"parameters":{},"id":"d603cbec-82a8-4fd5-8d43-2ec786bd2d32","name":"REMINDER","type":"n8n-nodes-evolution-api.evolutionApi","position":[3488,976],"typeVersion":1,"credentials":{}}],"connections":{"OpenAI":{"main":[[{"node":"Assistente Clínica","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Assistente Clínica","type":"main","index":0}],[{"node":"OpenAI1","type":"main","index":0}]]},"OpenAI1":{"main":[[{"node":"AI Agent2","type":"main","index":0}]]},"Webhook1":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"AI Agent2":{"main":[[{"node":"Assistente Clínica","type":"main","index":0}]]},"MCP GMAIL":{"ai_tool":[[{"node":"Assistente de confirmação","type":"ai_tool","index":0}]]},"CallToHuman":{"ai_tool":[[{"node":"Assistente Clínica","type":"ai_tool","index":0}]]},"Edit Fields1":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Google Tasks":{"ai_tool":[[{"node":"Assistente clinica interno","type":"ai_tool","index":0}]]},"MCP CALENDAR":{"ai_tool":[[{"node":"Assistente de confirmação","type":"ai_tool","index":0}]]},"Convert to File":{"main":[[{"node":"OpenAI","type":"main","index":0}]]},"Gatilho diário":{"main":[[{"node":"Assistente de confirmação","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Assistente Clínica","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Assistente clinica interno","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"Assistente de confirmação","type":"ai_languageModel","index":0}]]},"Assistente Clínica":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"MCP Google Calendar":{"ai_tool":[[{"node":"Assistente clinica interno","type":"ai_tool","index":0}]]},"MCP Google Calendar2":{"ai_tool":[[{"node":"Assistente Clínica","type":"ai_tool","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"Assistente clinica interno","type":"ai_memory","index":0}]]},"Postgres Chat Memory1":{"ai_memory":[[{"node":"Assistente Clínica","type":"ai_memory","index":0}]]},"OpenRouter Chat Model1":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"OpenRouter Chat Model2":{"ai_languageModel":[[{"node":"AI Agent2","type":"ai_languageModel","index":0}]]},"Receber Mensagem Telegram":{"main":[[{"node":"Assistente clinica interno","type":"main","index":0}]]},"Assistente clinica interno":{"main":[[{"node":"Telegram","type":"main","index":0}]]},"Enviar alerta de cancelamento":{"ai_tool":[[{"node":"Assistente Clínica","type":"ai_tool","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{"Webhook1":[{"json":{"body":{"data":{"key":{"id":"05D218BDE5BFC8378B5AA50BA87FDAFE","fromMe":false,"remoteJid":"5491169701682@s.whatsapp.net"},"source":"android","status":"DELIVERY_ACK","message":{"conversation":"Sim","messageContextInfo":{"messageSecret":"RdahuRio1gbaHLsCeV24k8yFFyJWGpAJ5zHYRc2QysU=","deviceListMetadata":{"recipientKeyHash":"KgcEIs2I9kXQgQ==","recipientTimestamp":"1745501413"},"deviceListMetadataVersion":2}},"pushName":"Luciano","instanceId":"317a031e-567d-4c2e-9bc4-146616fe4db7","messageType":"conversation","messageTimestamp":1745501855},"event":"messages.upsert","apikey":"59BA76B6BD78-403B-A0CC-8735B6A7ED3A","sender":"553191282843@s.whatsapp.net","instance":"kore","date_time":"2025-04-24T10:37:35.514Z","server_url":"http://localhost:8080","destination":"https://engaging-seahorse-19.rshare.io/webhook/evolutionAPIKORE"},"query":{},"params":{},"headers":{"host":"host.docker.internal:5678","x-scheme":"https","forwarded":"by=_exposr;for=179.0.72.34;host=engaging-seahorse-19.rshare.io;proto=https","x-real-ip":"179.0.72.34","connection":"keep-alive","exposr-via":"b9e7ef031eb8fe005896193e59b1d6f6d8743b1e","user-agent":"axios/1.7.9","content-type":"application/json","x-request-id":"91360975101096aa10d12cb5b8925b55","content-length":"821","accept-encoding":"gzip, compress, deflate, br","x-forwarded-for":"179.0.72.34","x-forwarded-host":"engaging-seahorse-19.rshare.io","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-scheme":"https"},"webhookUrl":"https://engaging-seahorse-19.rshare.io/webhook/evolutionAPIKORE","executionMode":"production"}}],"Gatilho diário":[{"json":{"Hour":"10","Year":"2025","Month":"April","Minute":"13","Second":"11","Timezone":"America/New_York (UTC-04:00)","timestamp":"2025-04-24T10:13:11.035-04:00","Day of week":"Thursday","Day of month":"24","Readable date":"April 24th 2025, 10:13:11 am","Readable time":"10:13:11 am"}}]},"versionId":"d250a7b6-af92-49bc-8aed-8a983f83e4d7","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-08-05T15:11:34.659Z","updatedAt":"2025-08-05T15:11:34.659Z","role":"workflow:owner","workflowId":"LWp8ajGfEKG77qe8","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-05T15:25:34.940Z","updatedAt":"2025-08-05T15:25:34.940Z","id":"pDkJHT2VFpNIeoVD","name":"My workflow 13","active":false,"isArchived":false,"nodes":[{"parameters":{},"id":"9b7d6ddb-aa49-4419-8aaf-962067a2794f","name":"Calculator","type":"@n8n/n8n-nodes-langchain.toolCalculator","position":[256,464],"typeVersion":1},{"parameters":{"assignments":{"assignments":[{"id":"f31d1137-3262-4d46-979a-e9fc3c24f670","name":"tool_called","type":"boolean","value":"={{ \n  $('When fetching a dataset row').item.json.tools_to_call\n    .split(',').map(t => t.trim())\n    .every(tool => $json.intermediateSteps.some(step => step.action.tool.toLowerCase() === tool)) \n}}"}]},"options":{}},"id":"480c4f67-7ce4-4daf-8c7b-11e3bd9fd515","name":"Check if tool called","type":"n8n-nodes-base.set","position":[1216,144],"typeVersion":3.4},{"parameters":{"options":{}},"id":"e8680c92-fa3f-40d6-b332-cf53c59ee8a0","name":"When chat message received","type":"@n8n/n8n-nodes-langchain.chatTrigger","position":[-80,352],"webhookId":"6fde470e-c42b-4a89-974d-c3d21ab0133b","typeVersion":1.1},{"parameters":{"assignments":{"assignments":[{"id":"3dec27ca-35df-47a7-9a53-d9b2d0b6c072","name":"chatInput","type":"string","value":"={{ $json.question }}"}]},"options":{}},"id":"846632f0-0685-4f2b-acad-38754cfaa50e","name":"Match chat format","type":"n8n-nodes-base.set","position":[-80,144],"typeVersion":3.4},{"parameters":{},"id":"265366ae-de9e-448d-8263-7b5e100f4d7b","name":"Return chat response","type":"n8n-nodes-base.noOp","position":[1216,352],"typeVersion":1},{"parameters":{"documentId":{"__rl":true,"mode":"list","value":"18F1WIEq1ykZKBO1bWYhC0YxRb2ngTurfsZ7jO6sGhLY","cachedResultUrl":"https://docs.google.com/spreadsheets/d/18F1WIEq1ykZKBO1bWYhC0YxRb2ngTurfsZ7jO6sGhLY/edit?usp=drivesdk","cachedResultName":"n8n dataset for evaluation"},"sheetName":{"__rl":true,"mode":"list","value":969651976,"cachedResultUrl":"https://docs.google.com/spreadsheets/d/18F1WIEq1ykZKBO1bWYhC0YxRb2ngTurfsZ7jO6sGhLY/edit#gid=969651976","cachedResultName":"Tool calling"}},"id":"9e65c460-fea8-4a08-9afe-c854bb26d703","name":"When fetching a dataset row","type":"n8n-nodes-base.evaluationTrigger","position":[-304,144],"typeVersion":4.6},{"parameters":{"operation":"setMetrics","metrics":{"assignments":[{"id":"5855df91-5a74-44f9-b25b-23a111dbd7a1","name":"tool_called","type":"number","value":"={{ $json.tool_called.toNumber() }}"}]}},"id":"96bbcfa7-69d9-4c22-8c55-243286db7a62","name":"Evaluation","type":"n8n-nodes-base.evaluation","position":[1664,144],"typeVersion":4.6},{"parameters":{"operation":"checkIfEvaluating"},"id":"dc6b5f18-044c-4cbc-99c3-4b822a6041de","name":"Evaluating?","type":"n8n-nodes-base.evaluation","position":[1008,256],"typeVersion":4.6},{"parameters":{"documentId":{"__rl":true,"mode":"list","value":"18F1WIEq1ykZKBO1bWYhC0YxRb2ngTurfsZ7jO6sGhLY","cachedResultUrl":"https://docs.google.com/spreadsheets/d/18F1WIEq1ykZKBO1bWYhC0YxRb2ngTurfsZ7jO6sGhLY/edit?usp=drivesdk","cachedResultName":"n8n dataset for evaluation"},"sheetName":{"__rl":true,"mode":"list","value":969651976,"cachedResultUrl":"https://docs.google.com/spreadsheets/d/18F1WIEq1ykZKBO1bWYhC0YxRb2ngTurfsZ7jO6sGhLY/edit#gid=969651976","cachedResultName":"Tool calling"},"outputs":{"values":[{"outputName":"actual_tools_called","outputValue":"={{ $('Evaluating?').item.json.intermediateSteps.map(step => step.action.tool.toLowerCase()).join(', ') }}\n"}]}},"id":"a574274c-01c5-495a-8b2b-f9a2c90596de","name":"Set Outputs","type":"n8n-nodes-base.evaluation","position":[1440,144],"typeVersion":4.6},{"parameters":{"options":{"systemMessage":"=You are a helpful assistant who will have access to a few tools to help with responding to user queries. I am providing some instructions below on how to use the tools. Please follow the instructions carefully.\n\nFirst, check the search_db tool to check whether the query exists. The tool expects a query string. If you use this tool and find relevant information, don't use the websearch tool.\n\nUse the web search tool to search the web for relevant information if you need to. You can ONLY call this tool once. \n\nUse the calculator for math operations or tasks. \n\nUse the summarizer tool to summarize the output. It's required to use this once you have gathered all the information you need.","returnIntermediateSteps":true}},"id":"8aa7ee3b-0076-413b-99de-71bd6a4a968f","name":"Search Agent","type":"@n8n/n8n-nodes-langchain.agent","position":[304,256],"typeVersion":1.9},{"parameters":{"description":"Call this tool to summarize the outputs. ","workflowId":{"__rl":true,"mode":"list","value":"fehTbkLtPtlVwDYq","cachedResultName":"Summarizer Agent"},"workflowInputs":{"value":{"query":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', ``, 'string') }}"},"schema":[{"id":"query","type":"string","display":true,"required":false,"displayName":"query","defaultMatch":false,"canBeUsedToMatch":true}],"mappingMode":"defineBelow","matchingColumns":["query"],"attemptToConvertTypes":false,"convertFieldsToString":false}},"id":"b3812ddf-b778-433c-a583-280a80e54d3b","name":"Summarizer","type":"@n8n/n8n-nodes-langchain.toolWorkflow","position":[384,464],"typeVersion":2.2},{"parameters":{"method":"POST","url":"https://api.firecrawl.dev/v1/search","authentication":"genericCredentialType","genericAuthType":"httpBearerAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"content-type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"query","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"},{"name":"limit","value":"={{ \"3\".toNumber() }}"}]},"options":{}},"id":"e9cb802b-611a-4ecd-a797-68171e0efa1b","name":"Web search","type":"n8n-nodes-base.httpRequestTool","position":[496,464],"typeVersion":4.2},{"parameters":{"model":"openai/o3","options":{}},"id":"89e13907-db95-4368-b865-b9f1c5fc51d0","name":"OpenRouter Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","position":[144,464],"typeVersion":1},{"parameters":{"options":{}},"id":"68dbc171-441d-4ef1-9a6f-84f91aeab748","name":"Embeddings OpenAI","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","position":[704,672],"typeVersion":1.2},{"parameters":{"mode":"retrieve-as-tool","toolDescription":"Retrievel relevant results","qdrantCollection":{"__rl":true,"mode":"list","value":"search_queries","cachedResultName":"search_queries"},"options":{}},"id":"ffa2c927-a363-483e-8004-b62fc4acf34b","name":"Search_db","type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","position":[624,464],"typeVersion":1.3}],"connections":{"Search_db":{"ai_tool":[[{"node":"Search Agent","type":"ai_tool","index":0}]]},"Calculator":{"ai_tool":[[{"node":"Search Agent","type":"ai_tool","index":0}]]},"Summarizer":{"ai_tool":[[{"node":"Search Agent","type":"ai_tool","index":0}]]},"Web search":{"ai_tool":[[{"node":"Search Agent","type":"ai_tool","index":0}]]},"Evaluating?":{"main":[[{"node":"Check if tool called","type":"main","index":0}],[{"node":"Return chat response","type":"main","index":0}]]},"Set Outputs":{"main":[[{"node":"Evaluation","type":"main","index":0}]]},"Search Agent":{"main":[[{"node":"Evaluating?","type":"main","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Search_db","type":"ai_embedding","index":0}]]},"Match chat format":{"main":[[{"node":"Search Agent","type":"main","index":0}]]},"Check if tool called":{"main":[[{"node":"Set Outputs","type":"main","index":0}]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"Search Agent","type":"ai_languageModel","index":0}]]},"When chat message received":{"main":[[{"node":"Search Agent","type":"main","index":0}]]},"When fetching a dataset row":{"main":[[{"node":"Match chat format","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{"When chat message received":[{"json":{"chatInput":"What’s the most recent funding round for Anthropic?"}},{"json":{"chatInput":"How much did OpenAI paid to acquire Windsurf? Take the results and multiply it by 1000."}}]},"versionId":"f3528db4-45a5-44a6-9d70-981592d86407","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-08-05T15:25:35.077Z","updatedAt":"2025-08-05T15:25:35.077Z","role":"workflow:owner","workflowId":"pDkJHT2VFpNIeoVD","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-05T16:01:37.638Z","updatedAt":"2025-08-06T17:02:53.000Z","id":"ah7SJ57CnzHH7Sq6","name":"MultiModal Agent","active":true,"isArchived":false,"nodes":[{"parameters":{"options":{"systemMessage":"=Eres un asistente útil y confiable. Tu objetivo principal es responder de forma clara, concreta y breve a las consultas del usuario.\n\nPuedes apoyarte en funciones o herramientas externas cuando estén disponibles para resolver las tareas de forma más eficaz. Usa estos recursos de forma autónoma y sin pedir permiso, siempre que ayuden a dar una mejor respuesta al usuario.\n\nSi no tienes suficiente información para responder, pide los datos necesarios de forma directa. Sé proactivo, toma la iniciativa cuando sea útil y enfócate siempre en entregar soluciones prácticas y comprensibles."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[-880,-352],"id":"904a709d-dc85-439f-8e72-f77cc8764f62","name":"AI Agent"},{"parameters":{"fieldToSplitOut":"=files","include":"allOtherFields","options":{"destinationFieldName":"=files","includeBinary":true}},"id":"1d043672-c1af-4633-92aa-342117c92faf","name":"Split Out Files","type":"n8n-nodes-base.splitOut","position":[-1664,-64],"executeOnce":false,"typeVersion":1},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[-1280,-352],"id":"13164f95-7fdf-437c-a3c0-d8f1b9f0a6b5","name":"Merge"},{"parameters":{"descriptionType":"manual","toolDescription":"Analyze image in Google Gemini","resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"models/gemma-3-27b-it","mode":"list","cachedResultName":"models/gemma-3-27b-it"},"text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Text_Input', ``, 'string') }}","imageUrls":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL_s_', ``, 'string') }}","options":{}},"type":"@n8n/n8n-nodes-langchain.googleGeminiTool","typeVersion":1,"position":[-800,64],"id":"828c6081-9420-42b6-9f78-0c6dbdbf5c33","name":"IMG","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Analyze video in Google Gemini","resource":"video","operation":"analyze","modelId":{"__rl":true,"value":"models/gemini-2.0-flash-lite","mode":"list","cachedResultName":"models/gemini-2.0-flash-lite"},"text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Text_Input', ``, 'string') }}","videoUrls":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL_s_', ``, 'string') }}","options":{}},"type":"@n8n/n8n-nodes-langchain.googleGeminiTool","typeVersion":1,"position":[-656,64],"id":"ec27fa16-9ee7-44db-84c2-58b864da4ef6","name":"VIDEO","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Analyze audio in Google Gemini","resource":"audio","operation":"analyze","modelId":{"__rl":true,"value":"models/gemini-2.0-flash-lite","mode":"list","cachedResultName":"models/gemini-2.0-flash-lite"},"text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Text_Input', ``, 'string') }}","audioUrls":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL_s_', ``, 'string') }}","options":{}},"type":"@n8n/n8n-nodes-langchain.googleGeminiTool","typeVersion":1,"position":[-928,64],"id":"c5bd84b4-aad1-4e25-819f-8a02bccfdc8e","name":"AUDIO","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"resource":"document","modelId":{"__rl":true,"value":"models/gemini-1.5-pro","mode":"list","cachedResultName":"models/gemini-1.5-pro"},"text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Text_Input', `Explica que necesitas del documento`, 'string') }}","documentUrls":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL_s_', ``, 'string') }}","options":{}},"type":"@n8n/n8n-nodes-langchain.googleGeminiTool","typeVersion":1,"position":[-656,-112],"id":"1e54b2fb-241e-44fb-8b69-e79bea324399","name":"DOCUMENT","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"public":true,"options":{"allowFileUploads":true}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-1680,-352],"id":"3947d5fa-5cd6-4f17-80de-8aa86fa29df8","name":"Input","webhookId":"2c774c20-3be1-429c-a9b6-86ca7cf2dcf9"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e3475200-6983-492f-b08d-ca1c40f9e4a5","leftValue":"={{ $json.files }}","rightValue":"","operator":{"type":"array","operation":"notExists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1504,-352],"id":"869e052e-ba3e-4795-8ad5-7787449af29b","name":"If Not Files"},{"parameters":{"assignments":{"assignments":[{"id":"88fdb9fb-e003-498e-98f8-9e8fcde8dd53","name":"chatInput","value":"={{ $json.chatInput }}\n{{ $json.files ? 'Media: ' + $json.files.toJsonString() : '' }}","type":"string"},{"id":"8274ca7b-69b9-4b46-beb4-a8e11198c488","name":"sessionId","value":"={{ $json.sessionId }}","type":"string"},{"id":"048b0f23-3d57-4056-b813-7ee8c25522fd","name":"action","value":"={{ $json.action }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1120,-352],"id":"178a32a0-206f-4af5-803f-6114a23c0303","name":"Generate chat Input"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGroq","typeVersion":1,"position":[-928,-112],"id":"13f5e189-ccf8-461f-9aa8-9d9b45b5352d","name":"Model","credentials":{"groqApi":{"id":"G6oCe97EbDiUJGyC","name":"Groq account"}}},{"parameters":{"contextWindowLength":15},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[-800,-112],"id":"54fcccd9-0158-4cb7-98db-1675dcf7c29c","name":"Memory"},{"parameters":{"content":"## Start \n","height":224,"width":384,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-1712,-416],"typeVersion":1,"id":"741b7bc6-d00e-45a5-9cbd-25c163f45e4a","name":"Sticky Note"},{"parameters":{"content":"## If files \n**Upload all files to Google**","height":416,"width":752},"type":"n8n-nodes-base.stickyNote","position":[-1712,-192],"typeVersion":1,"id":"8f0a19e7-85aa-4dc1-8e7b-e18a83cd5d55","name":"Sticky Note1"},{"parameters":{"content":"## The real chat input ","height":224,"width":368,"color":2},"type":"n8n-nodes-base.stickyNote","position":[-1328,-416],"typeVersion":1,"id":"eb97a99c-4cb3-4a57-ace9-668d8dfed1fe","name":"Sticky Note2"},{"parameters":{"content":"## The Agent \n","height":640,"width":416,"color":5},"type":"n8n-nodes-base.stickyNote","position":[-960,-416],"typeVersion":1,"id":"9fdb1af3-6e0c-4dfa-9705-e7b19fd91d84","name":"Sticky Note3"},{"parameters":{"options":{"reset":false}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-1488,-64],"id":"7a45abb6-bd6f-439d-a31b-93bcc6b95a06","name":"Loop Over Items"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"file"}]},"options":{"includeBinaries":false}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-1328,-160],"id":"9fe1714e-9cfb-44a6-b00b-f2afe8101937","name":"Aggregate"},{"parameters":{"resource":"file","inputType":"binary","binaryPropertyName":"=data{{$runIndex}}"},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[-1328,32],"id":"e33cb043-9fe5-4bc9-845e-90c6516413ac","name":"Upload a file","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"assignments":{"assignments":[{"id":"c51e91b2-0bc3-41f7-ad20-6553a1f16a4f","name":"file.url","value":"={{ $json.fileUri }}","type":"string"},{"id":"898419e5-f238-464c-abec-9410e0709bc8","name":"file.name","value":"={{ $('Start').item.json.files_fileName }}","type":"string"},{"id":"4c088e7c-ed7c-48df-a448-e6107ca58fd9","name":"mimeType","value":"={{ $json.mimeType }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1184,32],"id":"678875e6-73dd-4557-a954-2b6884811a30","name":"File data"},{"parameters":{"assignments":{"assignments":[{"id":"1fba2a0e-8f8f-422d-8b3d-2ce9aba9718a","name":"files","value":"={{ $json.file }}","type":"array"},{"id":"264f9f25-ab51-481d-b1b0-68fc63297d79","name":"","value":"","type":"string"},{"id":"54da9062-5aef-4f1e-baf0-f2ea57864aef","name":"sessionId","value":"={{ $('Start').item.json.sessionId }}","type":"string"},{"id":"dac98866-efeb-4fa3-af76-adf282ee6b29","name":"action","value":"={{ $('Start').item.json.action }}","type":"string"},{"id":"34e03f34-f3d9-4eb3-8171-d47b0c276ef1","name":"chatInput","value":"={{ $('Start').item.json.chatInput }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1184,-160],"id":"347b26f0-d562-456d-a2e4-9e1f6b3b6829","name":"Update Input"}],"connections":{"Split Out Files":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Generate chat Input","type":"main","index":0}]]},"IMG":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"VIDEO":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"AUDIO":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"DOCUMENT":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Input":{"main":[[{"node":"If Not Files","type":"main","index":0}]]},"If Not Files":{"main":[[{"node":"Merge","type":"main","index":0}],[{"node":"Split Out Files","type":"main","index":0}]]},"Generate chat Input":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"Loop Over Items":{"main":[[{"node":"Aggregate","type":"main","index":0}],[{"node":"Upload a file","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Update Input","type":"main","index":0}]]},"Upload a file":{"main":[[{"node":"File data","type":"main","index":0}]]},"File data":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Update Input":{"main":[[{"node":"Merge","type":"main","index":1}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"744a82e0-c343-4018-9922-187b34bcf644","triggerCount":1,"tags":[],"shared":[{"createdAt":"2025-08-05T16:01:37.674Z","updatedAt":"2025-08-05T16:01:37.674Z","role":"workflow:owner","workflowId":"ah7SJ57CnzHH7Sq6","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-05T22:40:25.411Z","updatedAt":"2025-08-05T22:40:25.411Z","id":"EXU7z6eto5ZUuoez","name":"My workflow 15","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[0,0],"id":"4115eaf9-e117-45e8-a99c-c5f5f861e55d","name":"When clicking ‘Execute workflow’"},{"parameters":{"method":"POST","url":"https://api.cloud.llamaindex.ai/api/v1/extraction/extraction-agents","authentication":"genericCredentialType","genericAuthType":"httpBearerAuth","sendBody":true,"bodyParameters":{"parameters":[{"name":"{\n    \"name\": \"resume_parser\",\n    \"data_schema\": {\n        \"type\": \"object\",\n        \"properties\": {\n            \"name\": {\n                \"type\": \"string\",\n                \"description\": \"Candidate name\"\n            },\n            \"experience\": {\n                \"type\": \"array\",\n                \"description\": \"Work history\",\n                \"items\": {\n                    \"type\": \"object\",\n                    \"properties\": {\n                        \"company\": {\n                            \"type\": \"string\",\n                            \"description\": \"Company name\"\n                        },\n                        \"title\": {\n                            \"type\": \"string\",\n                            \"description\": \"Job title\"\n                        },\n                        \"start_date\": {\n                            \"anyOf\": [\n                                {\n                                    \"type\": \"string\"\n                                },\n                                {\n                                    \"type\": \"null\"\n                                }\n                            ],\n                            \"description\": \"Start date of employment\"\n                        },\n                        \"end_date\": {\n                            \"anyOf\": [\n                                {\n                                    \"type\": \"string\"\n                                },\n                                {\n                                    \"type\": \"null\"\n                                }\n                            ],\n                            \"description\": \"End date of employment\"\n                        }\n                    }\n                }\n            }\n        }\n    },\n    \"config\": {\n        \"extraction_target\": \"PER_DOC\",\n        \"extraction_mode\": \"BALANCED\",\n    }\n}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[208,0],"id":"2e6c3dfe-eb53-463d-b0a8-0efb7053e12a","name":"HTTP Request","credentials":{"httpBearerAuth":{"id":"f5yGNrLKhcmAWWHM","name":"Llama index"}}}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"5ff04110-519c-4b87-a8e9-8cd53fd17b18","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-08-05T22:40:25.418Z","updatedAt":"2025-08-05T22:40:25.418Z","role":"workflow:owner","workflowId":"EXU7z6eto5ZUuoez","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-05T23:56:32.580Z","updatedAt":"2025-08-09T06:30:34.000Z","id":"4W3zWcHNhgqeVS63","name":"My workflow 16","active":false,"isArchived":false,"nodes":[{"parameters":{"method":"POST","url":"http://localhost:5678/api/v1/credentials","sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"application/json"},{"name":"X-N8N-API-KEY","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI4NDY3ZjcwMy00N2Y0LTQ2ODItYWYyMC03N2Q5Zjc5YzdkMGMiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzU0NjY0MDc4fQ.fTjjZtmflU4OdBHIUvq5aNuJDWi_HYzyyZJuim1LYVw"}]},"sendBody":true,"specifyBody":"json","jsonBody":"{\n  \"name\": \"Joe's Github Credentials\",\n  \"type\": \"github\",\n  \"data\": {\n    \"token\": \"ada612vad6fa5df4adf5a5dsf4389adsf76da7s\"\n  }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[208,0],"id":"b8762196-1aa3-4770-95c4-d6bc706b5481","name":"HTTP Request"},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[0,0],"id":"a96c4373-95ec-447e-9f24-fa32641e53b9","name":"When clicking ‘Execute workflow’"}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"042bfe39-902a-4fc3-81be-8829b9c84746","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-08-05T23:56:32.601Z","updatedAt":"2025-08-05T23:56:32.601Z","role":"workflow:owner","workflowId":"4W3zWcHNhgqeVS63","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-06T00:05:30.911Z","updatedAt":"2025-08-06T02:17:58.000Z","id":"qOgPrnlX3AEGS87s","name":"PDF","active":false,"isArchived":false,"nodes":[{"parameters":{"operation":"Upload File to PDF.co","binaryData":true,"name":"test"},"type":"n8n-nodes-pdfco.PDFco Api","typeVersion":1,"position":[-624,-128],"id":"3e621cb0-ca11-4365-bc29-fa47fafba86c","name":"PDFco Api","credentials":{"pdfcoApi":{"id":"RgIt0qlGxtcDwXW7","name":"PDF.co account"}}},{"parameters":{"operation":"Convert from PDF","url":"={{ $json.url }}","advancedOptions":{}},"type":"n8n-nodes-pdfco.PDFco Api","typeVersion":1,"position":[-480,-128],"id":"87a32266-4465-406d-8be8-bd8308349a5c","name":"PDFco Api1","credentials":{"pdfcoApi":{"id":"RgIt0qlGxtcDwXW7","name":"PDF.co account"}}},{"parameters":{"url":"={{ $json.url }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-336,-128],"id":"fc209c20-46f5-49f0-906b-a0d2d3cd4e44","name":"HTTP Request"},{"parameters":{"jsCode":"const content = $input.item.json.data || \"\";\n\n// Extraer todas las URLs válidas\nconst urlRegex = /https:\\/\\/app\\.invoicesimple\\.com\\/v\\/[^\\s]+/g;\nconst urls = content.match(urlRegex) || [];\n\n// Regex para extraer datos de la tabla\n// Formato esperado: GENxxx (factura), fecha, total, pagado, vencimiento\nconst lineRegex = /(GEN\\d+)\\s+(\\d{2}\\/\\d{2}\\/\\d{4})\\s+\\$([\\d,\\.]+)\\s+\\$([\\d,\\.]+)\\s+\\$([\\d,\\.]+)/g;\n\n// Extraer filas válidas\nconst rows = [];\nlet match;\nwhile ((match = lineRegex.exec(content)) !== null) {\n  rows.push({\n    factura: match[1],\n    fecha: match[2],\n    total: `$${match[3]}`,\n    pagado: `$${match[4]}`,\n    vencimiento: `$${match[5]}`\n  });\n}\n\n// Vincular URL si hay la misma cantidad\nrows.forEach((row, i) => {\n  row.url = urls[i] || null;\n});\n\n// Devolver una fila por item (formato compatible con n8n)\nreturn rows.map(row => ({ json: row }));\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-192,-128],"id":"880ca2a5-0023-4226-b333-4a45cbe7085d","name":"Code","alwaysOutputData":true},{"parameters":{"operation":"pdf","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-480,-304],"id":"43e0122b-a330-4a4b-bd84-5f2a7757a13b","name":"Extract from File"},{"parameters":{"assignments":{"assignments":[{"id":"5ea954ae-73aa-4587-9a71-52b2beb1653e","name":"text","value":"={{ $json.text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-336,-304],"id":"1aebb205-8097-4c1a-a3ae-e09570a63950","name":"Edit Fields"},{"parameters":{"formTitle":"pdf","formFields":{"values":[{"fieldLabel":"data","fieldType":"file","multipleFiles":false,"acceptFileTypes":".pdf"}]},"options":{}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[-624,-304],"id":"5c22bc7d-c036-49f4-96be-62b3599856ea","name":"Demo","webhookId":"39c71574-2640-427e-b88d-58a9b7dafe76"},{"parameters":{"formTitle":"pdf","formFields":{"values":[{"fieldLabel":"data","fieldType":"file","multipleFiles":false,"acceptFileTypes":".pdf"}]},"options":{}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[-768,-128],"id":"c25c8127-15e3-4b97-beb7-94aa32ef236a","name":"Solution","webhookId":"5ec2be33-b0eb-4e96-9d8c-e583c04798d2"}],"connections":{"PDFco Api":{"main":[[{"node":"PDFco Api1","type":"main","index":0}]]},"PDFco Api1":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Code","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Demo":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Solution":{"main":[[{"node":"PDFco Api","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"31c499b1-f9f7-46fe-863a-da972f57ad76","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-08-06T00:05:30.928Z","updatedAt":"2025-08-06T00:05:30.928Z","role":"workflow:owner","workflowId":"qOgPrnlX3AEGS87s","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-06T14:20:21.800Z","updatedAt":"2025-08-06T15:54:34.000Z","id":"kSgSKXMC85wgswfL","name":"extractFiles","active":false,"isArchived":true,"nodes":[{"parameters":{"splitInBatchesNotice":"","batchSize":1,"options":{"reset":false}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-1472,-64],"id":"35664f34-c12c-4c39-b80d-b6a87e52ac8e","name":"Loop Over Items"},{"parameters":{"aggregate":"aggregateIndividualFields","fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"file","renameField":false}]},"options":{"includeBinaries":false}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-1296,-176],"id":"45ee1755-7d8b-4eb4-8ce2-cc1fc6bf8220","name":"Aggregate"},{"parameters":{"resource":"file","operation":"upload","inputType":"binary","binaryPropertyName":"=data{{$runIndex}}"},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[-1296,32],"id":"cf62126c-3a4d-42ef-93c9-bc45d3e9a71d","name":"Upload a file","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"mode":"manual","duplicateItem":false,"assignments":{"assignments":[{"id":"c51e91b2-0bc3-41f7-ad20-6553a1f16a4f","name":"file.url","value":"={{ $json.fileUri }}","type":"string"},{"id":"898419e5-f238-464c-abec-9410e0709bc8","name":"file.name","value":"={{ $('Start').item.json.files_fileName }}","type":"string"},{"id":"4c088e7c-ed7c-48df-a448-e6107ca58fd9","name":"mimeType","value":"={{ $json.mimeType }}","type":"string"}]},"includeOtherFields":false,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1152,32],"id":"60c8e74d-ac06-49e1-a58f-27a2b12eb5d5","name":"File data"},{"parameters":{"mode":"manual","duplicateItem":false,"assignments":{"assignments":[{"id":"1fba2a0e-8f8f-422d-8b3d-2ce9aba9718a","name":"files","value":"={{ $json.file }}","type":"array"},{"id":"264f9f25-ab51-481d-b1b0-68fc63297d79","name":"","value":"","type":"string"},{"id":"54da9062-5aef-4f1e-baf0-f2ea57864aef","name":"sessionId","value":"={{ $('Start').item.json.sessionId }}","type":"string"},{"id":"dac98866-efeb-4fa3-af76-adf282ee6b29","name":"action","value":"={{ $('Start').item.json.action }}","type":"string"},{"id":"34e03f34-f3d9-4eb3-8171-d47b0c276ef1","name":"chatInput","value":"={{ $('Start').item.json.chatInput }}","type":"string"}]},"includeOtherFields":false,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1152,-176],"id":"781c5dfc-fb88-4493-af59-c87edb0c2e8d","name":"Update Input"},{"id":"d4f898fd-216f-4b83-9ff9-f76e23f2d413","typeVersion":1.1,"name":"Start","type":"n8n-nodes-base.executeWorkflowTrigger","position":[-1680,-64],"parameters":{"workflowInputs":{"values":[{"name":"files_fileName","type":"any"},{"name":"sessionId","type":"any"},{"name":"action","type":"any"},{"name":"chatInput","type":"any"}]}}}],"connections":{"Loop Over Items":{"main":[[{"node":"Aggregate","type":"main","index":0}],[{"node":"Upload a file","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Update Input","type":"main","index":0}]]},"Upload a file":{"main":[[{"node":"File data","type":"main","index":0}]]},"File data":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Start":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":null,"versionId":"eeaae96a-33cf-4845-bd6b-bd6d3a56f5cb","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-08-06T14:20:21.851Z","updatedAt":"2025-08-06T14:20:21.851Z","role":"workflow:owner","workflowId":"kSgSKXMC85wgswfL","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-06T14:21:18.488Z","updatedAt":"2025-08-06T15:54:21.000Z","id":"5cQ1XWhNWFCcgGyQ","name":"TheAgent","active":false,"isArchived":true,"nodes":[{"parameters":{"descriptionType":"manual","toolDescription":"Analyze image in Google Gemini","resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"models/gemma-3-27b-it","mode":"list","cachedResultName":"models/gemma-3-27b-it"},"text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Text_Input', ``, 'string') }}","inputType":"url","imageUrls":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL_s_', ``, 'string') }}","simplify":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.googleGeminiTool","typeVersion":1,"position":[-800,64],"id":"828c6081-9420-42b6-9f78-0c6dbdbf5c33","name":"IMG","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Analyze video in Google Gemini","resource":"video","operation":"analyze","modelId":{"__rl":true,"value":"models/gemini-2.0-flash-lite","mode":"list","cachedResultName":"models/gemini-2.0-flash-lite"},"text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Text_Input', ``, 'string') }}","inputType":"url","videoUrls":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL_s_', ``, 'string') }}","simplify":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.googleGeminiTool","typeVersion":1,"position":[-656,64],"id":"ec27fa16-9ee7-44db-84c2-58b864da4ef6","name":"VIDEO","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Analyze audio in Google Gemini","resource":"audio","operation":"analyze","modelId":{"__rl":true,"value":"models/gemini-2.0-flash-lite","mode":"list","cachedResultName":"models/gemini-2.0-flash-lite"},"text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Text_Input', ``, 'string') }}","inputType":"url","audioUrls":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL_s_', ``, 'string') }}","simplify":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.googleGeminiTool","typeVersion":1,"position":[-928,64],"id":"c5bd84b4-aad1-4e25-819f-8a02bccfdc8e","name":"AUDIO","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"descriptionType":"auto","resource":"document","operation":"analyze","modelId":{"__rl":true,"value":"models/gemini-1.5-pro","mode":"list","cachedResultName":"models/gemini-1.5-pro"},"text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Text_Input', `Explica que necesitas del documento`, 'string') }}","inputType":"url","documentUrls":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL_s_', ``, 'string') }}","simplify":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.googleGeminiTool","typeVersion":1,"position":[-656,-112],"id":"1e54b2fb-241e-44fb-8b69-e79bea324399","name":"DOCUMENT","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"notice":"","model":"gemma2-9b-it","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGroq","typeVersion":1,"position":[-928,-112],"id":"13f5e189-ccf8-461f-9aa8-9d9b45b5352d","name":"Model","credentials":{"groqApi":{"id":"G6oCe97EbDiUJGyC","name":"Groq account"}}},{"parameters":{"notice":"","sessionIdType":"fromInput","sessionKey":"={{ $json.sessionId }}","contextWindowLength":15},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[-800,-112],"id":"54fcccd9-0158-4cb7-98db-1675dcf7c29c","name":"Memory"},{"parameters":{"aiAgentStarterCallout":"","promptType":"auto","text":"={{ $json.chatInput }}","hasOutputParser":false,"needsFallback":false,"options":{"systemMessage":"Eres un asistente útil y confiable. Tu objetivo principal es responder de forma clara, concreta y breve a las consultas del usuario.\n\nPuedes apoyarte en funciones o herramientas externas cuando estén disponibles para resolver las tareas de forma más eficaz. Usa estos recursos de forma autónoma y sin pedir permiso, siempre que ayuden a dar una mejor respuesta al usuario.\n\nSi no tienes suficiente información para responder, pide los datos necesarios de forma directa. Sé proactivo, toma la iniciativa cuando sea útil y enfócate siempre en entregar soluciones prácticas y comprensibles."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[-880,-352],"id":"904a709d-dc85-439f-8e72-f77cc8764f62","name":"AI Agent"},{"id":"de3742d8-1cc4-4cc8-891c-69923aede358","typeVersion":1.1,"name":"Start","type":"n8n-nodes-base.executeWorkflowTrigger","position":[-1088,-352],"parameters":{"workflowInputs":{"values":[{"name":"chatInput","type":"any"}]}}}],"connections":{"IMG":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"VIDEO":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"AUDIO":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"DOCUMENT":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"Start":{"main":[[{"node":"AI Agent","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":null,"versionId":"d9d77c9b-c39a-4088-bffd-b8e1fde77f06","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-08-06T14:21:18.505Z","updatedAt":"2025-08-06T14:21:18.505Z","role":"workflow:owner","workflowId":"5cQ1XWhNWFCcgGyQ","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-06T16:42:59.698Z","updatedAt":"2025-08-06T16:42:59.000Z","id":"BeNX2bGB1214s53N","name":"loop","active":false,"isArchived":false,"nodes":[{"parameters":{"splitInBatchesNotice":"","batchSize":1,"options":{"reset":false}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-1472,-64],"id":"35664f34-c12c-4c39-b80d-b6a87e52ac8e","name":"Loop Over Items"},{"parameters":{"aggregate":"aggregateIndividualFields","fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"file","renameField":false}]},"options":{"includeBinaries":false}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-1296,-176],"id":"45ee1755-7d8b-4eb4-8ce2-cc1fc6bf8220","name":"Aggregate"},{"parameters":{"resource":"file","operation":"upload","inputType":"binary","binaryPropertyName":"=data{{$runIndex}}"},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[-1296,32],"id":"cf62126c-3a4d-42ef-93c9-bc45d3e9a71d","name":"Upload a file","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"mode":"manual","duplicateItem":false,"assignments":{"assignments":[{"id":"c51e91b2-0bc3-41f7-ad20-6553a1f16a4f","name":"file.url","value":"={{ $json.fileUri }}","type":"string"},{"id":"898419e5-f238-464c-abec-9410e0709bc8","name":"file.name","value":"={{ $('Start').item.json.files_fileName }}","type":"string"},{"id":"4c088e7c-ed7c-48df-a448-e6107ca58fd9","name":"mimeType","value":"={{ $json.mimeType }}","type":"string"}]},"includeOtherFields":false,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1152,32],"id":"60c8e74d-ac06-49e1-a58f-27a2b12eb5d5","name":"File data"},{"parameters":{"mode":"manual","duplicateItem":false,"assignments":{"assignments":[{"id":"1fba2a0e-8f8f-422d-8b3d-2ce9aba9718a","name":"files","value":"={{ $json.file }}","type":"array"},{"id":"264f9f25-ab51-481d-b1b0-68fc63297d79","name":"","value":"","type":"string"},{"id":"54da9062-5aef-4f1e-baf0-f2ea57864aef","name":"sessionId","value":"={{ $('Start').item.json.sessionId }}","type":"string"},{"id":"dac98866-efeb-4fa3-af76-adf282ee6b29","name":"action","value":"={{ $('Start').item.json.action }}","type":"string"},{"id":"34e03f34-f3d9-4eb3-8171-d47b0c276ef1","name":"chatInput","value":"={{ $('Start').item.json.chatInput }}","type":"string"}]},"includeOtherFields":false,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1152,-176],"id":"781c5dfc-fb88-4493-af59-c87edb0c2e8d","name":"Update Input"},{"id":"4e714308-b77f-4842-8e28-f6a52896222e","typeVersion":1.1,"name":"Start","type":"n8n-nodes-base.executeWorkflowTrigger","position":[-1680,-64],"parameters":{"workflowInputs":{"values":[{"name":"files_fileName","type":"any"},{"name":"sessionId","type":"any"},{"name":"action","type":"any"},{"name":"chatInput","type":"any"}]}}}],"connections":{"Loop Over Items":{"main":[[{"node":"Aggregate","type":"main","index":0}],[{"node":"Upload a file","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Update Input","type":"main","index":0}]]},"Upload a file":{"main":[[{"node":"File data","type":"main","index":0}]]},"File data":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Start":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":null,"versionId":"980c1e71-2ca1-45cd-91f0-5bd8d8c836ff","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-08-06T16:42:59.794Z","updatedAt":"2025-08-06T16:42:59.794Z","role":"workflow:owner","workflowId":"BeNX2bGB1214s53N","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-12T14:32:38.900Z","updatedAt":"2025-08-12T14:32:38.900Z","id":"vCwUFLzXLM6f9m10","name":"My workflow 17","active":false,"isArchived":false,"nodes":[{"parameters":{"path":"ia-diagnostico-express","responseMode":"lastNode","options":{}},"id":"4fb4ff36-13bd-4f49-b46f-43b9e260ba81","name":"Form | GET","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[0,0],"webhookId":"abce85d4-d110-4045-8ded-42f58a9d10e4"},{"parameters":{"documentId":"={{$env.DIAG_SHEET_ID}}","sheetName":"preguntas de Astral-AI","options":{}},"id":"63475fe9-227c-432e-b7a4-f2166d08e55d","name":"Sheets | Leer preguntas (form)","type":"n8n-nodes-base.googleSheets","typeVersion":4,"position":[240,0]},{"parameters":{"language":"javascript"},"id":"59d5fd9f-b51c-4c91-9127-9072b466adab","name":"Render HTML (v5.1.4)","type":"n8n-nodes-base.code","typeVersion":2,"position":[480,0]},{"parameters":{"options":{}},"id":"19e86f73-e9b4-40be-a14a-4b12842c666d","name":"Responder HTML (GET)","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[720,0]},{"parameters":{"httpMethod":"POST","path":"ia-diagnostico-express/submit","responseMode":"lastNode","options":{}},"id":"ad9ea78a-8101-46fa-b924-ae1585ab4fdb","name":"Submit | POST","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[0,368],"webhookId":"f1c8a510-ad20-407a-a337-4ef549ed48e1"},{"parameters":{"language":"javascript"},"id":"635cb5ba-418a-4b3c-b63f-d44cb6d17ed8","name":"Parse answers","type":"n8n-nodes-base.code","typeVersion":2,"position":[240,368]},{"parameters":{"language":"javascript"},"id":"17a508cd-646b-420f-9979-680bb6013e68","name":"Build Prompt (Gemini)","type":"n8n-nodes-base.code","typeVersion":2,"position":[480,368]},{"parameters":{"method":"POST","url":"https://generativelanguage.googleapis.com/v1beta/models/{{ $json.payload.model }}:generateContent?key={{$env.GOOGLE_AI_API_KEY}}","sendBody":true,"bodyParameters":{"parameters":[{}]},"options":{"timeout":30000}},"id":"c01cfbfb-6a70-45e4-9a70-850e2b2b4b34","name":"Gemini Flash","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[720,368]},{"parameters":{"mode":"mergeByIndex","options":{}},"id":"8afec82d-18ce-4f61-95ad-8538a4052968","name":"Merge (Gemini + Answers)","type":"n8n-nodes-base.merge","typeVersion":2,"position":[960,368]},{"parameters":{"language":"javascript"},"id":"f200fcea-a934-4dc0-aecc-b792d6c701af","name":"Parse Gemini","type":"n8n-nodes-base.code","typeVersion":2,"position":[1200,368]},{"parameters":{"operation":"append","documentId":"={{$env.LEADS_SHEET_ID}}","sheetName":"Leads","columns":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"id":"c2031548-b6f1-4377-8835-5374fc34e319","name":"Guardar en Leads","type":"n8n-nodes-base.googleSheets","typeVersion":4,"position":[1440,368]},{"parameters":{"fromEmail":"info@astral-ai.net","toEmail":"={{$env.ASTRAL_AGENT_EMAIL || \"info@astral-ai.net\"}}","subject":"Nuevo diagnóstico Express | Astral-AI","text":"={{`Nuevo lead de diagnóstico:\\n\\nNombre: ${$json.name}\\nEmail: ${$json.email}\\nTel: ${$json.phone}\\n\\nScore: ${$json.score}/100\\n\\nResumen:\\n${$json.diagnostic}\\n\\nRespuestas crudas:\\n${JSON.stringify($json.answers, null, 2)}\\n\\n— Enviado desde n8n`}}","options":{}},"id":"24f0a49f-9150-4726-86c2-c10e6f21bd34","name":"Enviar email al agente","type":"n8n-nodes-base.emailSend","typeVersion":2,"position":[1680,432],"webhookId":"8f48a04e-2bd7-4a46-851c-426f22c6f7b2","continueOnFail":true},{"parameters":{"mode":"mergeByIndex","options":{}},"id":"d15dbb5e-50ce-4fff-8e8b-12186f625182","name":"Merge (Leads + Email)","type":"n8n-nodes-base.merge","typeVersion":2,"position":[1920,384]},{"parameters":{"options":{}},"id":"52ab2799-a465-4159-80f2-1b333de6d441","name":"Responder al cliente","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[2160,384]},{"parameters":{"path":"ia-diagnostico-express/questions","responseMode":"lastNode","options":{}},"id":"3e242dea-d518-4820-b948-25ff1fb82230","name":"Questions | GET","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[0,704],"webhookId":"461f02c2-01f6-426f-968b-ee020b1d2204"},{"parameters":{"documentId":"={{$env.DIAG_SHEET_ID}}","sheetName":"preguntas de Astral-AI","options":{}},"id":"d3a85029-1e97-40ce-b574-be1662750623","name":"Sheets | Leer preguntas (API)","type":"n8n-nodes-base.googleSheets","typeVersion":4,"position":[240,704]},{"parameters":{"language":"javascript"},"id":"3759ddf5-8781-420a-8747-a94b508ff46e","name":"Build Questions JSON","type":"n8n-nodes-base.code","typeVersion":2,"position":[480,704]},{"parameters":{"options":{}},"id":"393fed46-378b-43d4-adc7-ff8d17b00823","name":"Responder JSON (Questions)","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[720,704]}],"connections":{"Form | GET":{"main":[[{"node":"Sheets | Leer preguntas (form)","type":"main","index":0}]]},"Sheets | Leer preguntas (form)":{"main":[[{"node":"Render HTML (v5.1.4)","type":"main","index":0}]]},"Render HTML (v5.1.4)":{"main":[[{"node":"Responder HTML (GET)","type":"main","index":0}]]},"Submit | POST":{"main":[[{"node":"Parse answers","type":"main","index":0}]]},"Parse answers":{"main":[[{"node":"Build Prompt (Gemini)","type":"main","index":0}]]},"Build Prompt (Gemini)":{"main":[[{"node":"Gemini Flash","type":"main","index":0}]]},"Gemini Flash":{"main":[[{"node":"Merge (Gemini + Answers)","type":"main","index":1}]]},"Merge (Gemini + Answers)":{"main":[[{"node":"Parse Gemini","type":"main","index":0}]]},"Parse Gemini":{"main":[[{"node":"Guardar en Leads","type":"main","index":0},{"node":"Enviar email al agente","type":"main","index":0}]]},"Guardar en Leads":{"main":[[{"node":"Merge (Leads + Email)","type":"main","index":0}]]},"Enviar email al agente":{"main":[[{"node":"Merge (Leads + Email)","type":"main","index":1}]]},"Merge (Leads + Email)":{"main":[[{"node":"Responder al cliente","type":"main","index":0}]]},"Questions | GET":{"main":[[{"node":"Sheets | Leer preguntas (API)","type":"main","index":0}]]},"Sheets | Leer preguntas (API)":{"main":[[{"node":"Build Questions JSON","type":"main","index":0}]]},"Build Questions JSON":{"main":[[{"node":"Responder JSON (Questions)","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"62d2356e-2791-49ff-be85-3d96b8e37b80","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-08-12T14:32:38.933Z","updatedAt":"2025-08-12T14:32:38.933Z","role":"workflow:owner","workflowId":"vCwUFLzXLM6f9m10","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-15T05:10:05.724Z","updatedAt":"2025-08-15T10:32:11.000Z","id":"yLI75BPACZVPBs0q","name":"Login Wordpress","active":false,"isArchived":false,"nodes":[{"parameters":{"assignments":{"assignments":[{"id":"070f8893-be05-4ddc-a2e3-3c183aa360c8","name":"error.code","value":"={{ $json.error.code }}","type":"string"},{"id":"126da598-1612-4e82-a731-0967345d8fcc","name":"error.status","value":"={{ $json.error.status }}","type":"number"},{"id":"ff20caa4-22dd-4fc2-b697-2d123db0e01a","name":"error.message","value":"={{ $json.error.message }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[0,-288],"id":"f5b2738d-e29c-4775-aa4c-de265c633748","name":"Error"},{"parameters":{"assignments":{"assignments":[{"id":"11ba8911-60f7-496e-9ae3-19fa04b9ac0a","name":"user_id","value":"={{ $json.user_id }}","type":"number"},{"id":"345cd4ee-8cad-4340-af57-cfebe50b98fa","name":"user_login","value":"={{ $('Get all user data').item.json.user_login }}","type":"string"},{"id":"03fb29fb-33a5-4491-b7e0-0ccd7c28cbad","name":"user_email","value":"={{ $('Get all user data').item.json.user_email }}","type":"string"},{"id":"a02ad055-ddba-463e-8b24-b4f9ccd1817e","name":"user_rol","value":"={{ $json.meta_value }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[288,-480],"id":"94b3ea8b-a65a-4c99-8709-ddbdd2e23ac1","name":"User Output"},{"parameters":{"workflowInputs":{"values":[{"name":"Email"},{"name":"Password"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-400,-384],"id":"4f6e194b-ebc6-48a4-9314-a1cf26b90ca9","name":"When Executed by Another Workflow"},{"parameters":{"method":"POST","url":"http://localhost/wordpress/wp-json/jwt-auth/v1/token","sendBody":true,"bodyParameters":{"parameters":[{"name":"username","value":"={{ $json.Email }}"},{"name":"password","value":"={{ $json.Password }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-208,-384],"id":"cfed714c-539e-4b2e-b58f-6ca08017e4ad","name":"JWT Auth","retryOnFail":true,"onError":"continueErrorOutput"},{"parameters":{"operation":"select","table":{"__rl":true,"value":"wp_users","mode":"name"},"where":{"values":[{"column":"user_email","value":"={{ $json.user_email }}"},{"column":"user_nicename","value":"={{ $json.user_nicename }}"},{"column":"display_name","value":"={{ $json.user_display_name }}"}]},"options":{}},"type":"n8n-nodes-base.mySql","typeVersion":2.4,"position":[0,-480],"id":"35199399-f999-49c0-a916-f00359b07b8c","name":"Get all user data","alwaysOutputData":true,"credentials":{"mySql":{"id":"AsCrflZ4i9MJXTa9","name":"MySQL account"}}},{"parameters":{"operation":"select","table":{"__rl":true,"value":"wp_usermeta","mode":"name"},"returnAll":true,"where":{"values":[{"column":"user_id","value":"={{ $json.ID }}"},{"column":"meta_key","value":"wp_capabilities"}]},"options":{}},"type":"n8n-nodes-base.mySql","typeVersion":2.4,"position":[144,-480],"id":"2766d735-543e-4fe3-9719-51ae07b4aff9","name":"Get user role","alwaysOutputData":true,"credentials":{"mySql":{"id":"AsCrflZ4i9MJXTa9","name":"MySQL account"}}}],"connections":{"When Executed by Another Workflow":{"main":[[{"node":"JWT Auth","type":"main","index":0}]]},"JWT Auth":{"main":[[{"node":"Get all user data","type":"main","index":0}],[{"node":"Error","type":"main","index":0}]]},"Get all user data":{"main":[[{"node":"Get user role","type":"main","index":0}]]},"Get user role":{"main":[[{"node":"User Output","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"When Executed by Another Workflow":[{"json":{"Email":"mauricio.perera@gmail.com","Password":"V&BXP&jYcAHSK%W#Bu"}}]},"versionId":"61508a02-5bb7-47cc-9fef-5f17b63b0105","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-08-15T05:10:05.741Z","updatedAt":"2025-08-15T05:10:05.741Z","role":"workflow:owner","workflowId":"yLI75BPACZVPBs0q","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-15T07:26:47.856Z","updatedAt":"2025-08-15T09:10:36.000Z","id":"xaEfLeLuV7XbqXCg","name":"Smarth get post tool","active":false,"isArchived":false,"nodes":[{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[576,-176],"id":"6182908e-daef-4877-a124-0db079c4af34","name":"Loop Over Items"},{"parameters":{"assignments":{"assignments":[{"id":"7a27d0dd-7baf-4849-937f-386fc56d7ca9","name":"post_date","value":"={{ $json.post_date }}","type":"string"},{"id":"e5487842-a786-44ee-b2ce-b781565dc0c7","name":"post_title","value":"={{ $json.post_title }}","type":"string"},{"id":"a4716f88-c51c-43b3-9359-f8d91da731c1","name":"post_content","value":"={{ $json.post_content }}","type":"string"},{"id":"6076ed98-544c-47a9-be3b-a9cc424b272d","name":"comment_count","value":"={{ $json.comment_count }}","type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[800,-32],"id":"d6461892-d9ea-4ada-9b05-5bf6a9f03634","name":"Edit Fields"},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[800,-192],"id":"7e1919ec-369c-4c18-8575-6e2c4df45c5a","name":"Aggregate"},{"parameters":{"workflowInputs":{"values":[{"name":"user_id","type":"number"},{"name":"query"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-352,16],"id":"c819e646-f572-40b2-9498-fe806d0cb5b7","name":"When Executed by Another Workflow"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"3428167e-6d6c-4120-b19e-78131b268203","leftValue":"={{ $json.user_id }}","rightValue":0,"operator":{"type":"number","operation":"gt"}},{"id":"81193892-12d6-4fb1-b684-03ca64338dcb","leftValue":"={{ $json.query }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-160,16],"id":"2998d7f9-4d65-41fa-a92e-a767cd7533ca","name":"If"},{"parameters":{"mode":"raw","jsonOutput":"={\n  \"success\": false,\n  \"error\": {\n    \"code\": 400,\n    \"message\": \"El ID de usuario no puede ser menor o igual a 0.\",\n    \"details\": {\n      \"field\": \"user_id\",\n      \"value\": {{ $json.user_id }}\n    }\n  }\n}\n ","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[48,160],"id":"93e5ff10-7b19-4639-903e-b7eeb8f608fb","name":"Error"},{"parameters":{"operation":"executeQuery","query":"{{ $json.text }}","options":{}},"type":"n8n-nodes-base.mySql","typeVersion":2.4,"position":[400,-176],"id":"ea2e23fa-8b0a-4074-af93-a9806134d201","name":"Get Post","alwaysOutputData":true,"credentials":{"mySql":{"id":"AsCrflZ4i9MJXTa9","name":"MySQL account"}}},{"parameters":{"promptType":"define","text":"=Consulta: {{ $json.query }}\n\nuser id: {{ $('When Executed by Another Workflow').item.json.user_id }}","messages":{"messageValues":[{"message":"=You are an assistant specialized in generating SQL queries for WooCommerce in WordPress. Your task is to produce safe and precise SQL queries that retrieve all products from the store based on the filters the user provides.\n\nImportant rules:\n\nReturn only the pure SQL query, no quotes, no Markdown, no explanations, no extra text.\n\nThe query must use the relevant WooCommerce tables: wp_posts (for products) and wp_postmeta (for attributes such as price, stock, SKU, color, size, etc.).\n\nThe filters the user can specify include:\n\nStock (_stock, _stock_status)\n\nPrice (_price, _regular_price, _sale_price)\n\nCategories (term_taxonomy_id via wp_term_relationships)\n\nCustom attributes (pa_color, pa_size, or any other pa_*)\n\nProduct status (post_status, e.g., publish)\n\nAny attribute mentioned by the user in English should be mapped to the corresponding pa_* meta_key in wp_postmeta. For example, “color red” → pa_color = 'red', “size M” → pa_size = 'M'.\n\nIf a filter is not provided, do not include it in the WHERE clause.\n\nDefault ordering is by post_date descending unless the user specifies another order.\n\nThe query must be compatible with MySQL, as used by WooCommerce in WordPress.\n\nExample interpretation:\nUser says: “I want products with stock > 0, price between 50 and 100, color red, and size M from last month.”\nGenerate:\n\nSELECT p.*\nFROM wp_posts p\nJOIN wp_postmeta pm_price ON p.ID = pm_price.post_id AND pm_price.meta_key = '_price'\nJOIN wp_postmeta pm_stock ON p.ID = pm_stock.post_id AND pm_stock.meta_key = '_stock'\nJOIN wp_postmeta pm_color ON p.ID = pm_color.post_id AND pm_color.meta_key = 'pa_color'\nJOIN wp_postmeta pm_size ON p.ID = pm_size.post_id AND pm_size.meta_key = 'pa_size'\nWHERE p.post_type = 'product'\nAND p.post_status = 'publish'\nAND pm_stock.meta_value > 0\nAND pm_price.meta_value BETWEEN 50 AND 100\nAND pm_color.meta_value = 'red'\nAND pm_size.meta_value = 'M'\nAND p.post_date >= DATE_SUB(NOW(), INTERVAL 1 MONTH)\nORDER BY p.post_date DESC;\n\nGenerate the SQL dynamically based on the filters the user provides, including any product attributes mentioned in English, only the complete SQL query."}]},"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[48,-176],"id":"b8af3f20-0a5b-429a-a142-c59dbfffb72f","name":"Basic LLM Chain"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[48,-16],"id":"41d909cd-fe00-404d-b85c-16e0c07141a8","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}}],"connections":{"Loop Over Items":{"main":[[{"node":"Aggregate","type":"main","index":0}],[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"When Executed by Another Workflow":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"Basic LLM Chain","type":"main","index":0}],[{"node":"Error","type":"main","index":0}]]},"Get Post":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"Basic LLM Chain","type":"ai_languageModel","index":0}]]},"Basic LLM Chain":{"main":[[{"node":"Get Post","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"When Executed by Another Workflow":[{"json":{"user_id":1,"query":"publicaciones del mes pasado"}}]},"versionId":"5d988e21-9c29-49a6-a210-b5432ba6fdeb","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-08-15T07:26:47.872Z","updatedAt":"2025-08-15T07:26:47.872Z","role":"workflow:owner","workflowId":"xaEfLeLuV7XbqXCg","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-15T08:07:01.177Z","updatedAt":"2025-08-15T11:00:28.000Z","id":"Q0Aix4tFQLgV5j5S","name":"Agent","active":false,"isArchived":false,"nodes":[{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[0,0],"id":"e67703a5-3ffb-4bfe-9e88-7e62eb151147","name":"When chat message received","webhookId":"76ac59e3-57d2-4f1e-bf44-01811a83a089"},{"parameters":{"options":{"systemMessage":"Eres un agente AI encargado de buscar y recuperar contenido publicado por usuarios. Solo puedes acceder a información de usuarios autenticados.\n\nVerifica siempre que el usuario esté autenticado antes de intentar obtener cualquier contenido.\n\nRecupera únicamente contenido que el usuario tenga permiso de ver.\n\nDevuelve los resultados de manera estructurada, incluyendo información básica del usuario y sus publicaciones.\n\nSi la autenticación falla, informa claramente del error.\n\nDebes descubrir y usar las herramientas disponibles para autenticar al usuario y obtener sus publicaciones."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[208,0],"id":"1f481b17-50c2-4e6c-af6f-42150347b44a","name":"AI Agent"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[80,208],"id":"db68becd-0659-4537-940b-a0adbc4e274a","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[224,208],"id":"fb3ab5ff-ed69-4482-b77f-ed336d2c8e05","name":"Simple Memory"},{"parameters":{"description":"Esta herramienta permite autenticar un usuario en WordPress, recuperar su información completa de la base de datos incluyendo su rol.","workflowId":{"__rl":true,"value":"yLI75BPACZVPBs0q","mode":"id"},"workflowInputs":{"mappingMode":"defineBelow","value":{"Email":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Email', `Email del usuario para autenticarlo.`, 'string') }}","Password":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Password', `Password del usuario para autenticarlo`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"Email","displayName":"Email","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"Password","displayName":"Password","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[640,352],"id":"8cfd9dc1-1913-4f74-b4a5-1aa5e8e10f07","name":"Login Wordpress"},{"parameters":{"description":"Esta herramienta permite recibir solicitudes, generar dinámicamente consultas SQL basadas en los filtros proporcionados y obtener resultados de la base de datos de WordPress.","workflowId":{"__rl":true,"value":"xaEfLeLuV7XbqXCg","mode":"id"},"workflowInputs":{"mappingMode":"defineBelow","value":{"user_id":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('user_id', `Id del usuario actual, si no se tiene el dato se debe autenticar al usuario para obtenerlo.`, 'number') }}","query":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', `descripcion de la consulta que se debe realizar incluir detalles de filtros como rangos de fechas, o similares que pueda definir el usuario.`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[336,352],"id":"233f64f4-eb46-4a22-aabb-5788c3743d32","name":"Smarth get post tool"},{"parameters":{"description":"Esta herramienta permite generar consultas SQL dinámicas para WooCommerce y recuperar los productos de la tienda según filtros específicos indicados por el usuario.","workflowId":{"__rl":true,"value":"m1C0fDvKzxk2V9jA","mode":"id"},"workflowInputs":{"mappingMode":"defineBelow","value":{"user_id":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('user_id', `Id del usuario actual, si no se tiene el dato se debe autenticar al usuario para obtenerlo.`, 'number') }}","query":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', `Consulta del usuario`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[688,80],"id":"a5b31d54-04b3-47eb-81d4-3c551e941263","name":"Smarth get products tool"},{"parameters":{"description":"Esta herramienta permite crear nuevas entradas en WordPress según los datos proporcionados (título, contenido, estado, tipo, fecha, etc.) y devolver el post_id de la entrada creada.","workflowId":{"__rl":true,"value":"YPncLwo6PxsKGbrc","mode":"list","cachedResultName":"Smarth post post tool"},"workflowInputs":{"mappingMode":"defineBelow","value":{"user_id":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('user_id', `Id del usuario actual, si no se tiene el dato se debe autenticar al usuario para obtenerlo.`, 'number') }}","query":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', `descripcion de la consulta que se debe realizar incluir detalles de filtros como rangos de fechas, o similares que pueda definir el usuario.`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[496,352],"id":"77a994a2-8145-404a-8978-cad2e5c10027","name":"Smarth post post tool"}],"connections":{"When chat message received":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"Login Wordpress":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Smarth get post tool":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Smarth get products tool":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Smarth post post tool":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"ef1cd2c1-9a3c-4aa8-944e-32b9a569056b","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-08-15T08:07:01.197Z","updatedAt":"2025-08-15T08:07:01.197Z","role":"workflow:owner","workflowId":"Q0Aix4tFQLgV5j5S","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-15T08:13:34.413Z","updatedAt":"2025-08-15T09:54:06.000Z","id":"m1C0fDvKzxk2V9jA","name":"Smarth get product tool","active":false,"isArchived":false,"nodes":[{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[576,-176],"id":"2e1c5103-3c60-4dae-90ae-7b994225ce4d","name":"Loop Over Items"},{"parameters":{"assignments":{"assignments":[{"id":"3f20e86c-3343-47f9-a6b0-0b4fc64b015b","name":"post_title","value":"={{ $json.post_title }}","type":"string"},{"id":"2c68c91f-0573-4568-8f2a-885e988425ff","name":"description","value":"={{ $json.description }}","type":"string"},{"id":"b9521c41-284b-4f2a-b1c9-672c891d249c","name":"stock_status","value":"={{ $json.stock_status }}","type":"string"},{"id":"d398db00-5d72-4876-9efa-e433993cd6f2","name":"stock_quantity","value":"={{ $json.stock_quantity }}","type":"string"},{"id":"f9b40505-9821-4512-80f2-e1ab7b14450c","name":"price","value":"={{ $json.price }}","type":"string"},{"id":"a5589b97-6151-4482-b00a-200c0f3e0dac","name":"attributes","value":"={{ $json.attributes }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[800,-32],"id":"a3c2c023-1070-4b81-880f-9a2c6fcd9e87","name":"Edit Fields"},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[800,-192],"id":"2f494523-2610-4c66-a876-65da97a6cc04","name":"Aggregate"},{"parameters":{"workflowInputs":{"values":[{"name":"user_id","type":"number"},{"name":"query"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-352,16],"id":"9daa2d3d-2df7-4f53-a8b8-bbf822722d7a","name":"When Executed by Another Workflow"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"3428167e-6d6c-4120-b19e-78131b268203","leftValue":"={{ $json.user_id }}","rightValue":0,"operator":{"type":"number","operation":"gt"}},{"id":"81193892-12d6-4fb1-b684-03ca64338dcb","leftValue":"={{ $json.query }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-160,16],"id":"339475b8-d26c-4fb1-bf27-09b8d3e98464","name":"If"},{"parameters":{"mode":"raw","jsonOutput":"={\n  \"success\": false,\n  \"error\": {\n    \"code\": 400,\n    \"message\": \"El ID de usuario no puede ser menor o igual a 0.\",\n    \"details\": {\n      \"field\": \"user_id\",\n      \"value\": {{ $json.user_id }}\n    }\n  }\n}\n ","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[48,160],"id":"a5d62a09-6859-43a0-86a6-4835fe6fd7fa","name":"Error"},{"parameters":{"operation":"executeQuery","query":"{{ $json.text }}","options":{}},"type":"n8n-nodes-base.mySql","typeVersion":2.4,"position":[400,-176],"id":"a04f3877-31f9-4cdd-8088-c677e0c0bed9","name":"Get Post","alwaysOutputData":true,"credentials":{"mySql":{"id":"AsCrflZ4i9MJXTa9","name":"MySQL account"}}},{"parameters":{"promptType":"define","text":"=Consulta: {{ $json.query }}\n\nuser id: {{ $('When Executed by Another Workflow').item.json.user_id }}","messages":{"messageValues":[{"message":"=You are an expert WooCommerce SQL generator. Your task is to take any user request in natural language and produce a fully working SQL query in plain text, ready to execute. Follow these rules strictly:\n\n1. Language normalization: Always translate product names, attribute values, and filters to English as used in the database. For example:\n   - \"camisa roja\" → \"Red Shirt\"\n   - \"shorts azules en stock\" → \"Short Blue in stock\"\n\n2. WooCommerce database structure:\n   - Products: wp_posts (post_type = 'product')\n   - Stock: wp_postmeta (meta_key = '_stock_status', meta_value = 'instock')\n   - Stock quantity: wp_postmeta (meta_key = '_stock')\n   - Price: wp_postmeta (meta_key = '_price')\n   - SKU: wp_postmeta (meta_key = '_sku')\n   - Custom attributes: wp_postmeta (meta_key = '_product_attributes', serialized PHP values)\n   - Global attributes: wp_terms, wp_term_taxonomy, wp_term_relationships (taxonomy = 'pa_color', etc.)\n   - Categories: wp_terms, wp_term_taxonomy, wp_term_relationships (taxonomy = 'product_cat')\n\n3. Query requirements:\n   - Only return products that match user filters (stock, name, category, attributes)\n   - Include at minimum: ID, title, description, stock status, stock quantity, price, SKU, attributes, color\n   - For custom attributes, use LIKE '%Value%' to match serialized data\n   - For global attributes, use proper JOINs on wp_terms, wp_term_taxonomy, and wp_term_relationships\n   - Use DISTINCT to avoid duplicate results\n   - Filter by stock using _stock_status = 'instock'\n   - Filter by product name using post_title LIKE '%Name%'\n   - SQL must be fully functional and ready to execute\n\n4. Output rules:\n   - Only SQL in plain text\n   - No explanations, no Markdown, no code blocks, no extra text\n   - Table and column names remain in English; only translate user values\n\nExample:\nUser: \"shorts azules en stock\"\nOutput:\nSELECT DISTINCT \n    p.ID,\n    p.post_title,\n    p.post_content AS description,\n    stock.meta_value AS stock_status,\n    stock_qty.meta_value AS stock_quantity,\n    price.meta_value AS price,\n    sku.meta_value AS sku,\n    attrs.meta_value AS attributes,\n    t.name AS color\nFROM wp_posts p\nINNER JOIN wp_postmeta stock ON p.ID = stock.post_id\n    AND stock.meta_key = '_stock_status'\n    AND stock.meta_value = 'instock'\nLEFT JOIN wp_postmeta stock_qty ON p.ID = stock_qty.post_id\n    AND stock_qty.meta_key = '_stock'\nLEFT JOIN wp_postmeta price ON p.ID = price.post_id\n    AND price.meta_key = '_price'\nLEFT JOIN wp_postmeta sku ON p.ID = sku.post_id\n    AND sku.meta_key = '_sku'\nLEFT JOIN wp_postmeta attrs ON p.ID = attrs.post_id\n    AND attrs.meta_key = '_product_attributes'\nLEFT JOIN wp_term_relationships tr ON p.ID = tr.object_id\nLEFT JOIN wp_term_taxonomy tt ON tr.term_taxonomy_id = tt.term_taxonomy_id\n    AND tt.taxonomy = 'pa_color'\nLEFT JOIN wp_terms t ON tt.term_id = t.term_id\nWHERE p.post_type = 'product'\n  AND p.post_status = 'publish'\n  AND p.post_title LIKE '%Short%'\n  AND (\n        t.slug = 'blue'\n        OR attrs.meta_value LIKE '%Blue%'\n      );\n"}]},"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[48,-176],"id":"646c69d2-018d-4793-a74a-e04f65b56885","name":"Basic LLM Chain"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[48,-16],"id":"dabd8d7f-12a0-454c-8420-a77221361a7e","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}}],"connections":{"Loop Over Items":{"main":[[{"node":"Aggregate","type":"main","index":0}],[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"When Executed by Another Workflow":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"Basic LLM Chain","type":"main","index":0}],[{"node":"Error","type":"main","index":0}]]},"Get Post":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"Basic LLM Chain","type":"ai_languageModel","index":0}]]},"Basic LLM Chain":{"main":[[{"node":"Get Post","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"When Executed by Another Workflow":[{"json":{"user_id":1,"query":"shorts negros"}}]},"versionId":"f71fb1ef-7b51-4181-b185-6cc52dfd5b2c","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-08-15T08:13:34.432Z","updatedAt":"2025-08-15T08:13:34.432Z","role":"workflow:owner","workflowId":"m1C0fDvKzxk2V9jA","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-15T08:35:13.910Z","updatedAt":"2025-08-15T08:52:40.000Z","id":"YPncLwo6PxsKGbrc","name":"Smarth post post tool","active":false,"isArchived":false,"nodes":[{"parameters":{"workflowInputs":{"values":[{"name":"user_id","type":"number"},{"name":"query"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-352,16],"id":"4779886d-bed1-4d87-af6c-ca92223510e2","name":"When Executed by Another Workflow"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"3428167e-6d6c-4120-b19e-78131b268203","leftValue":"={{ $json.user_id }}","rightValue":0,"operator":{"type":"number","operation":"gt"}},{"id":"81193892-12d6-4fb1-b684-03ca64338dcb","leftValue":"={{ $json.query }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-160,16],"id":"b58ab39c-75a4-4748-92ef-7497dba3a6b8","name":"If"},{"parameters":{"mode":"raw","jsonOutput":"={\n  \"success\": false,\n  \"error\": {\n    \"code\": 400,\n    \"message\": \"El ID de usuario no puede ser menor o igual a 0.\",\n    \"details\": {\n      \"field\": \"user_id\",\n      \"value\": {{ $json.user_id }}\n    }\n  }\n}\n ","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[48,160],"id":"333e989a-ba65-4479-b7ba-887beee42ff4","name":"Error"},{"parameters":{"operation":"executeQuery","query":"{{ $json.text }}","options":{}},"type":"n8n-nodes-base.mySql","typeVersion":2.4,"position":[400,-176],"id":"4d96abbf-f4fb-4b13-8715-9c09c094dc08","name":"Get Post","alwaysOutputData":true,"credentials":{"mySql":{"id":"AsCrflZ4i9MJXTa9","name":"MySQL account"}},"onError":"continueRegularOutput"},{"parameters":{"promptType":"define","text":"=Consulta: {{ $json.query }}\n\nuser id: {{ $json.user_id }}","messages":{"messageValues":[{"message":"=Eres un asistente especializado en generar consultas SQL para WordPress. Tu tarea es producir consultas SQL seguras y precisas que permitan crear nuevas entradas en WordPress, asignando como autor al user_id indicado por el usuario y definiendo los demás valores en base a la información que proporcione el usuario (título, contenido, tipo de entrada, estado, fecha de publicación, etc.).\n\nReglas importantes:\n\nDevuelve solo la consulta SQL pura, sin comillas triples, sin Markdown, sin texto adicional.\n\nLa consulta debe insertar la nueva entrada en la tabla wp_posts y devolver el ID del post creado usando LAST_INSERT_ID().\n\nLos valores que el usuario puede indicar incluyen:\n\npost_title (título de la entrada)\n\npost_content (contenido de la entrada, puede incluir HTML)\n\npost_status (estado, por ejemplo publish o draft)\n\npost_type (tipo de entrada, por ejemplo post o page)\n\npost_date (fecha de publicación; si no se indica, usar la fecha actual)\n\npost_excerpt (resumen opcional)\n\nEl post_author siempre se asigna al user_id indicado por el usuario.\n\nSi algún valor no se indica, se debe asignar un valor por defecto compatible con WordPress (post_status='draft', post_type='post', post_date=NOW()).\n\nEscapa correctamente todos los apóstrofes y caracteres especiales dentro de las cadenas para que sean válidos en MySQL.\n\nLa consulta debe ser compatible con MySQL/MariaDB, como la usa WordPress.\n\nEjemplo de cómo interpretar un pedido:\n\nUsuario dice: “Crear una entrada titulada ‘Hola mundo’ para el usuario con ID 5, tipo post y estado publicado, y devolver el post_id.”\n→ Genera:\nINSERT INTO wp_posts (post_author, post_title, post_content, post_status, post_type, post_date, post_date_gmt)\nVALUES (5, 'Hola mundo', '', 'publish', 'post', NOW(), UTC_TIMESTAMP());\nSELECT LAST_INSERT_ID() AS post_id;\n\nGenera la consulta de manera dinámica según los valores que indique el usuario, solo la consulta SQL completa, lista para devolver directamente el post_id."}]},"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[48,-176],"id":"860b0b84-499a-4eaf-aae7-b0cafb49c699","name":"Basic LLM Chain"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[48,-16],"id":"5b0aeab7-fbf6-4817-8342-b212a39cc34a","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}}],"connections":{"When Executed by Another Workflow":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"Basic LLM Chain","type":"main","index":0}],[{"node":"Error","type":"main","index":0}]]},"Get Post":{"main":[[]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"Basic LLM Chain","type":"ai_languageModel","index":0}]]},"Basic LLM Chain":{"main":[[{"node":"Get Post","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"When Executed by Another Workflow":[{"json":{"user_id":1,"query":"publicaciones del mes pasado"}}]},"versionId":"517c1eb1-bf96-4c1a-a629-439ecd17532a","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-08-15T08:35:13.928Z","updatedAt":"2025-08-15T08:35:13.928Z","role":"workflow:owner","workflowId":"YPncLwo6PxsKGbrc","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-20T14:27:40.443Z","updatedAt":"2025-08-20T14:27:40.443Z","id":"PTeThcjwHVguFbUt","name":"My workflow 18","active":false,"isArchived":false,"nodes":[{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[160,-96],"id":"49226724-0eaa-455c-a5eb-1071b8f17530","name":"When chat message received","webhookId":"48cb70f6-8cad-4d76-8e32-1f8f359e3818"},{"parameters":{"options":{"systemMessage":"=Eres un asistente que ayuda a consultar disponibilidad en un calendario y agendar eventos.\n\nContexto de tiempo (NO lo alteres; úsalo en cada interpretación):\n- Now (America/Argentina/Buenos_Aires): {{ $now.setZone('America/Argentina/Buenos_Aires').toISO() }}\n- TodayDate: {{ $now.setZone('America/Argentina/Buenos_Aires').toISODate() }}\n- TodayWeekday: {{ $now.setZone('America/Argentina/Buenos_Aires').toFormat('cccc') }}\n\nReglas obligatorias:\n1) Interpreta fechas relativas (hoy/mañana/viernes/etc.) usando America/Argentina/Buenos_Aires.\n2) Si el usuario NO da año, asume el año actual. Si la fecha resultante ya pasó, mueve a la PRÓXIMA ocurrencia futura (mismo mes/día pero siguiente año si aplica).\n3) Si el usuario da un día de la semana y también un día/mes, prioriza mantener la FECHA futura y corrige el texto del día si no coincide.\n4) Nunca devuelvas una fecha en el pasado. Si Start ≤ (Now + 5 minutos), mueve el rango a la próxima ocurrencia razonable (p.ej. mismo horario al día siguiente), salvo que pida “ahora”.\n5) Devuelve SIEMPRE:\n   - Start y End en ISO 8601 con offset -03:00\n   - Un mensaje humano corto confirmando (con día de la semana correcto para la FECHA calculada).\n6) Duración: respeta exactamente lo pedido (ej. 10:00–11:00 = 1h).\n\nFormato de salida:\nStart: <ISO8601 -03:00>\nEnd: <ISO8601 -03:00>"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[384,-96],"id":"31e79bda-ff5b-4185-b0f0-0df35bf50482","name":"AI Agent"},{"parameters":{"sseEndpoint":"https://n8n.srv809167.hstgr.cloud/mcp/date/sse"},"type":"@n8n/n8n-nodes-langchain.mcpClientTool","typeVersion":1,"position":[672,128],"id":"9b46a921-8d5b-4ae4-a30a-9e1986230a65","name":"MCP Client"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[480,128],"id":"6f34b0bc-f37b-434a-a674-82c67bd8df5c","name":"Simple Memory"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[304,128],"id":"adb7c2d5-8ae0-44a6-9885-24125af64497","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"89IjBTL65KDWtJ7y","name":"OpenAi account"}}}],"connections":{"When chat message received":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"MCP Client":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"610adabd-ecd4-4541-b85e-b46e51e60822","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-08-20T14:27:40.466Z","updatedAt":"2025-08-20T14:27:40.466Z","role":"workflow:owner","workflowId":"PTeThcjwHVguFbUt","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-20T14:27:44.852Z","updatedAt":"2025-08-20T14:27:44.852Z","id":"1RJmBrYDCCRACgX8","name":"My workflow 18","active":false,"isArchived":false,"nodes":[{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[160,-96],"id":"49226724-0eaa-455c-a5eb-1071b8f17530","name":"When chat message received","webhookId":"48cb70f6-8cad-4d76-8e32-1f8f359e3818"},{"parameters":{"options":{"systemMessage":"=Eres un asistente que ayuda a consultar disponibilidad en un calendario y agendar eventos.\n\nContexto de tiempo (NO lo alteres; úsalo en cada interpretación):\n- Now (America/Argentina/Buenos_Aires): {{ $now.setZone('America/Argentina/Buenos_Aires').toISO() }}\n- TodayDate: {{ $now.setZone('America/Argentina/Buenos_Aires').toISODate() }}\n- TodayWeekday: {{ $now.setZone('America/Argentina/Buenos_Aires').toFormat('cccc') }}\n\nReglas obligatorias:\n1) Interpreta fechas relativas (hoy/mañana/viernes/etc.) usando America/Argentina/Buenos_Aires.\n2) Si el usuario NO da año, asume el año actual. Si la fecha resultante ya pasó, mueve a la PRÓXIMA ocurrencia futura (mismo mes/día pero siguiente año si aplica).\n3) Si el usuario da un día de la semana y también un día/mes, prioriza mantener la FECHA futura y corrige el texto del día si no coincide.\n4) Nunca devuelvas una fecha en el pasado. Si Start ≤ (Now + 5 minutos), mueve el rango a la próxima ocurrencia razonable (p.ej. mismo horario al día siguiente), salvo que pida “ahora”.\n5) Devuelve SIEMPRE:\n   - Start y End en ISO 8601 con offset -03:00\n   - Un mensaje humano corto confirmando (con día de la semana correcto para la FECHA calculada).\n6) Duración: respeta exactamente lo pedido (ej. 10:00–11:00 = 1h).\n\nFormato de salida:\nStart: <ISO8601 -03:00>\nEnd: <ISO8601 -03:00>"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[384,-96],"id":"31e79bda-ff5b-4185-b0f0-0df35bf50482","name":"AI Agent"},{"parameters":{"sseEndpoint":"https://n8n.srv809167.hstgr.cloud/mcp/date/sse"},"type":"@n8n/n8n-nodes-langchain.mcpClientTool","typeVersion":1,"position":[672,128],"id":"9b46a921-8d5b-4ae4-a30a-9e1986230a65","name":"MCP Client"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[480,128],"id":"6f34b0bc-f37b-434a-a674-82c67bd8df5c","name":"Simple Memory"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[304,128],"id":"adb7c2d5-8ae0-44a6-9885-24125af64497","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"89IjBTL65KDWtJ7y","name":"OpenAi account"}}}],"connections":{"When chat message received":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"MCP Client":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"8c9c4f0e-f086-4b04-bf6b-bb42054c5fd3","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-08-20T14:27:44.882Z","updatedAt":"2025-08-20T14:27:44.882Z","role":"workflow:owner","workflowId":"1RJmBrYDCCRACgX8","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-22T05:20:41.757Z","updatedAt":"2025-08-23T00:04:04.000Z","id":"zEWOeKeX1w2zcBrk","name":"My workflow 19","active":true,"isArchived":false,"nodes":[{"parameters":{"public":true,"initialMessages":"","options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.3,"position":[-672,16],"id":"2c78e695-4165-455d-9825-ce25cbcb50b6","name":"When chat message received","webhookId":"7f26eb14-e21c-461c-91e8-4f441e062814"},{"parameters":{"messages":{"messageValues":[{"message":"Instrucciones para el agente:\nTu objetivo único es generar una consulta SQL válida a partir de la pregunta del usuario.\nSiempre responde únicamente con el comando SQL sin comentarios ni textos extra. No utilices markdown. Tu respuesta se utilizara en una consulta SQL sin cambios ni ediciones por lo que no puede contener ningún tipo de información extra al comando SQL solicitado.\nUsa el esquema de la base de datos y los ejemplos de preguntas y consultas proporcionados como referencia para construir la consulta correcta.\nLa consulta SQL debe ser ejecutable directamente sin modificaciones adicionales.\nSiempre responde exactamente con la consulta SQL, incluyendo cualquier alias, joins, condiciones o filtros necesarios según el contexto.\n# Contexto:\n## Tabla: activity\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idActivity | int | NO | PRI | auto_increment |\n| idUser | int | YES | MUL |  |\n| idApplication | int | YES | MUL |  |\n| idWorkstation | int | YES | MUL |  |\n| startTime | datetime | YES | MUL |  |\n| endTime | datetime | YES | MUL |  |\n| totalSeconds | double | YES |  |  |\n| notes | varchar(1000) | YES |  |  |\n| idProject | int | YES | MUL |  |\n| totalSecondsReal | double | YES |  |  |\n| idProjectTask | int | YES | MUL |  |\n| userIdInstance | int | NO | MUL |  |\n| idSite | int | YES |  |  |\n## Tabla: activity_denormalized\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idActivity | int | NO | PRI | auto_increment |\n| idUser | int | YES | MUL |  |\n| userIdInstance | int | YES | MUL |  |\n| userIdRole | int | YES |  |  |\n| userIdImage | int | YES |  |  |\n| idApplication | int | YES | MUL |  |\n| applicationIdCategory | int | YES |  |  |\n| applicationIdImage | bigint | YES |  |  |\n| idProject | int | YES | MUL |  |\n| projectIdInstance | int | YES |  |  |\n| idWorkstation | int | YES | MUL |  |\n| startTime | datetime | YES |  |  |\n| endTime | datetime | YES |  |  |\n| totalSeconds | double | YES |  |  |\n| totalSecondsReal | double | YES |  |  |\n| notes | varchar(1000) | YES | MUL |  |\n| startDate | date | YES | MUL |  |\n| idProjectTask | int | YES | MUL |  |\n| idSite | int | YES |  |  |\n## Tabla: activity_user_task\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idUser | int | NO | PRI |  |\n| idProjectTask | int | NO | PRI |  |\n| totalSeconds | double | YES |  |  |\n## Tabla: activity_user_task_daily\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idActivity | int | NO | PRI |  |\n| idUser | int | NO | PRI |  |\n| idWorkstation | int | NO | PRI |  |\n| idProjectTask | int | NO | PRI |  |\n| totalSeconds | double | YES |  |  |\n| startDate | date | YES |  |  |\n## Tabla: application\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idApplication | int | NO | PRI | auto_increment |\n| idCategory | int | YES | MUL |  |\n| name | varchar(300) | YES |  |  |\n| iconUrl | varchar(45) | YES |  |  |\n| idImage | bigint | YES | MUL |  |\n| idInstance | int | YES |  |  |\n## Tabla: auth_group\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| id | int | NO | PRI | auto_increment |\n| name | varchar(150) | NO | UNI |  |\n## Tabla: auth_group_permissions\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| id | bigint | NO | PRI | auto_increment |\n| group_id | int | NO | MUL |  |\n| permission_id | int | NO | MUL |  |\n## Tabla: auth_permission\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| id | int | NO | PRI | auto_increment |\n| name | varchar(255) | NO |  |  |\n| content_type_id | int | NO | MUL |  |\n| codename | varchar(100) | NO |  |  |\n## Tabla: auth_user\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| id | int | NO | PRI | auto_increment |\n| password | varchar(128) | NO |  |  |\n| last_login | datetime(6) | YES |  |  |\n| is_superuser | tinyint(1) | NO |  |  |\n| username | varchar(150) | NO | UNI |  |\n| first_name | varchar(150) | NO |  |  |\n| last_name | varchar(150) | NO |  |  |\n| email | varchar(254) | NO |  |  |\n| is_staff | tinyint(1) | NO |  |  |\n| is_active | tinyint(1) | NO |  |  |\n| date_joined | datetime(6) | NO |  |  |\n## Tabla: auth_user_groups\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| id | bigint | NO | PRI | auto_increment |\n| user_id | int | NO | MUL |  |\n| group_id | int | NO | MUL |  |\n## Tabla: auth_user_user_permissions\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| id | bigint | NO | PRI | auto_increment |\n| user_id | int | NO | MUL |  |\n| permission_id | int | NO | MUL |  |\n## Tabla: bought\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idBought | int | NO | PRI | auto_increment |\n| idInstance | int | NO | MUL |  |\n| endTime | datetime | YES |  |  |\n| startTime | datetime | YES |  |  |\n## Tabla: category\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idCategory | int | NO | PRI | auto_increment |\n| name | varchar(255) | YES |  |  |\n| idInstance | int | YES |  |  |\n| idImage | int | YES | MUL |  |\n## Tabla: category_application_classification\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idCategory | int | NO | PRI | auto_increment |\n| idApplication | int | NO | PRI |  |\n## Tabla: categorysite\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idCategorysite | int | NO | PRI | auto_increment |\n| idInstance | int | YES | MUL |  |\n| name | varchar(255) | YES |  |  |\n| idImage | int | YES | MUL |  |\n## Tabla: categorysite_site_classification\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idCategorysite | int | NO | PRI |  |\n| idSite | int | NO | PRI |  |\n## Tabla: company_business_subtype\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idCompanyBusinessSubtype | int | NO | PRI | auto_increment |\n| name | varchar(200) | NO |  |  |\n| idCompanyBusinessType | int | NO | MUL |  |\n## Tabla: company_business_type\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idCompanyBusinessType | int | NO | PRI | auto_increment |\n| name | varchar(200) | NO |  |  |\n## Tabla: complexity\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idComplexity | int | NO | PRI |  |\n| name | varchar(10) | NO |  |  |\n## Tabla: conexion_herramienta\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idConexion | int | NO | PRI | auto_increment |\n| idUser | int | NO | MUL |  |\n| dominio | varchar(20) | NO |  |  |\n| token | varchar(500) | NO |  |  |\n| email | varchar(500) | YES |  |  |\n| idTool | int | NO | MUL |  |\n## Tabla: confirmation_token\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idConfirmationToken | int | NO | PRI | auto_increment |\n| token | varchar(200) | YES |  |  |\n| createdDate | timestamp | YES |  |  |\n| idUser | int | YES | MUL |  |\n## Tabla: constants\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idConstants | smallint unsigned | NO | PRI | auto_increment |\n| name | varchar(100) | NO |  |  |\n| value | varchar(500) | NO |  |  |\n## Tabla: currency\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idCurrency | int | NO | PRI | auto_increment |\n| name | varchar(10) | NO |  |  |\n## Tabla: departament\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idDepartament | int | NO | PRI | auto_increment |\n| name | varchar(200) | YES |  |  |\n| idInstance | int | YES | MUL |  |\n## Tabla: django_admin_log\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| id | int | NO | PRI | auto_increment |\n| action_time | datetime(6) | NO |  |  |\n| object_id | longtext | YES |  |  |\n| object_repr | varchar(200) | NO |  |  |\n| action_flag | smallint unsigned | NO |  |  |\n| change_message | longtext | NO |  |  |\n| content_type_id | int | YES | MUL |  |\n| user_id | int | NO | MUL |  |\n## Tabla: django_content_type\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| id | int | NO | PRI | auto_increment |\n| app_label | varchar(100) | NO | MUL |  |\n| model | varchar(100) | NO |  |  |\n## Tabla: django_migrations\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| id | bigint | NO | PRI | auto_increment |\n| app | varchar(255) | NO |  |  |\n| name | varchar(255) | NO |  |  |\n| applied | datetime(6) | NO |  |  |\n## Tabla: django_session\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| session_key | varchar(40) | NO | PRI |  |\n| session_data | longtext | NO |  |  |\n| expire_date | datetime(6) | NO | MUL |  |\n## Tabla: element_interoperability\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idProjectElement | int | NO | PRI |  |\n| idToolTask | varchar(15) | NO | PRI |  |\n| idTool | int | NO | MUL |  |\n## Tabla: element_type\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idElementType | int | NO | PRI | auto_increment |\n| name | varchar(500) | NO |  |  |\n| idProjectType | int | YES | MUL |  |\n| active | tinyint | YES |  |  |\n## Tabla: element_type_task_type\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idElementType | int | NO | PRI |  |\n| idTaskType | int | NO | PRI |  |\n## Tabla: estadistico\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idEstadistico | int | NO | PRI | auto_increment |\n| name | varchar(45) | NO |  |  |\n## Tabla: estimate\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idEstimate | varchar(50) | NO | PRI |  |\n| name | varchar(100) | NO |  |  |\n## Tabla: estimate_element_type\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idElementType | int | NO | PRI |  |\n| idElementSize | int | NO | PRI |  |\n| idElementComplexity | int | NO | PRI |  |\n| idEstimate | varchar(50) | NO | PRI |  |\n| value | double | YES |  |  |\n## Tabla: estimate_phase_type\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idPhaseType | int | NO | PRI |  |\n| idElementSize | int | NO | PRI |  |\n| idElementComplexity | int | NO | PRI |  |\n| idEstimate | varchar(50) | NO | PRI |  |\n| value | double | YES |  |  |\n## Tabla: estimate_project_task\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idProjectTask | int | NO | PRI |  |\n| idElementSize | int | NO | PRI |  |\n| idElementComplexity | int | NO | PRI |  |\n| idEstimate | varchar(50) | NO | PRI |  |\n| value | double | YES |  |  |\n## Tabla: estimate_project_type\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idProjectType | int | NO | PRI |  |\n| idEstimate | varchar(50) | NO | PRI |  |\n| value | double | YES |  |  |\n## Tabla: estimate_task_type\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idTaskType | int | NO | PRI |  |\n| idElementSize | int | NO | PRI |  |\n| idElementComplexity | int | NO | PRI |  |\n| idEstimate | varchar(50) | NO | PRI |  |\n| value | double | YES |  |  |\n## Tabla: estimate_task_type_user\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idTaskType | int | NO | PRI |  |\n| idElementSize | int | NO | PRI |  |\n| idElementComplexity | int | NO | PRI |  |\n| idUser | int | NO | PRI |  |\n| idEstimate | varchar(50) | NO | PRI |  |\n| value | double | YES |  |  |\n## Tabla: feature\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idFeature | int | NO | PRI | auto_increment |\n| code | varchar(100) | NO |  |  |\n| code_T | varchar(100) | NO |  |  |\n| description | varchar(500) | NO |  |  |\n## Tabla: functional_size\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idFunctionalSize | int | NO | PRI |  |\n| name | varchar(100) | NO |  |  |\n## Tabla: image\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idImage | bigint | NO | PRI | auto_increment |\n| name | varchar(255) | YES |  |  |\n| picByte | longblob | YES |  |  |\n| type | varchar(255) | YES |  |  |\n| url | varchar(500) | YES |  |  |\n## Tabla: instance\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idInstance | int | NO | PRI | auto_increment |\n| idUserAdmin | int | YES | MUL |  |\n| name | varchar(200) | YES |  |  |\n| totalMonths | int | YES |  |  |\n| totalUsers | int | YES |  |  |\n| company | varchar(200) | YES |  |  |\n| address | varchar(800) | YES |  |  |\n| idInstanceType | int | NO | MUL |  |\n| lowerProductivity | int | YES |  |  |\n| upperProductivity | int | YES |  |  |\n| startDate | datetime | NO |  | DEFAULT_GENERATED |\n| activeByPayment | tinyint | NO |  |  |\n| idCompanyBusinessSubtype | int | YES | MUL |  |\n| idPaymentPlan | int | NO | MUL |  |\n| efficiency | int | YES |  |  |\n## Tabla: instance_license_type\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idInstance | int | NO | PRI |  |\n| idLicenseType | int | NO | PRI |  |\n| active | tinyint | YES |  |  |\n## Tabla: instance_type\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idInstanceType | int | NO | PRI | auto_increment |\n| name | varchar(200) | NO |  |  |\n## Tabla: interoperabilidad\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idProject | int | NO | PRI |  |\n| idProyectoHerramienta | varchar(50) | NO | PRI |  |\n| idTool | int | NO | MUL |  |\n## Tabla: interoperability_tool\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idTool | int | NO | PRI | auto_increment |\n| tool | varchar(25) | NO |  |  |\n## Tabla: invisible_workstation\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| uuid | varchar(64) | NO | PRI |  |\n| hostname | varchar(100) | YES |  |  |\n| idUser | int | YES | MUL |  |\n| idInstance | int | NO | MUL |  |\n| isEnabled | tinyint | YES |  |  |\n## Tabla: leader_users\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idLeader | int | NO | PRI |  |\n| idUser | int | NO | PRI |  |\n## Tabla: license_type\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idLicenseType | int | NO | PRI | auto_increment |\n| name | varchar(30) | NO |  |  |\n## Tabla: license_type_features\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idLicenseType | int | NO | PRI |  |\n| idFeature | int | NO | PRI |  |\n## Tabla: licenses_active_range\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idLicensesActiveRange | int | NO | PRI | auto_increment |\n| idInstance | int | NO | MUL |  |\n| days | int | YES |  |  |\n## Tabla: logbook\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idLogbook | int | NO | PRI | auto_increment |\n| idUser | int | YES | MUL |  |\n| idInstance | int | YES | MUL |  |\n| idLogbookType | int | YES | MUL |  |\n| action | varchar(500) | YES |  |  |\n| url | varchar(1000) | YES |  |  |\n| method | varchar(500) | YES |  |  |\n| date | datetime | NO |  | DEFAULT_GENERATED |\n| requests | int | YES |  |  |\n| isError | tinyint(1) | YES |  |  |\n| httpCode | varchar(100) | YES |  |  |\n## Tabla: logbook_type\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idLogbookType | int | NO | PRI | auto_increment |\n| url | varchar(1000) | YES |  |  |\n| method | varchar(500) | YES |  |  |\n| name | varchar(500) | YES |  |  |\n## Tabla: measurement_standard\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idMeasurementStandard | int | NO | PRI |  |\n| name | varchar(100) | NO |  |  |\n## Tabla: notification\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idNotification | int | NO | PRI | auto_increment |\n| idUser | int | NO | MUL |  |\n| message | varchar(1000) | YES |  |  |\n| params | varchar(1000) | YES |  |  |\n| datetime | datetime | YES |  |  |\n| seen | tinyint | YES |  |  |\n| icon | varchar(50) | YES |  |  |\n## Tabla: obligatory_hours\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idObligatoryHours | int | NO | PRI | auto_increment |\n| idSchedule | int | NO | MUL |  |\n| monday | int | YES |  |  |\n| tuesday | int | YES |  |  |\n| wednesday | int | YES |  |  |\n| thursday | int | YES |  |  |\n| friday | int | YES |  |  |\n| saturday | int | YES |  |  |\n| sunday | int | YES |  |  |\n## Tabla: payment_plan\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idPaymentPlan | int | NO | PRI | auto_increment |\n| name | varchar(45) | NO |  |  |\n| months | int | NO |  |  |\n| users | int | NO |  |  |\n| admins | int | NO |  |  |\n| price | double | NO |  |  |\n## Tabla: paymentmethodtype\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idPaymentMethodType | int | NO | PRI | auto_increment |\n| name | varchar(255) | NO |  |  |\n## Tabla: phase_type\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idPhase | int | NO | PRI | auto_increment |\n| name | varchar(200) | NO |  |  |\n| active | tinyint | YES |  |  |\n| idElementType | int | NO | MUL |  |\n## Tabla: priceconstant\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idPriceConstant | int | NO | PRI | auto_increment |\n| name | varchar(255) | NO |  |  |\n| value | float | NO |  |  |\n## Tabla: profile\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idProfile | int | NO | PRI | auto_increment |\n| name | varchar(45) | YES |  |  |\n| idInstance | int | NO | MUL |  |\n| description | varchar(255) | YES |  |  |\n## Tabla: profile_application_classification\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idProfile | int | NO | PRI | auto_increment |\n| idApplication | int | NO | PRI |  |\n| isRelevant | tinyint | YES |  |  |\n## Tabla: profile_site_classification\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idProfile | int | NO | PRI |  |\n| idSite | int | NO | PRI |  |\n| isRelevant | tinyint | YES |  |  |\n## Tabla: project\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idProject | int | NO | PRI | auto_increment |\n| name | varchar(200) | NO |  |  |\n| code | varchar(100) | YES |  |  |\n| idInstance | int | NO | MUL |  |\n| idUserInCharge | int | YES | MUL |  |\n| idProjectType | int | YES | MUL |  |\n| dedicatedTime | double | YES |  |  |\n| progress | int | YES |  |  |\n| estimatedDays | int | YES |  |  |\n| estimatedTime | double | YES |  |  |\n| startDate | date | YES |  |  |\n| finishDate | date | YES |  |  |\n| estimatedFinishDate | date | YES |  |  |\n| projectedDate | date | YES |  |  |\n| idStatus | int | NO | MUL |  |\n| estimatedDaysOriginal | int | YES |  |  |\n| estimatedTimeOriginal | double | YES |  |  |\n| idMeasurementStandard | int | YES | MUL |  |\n| created | datetime | NO |  |  |\n| registredDate | date | NO |  |  |\n## Tabla: project_element\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idProjectElement | int | NO | PRI | auto_increment |\n| name | varchar(1000) | NO |  |  |\n| idElementType | int | NO | MUL |  |\n| idProject | int | NO | MUL |  |\n| active | tinyint | YES |  |  |\n| idStatus | int | NO | MUL |  |\n| dedicatedTime | double | YES |  |  |\n| startDate | date | YES |  |  |\n| finishDate | date | YES |  |  |\n| estimatedDays | int | YES |  |  |\n| estimatedTime | double | YES |  |  |\n| estimatedFinishDate | date | YES |  |  |\n| progress | int | YES |  |  |\n| projectedDate | date | YES |  |  |\n| estimatedDaysOriginal | int | YES |  |  |\n| estimatedTimeOriginal | double | YES |  |  |\n| idSize | int | NO | MUL |  |\n| idComplexity | int | NO | MUL |  |\n| functionalSize | double | YES |  |  |\n| created | datetime | NO |  |  |\n| notes | varchar(1000) | YES |  |  |\n## Tabla: project_interoperability\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idProjectInteroperability | int | NO | PRI | auto_increment |\n| idProject | int | NO | UNI |  |\n| idProjectTool | varchar(50) | NO |  |  |\n| idTool | int | NO | MUL |  |\n| idStatusDailyWork | varchar(50) | YES |  |  |\n| idUserInCharge | int | NO |  |  |\n| idEstimationType | int | NO |  |  |\n## Tabla: project_leader\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idProject | int | NO | PRI |  |\n| idUser | int | NO | PRI |  |\n## Tabla: project_phase\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idProjectPhase | int | NO | PRI | auto_increment |\n| idProjectElement | int | NO | MUL |  |\n| idStatus | int | NO | MUL |  |\n| idPhaseType | int | NO | MUL |  |\n| dedicatedTime | double | YES |  |  |\n| startDate | date | YES |  |  |\n| finishDate | date | YES |  |  |\n| estimatedDays | int | YES |  |  |\n| estimatedTime | double | YES |  |  |\n| estimatedFinishDate | date | YES |  |  |\n| progress | int | YES |  |  |\n| projectedDate | date | YES |  |  |\n| active | tinyint | YES |  |  |\n| estimatedDaysOriginal | int | YES |  |  |\n| estimatedTimeOriginal | double | YES |  |  |\n| created | datetime | NO |  |  |\n## Tabla: project_task\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idProjectTask | int | NO | PRI | auto_increment |\n| idStatus | int | NO | MUL |  |\n| idTaskType | int | NO | MUL |  |\n| startDate | datetime | YES |  |  |\n| finishDate | datetime | YES |  |  |\n| active | tinyint | YES |  |  |\n| idProjectPhase | int | YES | MUL |  |\n| dedicatedTime | double | YES |  |  |\n| estimatedDays | int | YES |  |  |\n| estimatedTime | double | YES |  |  |\n| estimatedFinishDate | date | YES |  |  |\n| progress | int | YES |  |  |\n| projectedDate | date | YES |  |  |\n| estimatedDaysOriginal | int | YES |  |  |\n| estimatedTimeOriginal | double | YES |  |  |\n| created | datetime | NO |  |  |\n| registredDate | date | YES |  |  |\n## Tabla: project_task_comment\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idComment | int | NO | PRI | auto_increment |\n| comment | varchar(2000) | NO |  |  |\n| idUser | int | NO | MUL |  |\n| idProjectTask | int | NO | MUL |  |\n| created | datetime | YES |  |  |\n| updated | datetime | YES |  |  |\n| idFile | int | YES | MUL |  |\n## Tabla: project_type\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idProjectType | int | NO | PRI | auto_increment |\n| name | varchar(200) | NO |  |  |\n| isModifiable | tinyint | YES |  |  |\n| active | tinyint | YES |  |  |\n| idInstance | int | NO | MUL |  |\n## Tabla: project_user\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idProject | int | NO | PRI |  |\n| idUser | int | NO | PRI |  |\n## Tabla: requestinvoice\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idRequestInvoice | int | NO | PRI | auto_increment |\n| idInstance | int | NO | MUL |  |\n| idStripeInvoice | varchar(1024) | NO |  |  |\n| status | varchar(25) | NO |  |  |\n| users | int | YES |  |  |\n| requested | tinyint | YES |  |  |\n## Tabla: results_project_task_type\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idTaskType | int | NO | PRI |  |\n| idEstadistico | int | NO | PRI |  |\n| value | double | YES |  |  |\n## Tabla: results_user_task_type\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idTaskType | int | NO | PRI |  |\n| idUser | int | NO | PRI |  |\n| idEstadistico | int | NO | PRI |  |\n| value | double | YES |  |  |\n## Tabla: role\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idRole | int | NO | PRI | auto_increment |\n| role | varchar(200) | YES |  |  |\n| accessLevel | int | NO |  |  |\n| code | varchar(100) | YES |  |  |\n## Tabla: schedule\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idSchedule | int | NO | PRI | auto_increment |\n| name | varchar(200) | NO |  |  |\n| idInstance | int | NO | MUL |  |\n## Tabla: schedule_day\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idScheduleDay | int | NO | PRI | auto_increment |\n| idSchedule | int | NO | MUL |  |\n| dayOfWeek | int | NO |  |  |\n| start | varchar(10) | YES |  |  |\n| end | varchar(10) | YES |  |  |\n| isBreakTime | tinyint(1) | NO |  |  |\n| obligatoryHours | smallint | YES |  |  |\n| startBreak | varchar(10) | YES |  |  |\n| endBreak | varchar(10) | YES |  |  |\n| breakDuration | varchar(10) | YES |  |  |\n| hasBreakTime | tinyint | YES |  |  |\n| workDuration | varchar(10) | YES |  |  |\n| breakDurationTime | int | YES |  |  |\n| workDurationTime | int | YES |  |  |\n## Tabla: schedule_user\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idSchedule | int | NO | PRI |  |\n| idUser | int | NO | PRI |  |\n## Tabla: schema_version\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| version_rank | int | NO | MUL |  |\n| installed_rank | int | NO | MUL |  |\n| version | varchar(50) | NO | PRI |  |\n| description | varchar(200) | NO |  |  |\n| type | varchar(20) | NO |  |  |\n| script | varchar(1000) | NO |  |  |\n| checksum | int | YES |  |  |\n| installed_by | varchar(100) | NO |  |  |\n| installed_on | timestamp | NO |  | DEFAULT_GENERATED |\n| execution_time | int | NO |  |  |\n| success | tinyint(1) | NO | MUL |  |\n## Tabla: site\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idSite | int | NO | PRI | auto_increment |\n| name | varchar(200) | YES |  |  |\n| tags | varchar(500) | YES |  |  |\n| idInstance | int | YES | MUL |  |\n| idImage | bigint | YES | MUL |  |\n## Tabla: size\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idSize | int | NO | PRI |  |\n| name | varchar(10) | NO |  |  |\n## Tabla: status\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idStatus | int | NO | PRI |  |\n| name | varchar(500) | NO |  |  |\n## Tabla: status_interoperability\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idTool | int | NO | PRI |  |\n| idStatus | int | NO | PRI |  |\n| statusInteroperability | varchar(25) | NO |  |  |\n## Tabla: status_project_interoperability\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idProjectInteroperability | int | NO | PRI |  |\n| idStatusInteroperability | varchar(50) | NO | PRI |  |\n| idStatus | int | NO | MUL |  |\n## Tabla: stripepaymentmethod\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idStripePaymentMethod | int | NO | PRI | auto_increment |\n| idSubscription | int | NO | MUL |  |\n| idUser | int | NO | MUL |  |\n| id | varchar(1024) | YES |  |  |\n| email | varchar(500) | NO |  |  |\n| taxid | varchar(30) | NO |  |  |\n| holder | varchar(255) | NO |  |  |\n| address | varchar(1024) | NO |  |  |\n| zipcode | varchar(10) | NO |  |  |\n| state | varchar(255) | YES |  |  |\n| city | varchar(255) | NO |  |  |\n| country | varchar(255) | NO |  |  |\n| isPrincipal | tinyint | YES |  |  |\n| idPaymentMethodType | int | NO | MUL |  |\n| stripeTaxid | varchar(1024) | YES |  |  |\n## Tabla: subscription\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idSubscription | int | NO | PRI | auto_increment |\n| idInstance | int | NO | MUL |  |\n| idStripeCustomer | varchar(1024) | NO |  |  |\n| idStripeSubscription | varchar(1024) | YES |  |  |\n| frequency | int | NO |  |  |\n| userQuantity | int | NO |  |  |\n| price | float | YES |  |  |\n| idCurrency | int | NO | MUL |  |\n| canceled | tinyint | YES |  |  |\n| created | datetime | NO |  |  |\n| updated | datetime | NO |  |  |\n| adminQuantity | int | YES |  |  |\n| description | varchar(500) | YES |  |  |\n## Tabla: subscriptionbackup\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idSubscriptionBackup | int | NO | PRI | auto_increment |\n| idSubscription | int | NO | MUL |  |\n| idStripeSubscription | varchar(1024) | YES |  |  |\n| frequency | int | NO |  |  |\n| userQuantity | int | NO |  |  |\n| price | float | YES |  |  |\n| idCurrency | int | NO | MUL |  |\n| canceled | tinyint | YES |  |  |\n| created | datetime | NO |  |  |\n| updated | datetime | NO |  |  |\n## Tabla: summary_activity\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idActivity | int | NO | PRI | auto_increment |\n| idUser | int | YES | MUL |  |\n| userIdInstance | int | YES | MUL |  |\n| userIdRole | int | YES |  |  |\n| userIdImage | int | YES |  |  |\n| idApplication | int | YES | MUL |  |\n| applicationIdCategory | int | YES |  |  |\n| applicationIdImage | bigint | YES |  |  |\n| idProject | int | YES | MUL |  |\n| projectIdInstance | int | YES |  |  |\n| idWorkstation | int | YES | MUL |  |\n| startDate | date | YES | MUL |  |\n| totalSeconds | double | YES |  |  |\n| totalSecondsReal | double | YES |  |  |\n| idProjectTask | int | YES | MUL |  |\n| startTime | datetime | YES |  |  |\n| endTime | datetime | YES |  |  |\n## Tabla: summary_licence\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idSummaryLicence | int | NO | PRI | auto_increment |\n| idInstance | int | NO | MUL |  |\n| idApplication | int | NO | MUL |  |\n| idUser | int | NO | MUL |  |\n| idWorkstation | int | YES | MUL |  |\n| lastDateUsed | datetime | YES |  |  |\n## Tabla: task_type\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idTaskType | int | NO | PRI | auto_increment |\n| name | varchar(1000) | NO |  |  |\n| idPhase | int | NO | MUL |  |\n| active | tinyint | YES |  |  |\n## Tabla: tmp_measure_user_activity_denormalized\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idActivity | int | NO | PRI | auto_increment |\n| idUser | int | YES |  |  |\n| userIdInstance | int | YES |  |  |\n| userIdRole | int | YES |  |  |\n| userEmail | varchar(500) | YES |  |  |\n| userName | varchar(500) | YES |  |  |\n| userCompany | varchar(255) | YES |  |  |\n| userLastname | varchar(500) | YES |  |  |\n| userPhone | varchar(45) | YES |  |  |\n| userIdImage | int | YES |  |  |\n| userIsEnabled | tinyint | YES |  |  |\n| idApplication | int | YES |  |  |\n| applicationIdCategory | int | YES |  |  |\n| applicationName | varchar(300) | YES |  |  |\n| applicationIconUrl | varchar(45) | YES |  |  |\n| applicationIdImage | bigint | YES |  |  |\n| idProject | int | YES |  |  |\n| projectName | varchar(200) | YES |  |  |\n| projectCode | varchar(100) | YES |  |  |\n| projectIdInstance | int | YES |  |  |\n| idWorkstation | int | YES |  |  |\n| workstationName | varchar(100) | YES |  |  |\n| workstationAlias | varchar(100) | YES |  |  |\n| workstationSerialNumber | varchar(100) | YES |  |  |\n| workstationIsEnabled | tinyint | YES |  |  |\n| startTime | datetime | YES |  |  |\n| endTime | datetime | YES |  |  |\n| totalSeconds | double | YES |  |  |\n| totalSecondsReal | double | YES |  |  |\n| notes | varchar(1000) | YES |  |  |\n## Tabla: token_white_list\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idToken | int | NO | PRI | auto_increment |\n| token | varchar(255) | YES |  |  |\n| idUser | int | NO | MUL |  |\n| mac | varchar(100) | YES |  |  |\n| hostname | varchar(100) | YES |  |  |\n| app | varchar(100) | YES |  |  |\n## Tabla: trial\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idTrial | int | NO | PRI | auto_increment |\n| idInstance | int | YES | MUL |  |\n| startTime | datetime | YES |  |  |\n| endTime | datetime | YES |  |  |\n| isExpired | tinyint | YES |  |  |\n| hasBought | tinyint | YES |  |  |\n## Tabla: trueffort_exceptions\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idTrueffortExceptions | smallint unsigned | NO | PRI | auto_increment |\n| idInstance | int | NO | MUL |  |\n| name | varchar(100) | NO |  |  |\n| value | varchar(100) | NO |  |  |\n## Tabla: uploaded_file\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idFile | int | NO | PRI | auto_increment |\n| name | varchar(255) | NO |  |  |\n| type | varchar(255) | NO |  |  |\n| url | varchar(500) | NO |  |  |\n## Tabla: user\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idUser | int | NO | PRI | auto_increment |\n| idInstance | int | YES | MUL |  |\n| idRole | int | YES | MUL |  |\n| email | varchar(500) | YES |  |  |\n| name | varchar(500) | YES |  |  |\n| password | varchar(255) | YES |  |  |\n| company | varchar(255) | YES |  |  |\n| lastname | varchar(500) | YES |  |  |\n| phone | varchar(45) | YES |  |  |\n| idImage | int | YES |  |  |\n| isEnabled | tinyint | YES |  |  |\n| langCode | varchar(10) | YES |  |  |\n| idUserCompanyRoleType | int | YES | MUL |  |\n| idUserCompanyPositionType | int | YES | MUL |  |\n| timeFormat | varchar(10) | NO |  |  |\n| isConfirmed | tinyint | YES |  |  |\n| idDepartament | int | YES | MUL |  |\n| isInvisible | tinyint | YES |  |  |\n| hourlyRate | double | YES |  |  |\n## Tabla: user_application_classification\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idUser | int | NO | PRI | auto_increment |\n| idApplication | int | NO | PRI |  |\n| isRelevant | tinyint | YES |  |  |\n## Tabla: user_company_position_type\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idUserCompanyPositionType | int | NO | PRI | auto_increment |\n| name | varchar(200) | NO |  |  |\n## Tabla: user_company_role_type\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idUserCompanyRoleType | int | NO | PRI | auto_increment |\n| name | varchar(200) | NO |  |  |\n## Tabla: user_instance\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idUser | int | NO | PRI |  |\n| idInstance | int | NO | PRI |  |\n| idRole | int | NO | MUL |  |\n| confirmed | tinyint | YES |  |  |\n## Tabla: user_interoperability\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idUser | int | NO | PRI |  |\n| idToolUser | varchar(64) | NO | PRI |  |\n| idTool | int | NO |  |  |\n## Tabla: user_profile\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idUser | int | NO | PRI |  |\n| idProfile | int | NO | PRI |  |\n## Tabla: user_project_task\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idUser | int | NO | PRI |  |\n| idProjectTask | int | NO | PRI |  |\n| idStatus | int | YES | MUL |  |\n| startDate | datetime | YES |  |  |\n| finishDate | datetime | YES |  |  |\n| dedicatedTime | double | YES |  |  |\n| durationDays | int | YES |  |  |\n## Tabla: user_site_classification\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idUser | int | NO | PRI | auto_increment |\n| idSite | int | NO | PRI |  |\n| isRelevant | tinyint | YES |  |  |\n## Tabla: version\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idVersion | smallint unsigned | NO | PRI | auto_increment |\n| version | varchar(100) | YES |  |  |\n| notes | varchar(1000) | YES |  |  |\n## Tabla: version_client\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idVersionClient | smallint unsigned | NO | PRI | auto_increment |\n| version | varchar(100) | YES |  |  |\n| notes | varchar(1000) | YES |  |  |\n## Tabla: whatsapp_bitacora\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| id | int | NO | PRI | auto_increment |\n| idUser | int | YES |  |  |\n| input | varchar(255) | YES |  |  |\n| output | text | YES |  |  |\n| tool_input | text | YES |  |  |\n| input_tokens | int | YES |  |  |\n| output_tokens | int | YES |  |  |\n| model_name | varchar(40) | YES |  |  |\n| timestamp | int | YES |  |  |\n## Tabla: workstation\n| Columna | Tipo | Nulo | Llave | Extra |\n|---------|------|------|-------|-------|\n| idWorkstation | int | NO | PRI | auto_increment |\n| name | varchar(100) | YES |  |  |\n| alias | varchar(100) | YES |  |  |\n| serialNumber | varchar(100) | YES |  |  |\n| isEnabled | tinyint | YES |  |  |\n| idInstance | int | YES | MUL |  |\n# Ejemplos de preguntas de usuario y consultas SQL correctas:\n**Pregunta:** ¿Cuál es el tiempo total (en segundos) dedicado por cada usuario?\n**SQL:**\nsql\nSELECT\n  idUser,\n  SUM(totalSeconds) AS total_time_seconds\nFROM activity\nGROUP BY\n  idUser\nORDER BY\n  total_time_seconds DESC;\n\n**Pregunta:** ¿Quiénes son los 5 usuarios que han registrado más tiempo y cuál es su nombre?\n**SQL:**\nsql\nSELECT\n  u.name,\n  u.lastname,\n  SUM(a.totalSeconds) / 3600 AS total_hours_registered\nFROM activity AS a\nJOIN user AS u\n  ON a.idUser = u.idUser\nGROUP BY\n  u.idUser\nORDER BY\n  total_hours_registered DESC\nLIMIT 5;\n\n**Pregunta:** ¿Qué usuarios no han registrado ninguna actividad?\n**SQL:**\nsql\nSELECT\n  u.idUser,\n  u.name,\n  u.email\nFROM user AS u\nLEFT JOIN activity AS a\n  ON u.idUser = a.idUser\nWHERE\n  a.idUser IS NULL;\n\n### Consultas sobre Proyectos\n**Pregunta:** ¿Cuál es el tiempo total dedicado a cada proyecto?\n**SQL:**\nsql\nSELECT\n  p.name AS project_name,\n  SUM(a.totalSeconds) / 3600 AS total_hours\nFROM activity AS a\nJOIN project AS p\n  ON a.idProject = p.idProject\nGROUP BY\n  p.idProject\nORDER BY\n  total_hours DESC;\n\n**Pregunta:** Listar todos los proyectos que están retrasados (la fecha actual es posterior a `estimatedFinishDate` y el estado no es \"completado\").\n**SQL:**\nsql\n-- Suponiendo que el idStatus para \"Completado\" es, por ejemplo, 4\nSELECT\n  name,\n  estimatedFinishDate,\n  finishDate\nFROM project\nWHERE\n  estimatedFinishDate < CURDATE() AND idStatus != 4;\n\n**Pregunta:** ¿Cuántos usuarios están asignados a cada proyecto?\n**SQL:**\nsql\nSELECT\n  p.name AS project_name,\n  COUNT(pu.idUser) AS number_of_users\nFROM project_user AS pu\nJOIN project AS p\n  ON pu.idProject = p.idProject\nGROUP BY\n  pu.idProject\nORDER BY\n  number_of_users DESC;\n\n### Consultas sobre Aplicaciones y Sitios\n**Pregunta:** ¿Cuáles son las aplicaciones más utilizadas, medidas por el tiempo total de uso en horas?\n**SQL:**\nsql\nSELECT\n  app.name AS application_name,\n  SUM(act.totalSeconds) / 3600 AS total_hours_of_use\nFROM activity_denormalized AS act\nJOIN application AS app\n  ON act.idApplication = app.idApplication\nWHERE\n  act.idApplication IS NOT NULL\nGROUP BY\n  app.name\nORDER BY\n  total_hours_of_use DESC\nLIMIT 10;\n\n**Pregunta:** ¿Qué usuarios han utilizado una aplicación específica (por ejemplo, idApplication = 15)?\n**SQL:**\nsql\nSELECT DISTINCT\n  u.name,\n  u.lastname,\n  u.email\nFROM activity AS a\nJOIN user AS u\n  ON a.idUser = u.idUser\nWHERE\n  a.idApplication = 15;\n\n### Consultas más Complejas (Costos y Rendimiento)\n**Pregunta:** Calcular el costo total de cada proyecto basado en el tiempo registrado y la tarifa por hora de cada usuario.\n**SQL:**\nsql\nSELECT\n  p.name AS project_name,\n  SUM(a.totalSeconds / 3600 * u.hourlyRate) AS total_project_cost\nFROM project AS p\nJOIN activity AS a\n  ON p.idProject = a.idProject\nJOIN user AS u\n  ON a.idUser = u.idUser\nWHERE\n  u.hourlyRate IS NOT NULL AND u.hourlyRate > 0\nGROUP BY\n  p.idProject\nORDER BY\n  total_project_cost DESC;\n\n**Pregunta:** Mostrar el tiempo total trabajado por cada usuario en un día específico (por ejemplo, '2023-10-26').\n**SQL:**\nsql\nSELECT\n  u.name,\n  SUM(ad.totalSeconds) AS seconds_worked\nFROM activity_denormalized AS ad\nJOIN user AS u\n  ON ad.idUser = u.idUser\nWHERE\n  ad.startDate = '2023-10-26'\nGROUP BY\n  u.idUser;\n\n**Pregunta:** Listar todas las tareas ('project_task') de un proyecto específico ('idProject' = 5) junto con el nombre del tipo de tarea.\n**SQL:**\nsql\nSELECT\n  pt.idProjectTask,\n  tt.name AS task_type,\n  pt.dedicatedTime,\n  pt.progress\nFROM project_task AS pt\nJOIN task_type AS tt\n  ON pt.idTaskType = tt.idTaskType\nJOIN project_phase AS pp\n  ON pt.idProjectPhase = pp.idProjectPhase\nJOIN project_element AS pe\n  ON pp.idProjectElement = pe.idProjectElement\nWHERE\n  pe.idProject = 5;"}]},"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[-352,16],"id":"cc07d035-f744-47b0-bb5e-113a4e953f8d","name":"Basic LLM Chain"},{"parameters":{"options":{"temperature":0.4}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-336,144],"id":"7e1d2efc-6183-4e1a-a33e-5ebc443da1ab","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"operation":"executeQuery","query":"{{ $json.text }}","options":{}},"type":"n8n-nodes-base.mySql","typeVersion":2.5,"position":[-16,16],"id":"8c5b6a45-8d36-409b-8ca6-a909ca17cff3","name":"Execute a SQL query","credentials":{"mySql":{"id":"5WN2RKSM234W4gAL","name":"MySQL account 2"}}},{"parameters":{"jsCode":"// Acceder a los items entrantes\nconst inputItems = items;\n\n// Convertir todos los items a un array de JSON y luego a string\nconst resultsString = JSON.stringify(inputItems.map(item => item.json));\n\nreturn [{ json: { results: resultsString } }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-656,432],"id":"cb131d0e-7c3f-45f0-923e-ccf1170a991c","name":"Code"},{"parameters":{"content":"## Input \n**Usuario** escribe una consulta en lenguaje natural","height":416,"width":320},"type":"n8n-nodes-base.stickyNote","position":[-704,-128],"typeVersion":1,"id":"28c86526-6ed0-4557-a6a0-293ecd6e1cbe","name":"Sticky Note"},{"parameters":{"content":"## AI \n**Modelo AI** crea una consulta SQL apropiada para la consulta","height":416,"width":304,"color":3},"type":"n8n-nodes-base.stickyNote","position":[-384,-128],"typeVersion":1,"id":"5cde9982-977b-4cde-bc96-b96cca3ab745","name":"Sticky Note1"},{"parameters":{"content":"## Consulta \n**La consulta SQL generada** se realiza a la DB","height":416,"color":5},"type":"n8n-nodes-base.stickyNote","position":[-80,-128],"typeVersion":1,"id":"b5263eb8-1287-44a3-a87a-9ea2c648e95b","name":"Sticky Note2"},{"parameters":{"content":"## Output \n**La respuesta** es agrupada en un solo elemento","height":416,"width":560,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-704,288],"typeVersion":1,"id":"053c333e-5c84-48d9-979b-bc82f078ba61","name":"Sticky Note3"},{"parameters":{"promptType":"define","text":"=user: {{ $json.chatInput }}\ndata: {{ $json.results }}","messages":{"messageValues":[{"message":"Basado en la consulta del usuario y la data que te proporciona redacta una respuesta en lenguaje natural que sea breve, directa y concreta. "}]},"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[-96,416],"id":"2e6df34c-934e-4cae-a7cf-cceb82db5e59","name":"Basic LLM Chain1"},{"parameters":{"modelName":"models/gemini-2.0-flash","options":{"temperature":0.4}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-96,592],"id":"c0c51088-206d-46b0-a2e7-e54ce4b3772b","name":"Google Gemini Chat Model1","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"content":"## AI \n**Modelo AI** crea una respuesta para la consulta del usuario","height":416,"width":304,"color":3},"type":"n8n-nodes-base.stickyNote","position":[-144,288],"typeVersion":1,"id":"99e642e8-346e-4c23-a345-23a3a543250e","name":"Sticky Note4"},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[-432,416],"id":"d257441e-40e8-4cb9-8ef2-5676f35337c6","name":"Merge"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"results"},{"fieldToAggregate":"chatInput"}]},"options":{"mergeLists":false}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-272,416],"id":"9ca4605f-c79d-41ed-b1f4-9a43f8d040fa","name":"Aggregate"}],"connections":{"When chat message received":{"main":[[{"node":"Basic LLM Chain","type":"main","index":0},{"node":"Merge","type":"main","index":0}]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"Basic LLM Chain","type":"ai_languageModel","index":0}]]},"Basic LLM Chain":{"main":[[{"node":"Execute a SQL query","type":"main","index":0}]]},"Execute a SQL query":{"main":[[{"node":"Code","type":"main","index":0}],[]]},"Google Gemini Chat Model1":{"ai_languageModel":[[{"node":"Basic LLM Chain1","type":"ai_languageModel","index":0}]]},"Code":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Basic LLM Chain1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"When chat message received":[{"json":{"action":"sendMessage","sessionId":"111ded43-3d17-42b9-bc7c-268b69450d84","chatInput":"Cual es el usuario con menos productividad en Spingere"}}]},"versionId":"626bfda9-c73c-4d05-ac38-c18e7781721c","triggerCount":1,"tags":[],"shared":[{"createdAt":"2025-08-22T05:20:41.780Z","updatedAt":"2025-08-22T05:20:41.780Z","role":"workflow:owner","workflowId":"zEWOeKeX1w2zcBrk","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-22T16:19:52.824Z","updatedAt":"2025-08-22T16:19:52.824Z","id":"a0TkbwC93ckYyx0w","name":"My workflow 20","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[0,0],"id":"cd9d6c22-5281-4a83-9c20-f313fa6b4b93","name":"When clicking ‘Execute workflow’"},{"parameters":{"additionalFields":{}},"type":"n8n-nodes-base.grafana","typeVersion":1,"position":[208,0],"id":"b28de611-a9d1-4597-8427-0e9431e6d35b","name":"Create a dashboard"}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"Create a dashboard","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"d1e2496d-75c8-44af-a472-d33c3dc86fe0","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-08-22T16:19:52.854Z","updatedAt":"2025-08-22T16:19:52.854Z","role":"workflow:owner","workflowId":"a0TkbwC93ckYyx0w","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-23T18:28:32.380Z","updatedAt":"2025-08-24T15:35:14.000Z","id":"QjFeJWta37xCtd6Z","name":"WP_login","active":false,"isArchived":false,"nodes":[{"parameters":{"formTitle":"Login","formFields":{"values":[{"fieldLabel":"User","requiredField":true},{"fieldLabel":"Password","fieldType":"password","requiredField":true}]},"responseMode":"lastNode","options":{"appendAttribution":false,"buttonLabel":"Login","path":"login"}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[0,0],"id":"6db12145-db58-476e-ac6d-6cee1bd5e16d","name":"On form submission","webhookId":"cd286bb4-06a9-4f1e-be93-1efb72d6626b"},{"parameters":{"assignments":{"assignments":[{"id":"a59f3364-d755-4ff7-aa9c-491bcf9e1098","name":"User","value":"={{ $json.User }}","type":"string"},{"id":"d7719a9e-8ad3-4e1b-8dda-b348ad900879","name":"Password","value":"={{ $json.Password }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[208,0],"id":"8a06e8aa-6d34-4025-aab0-85b8d4b38224","name":"Edit Fields"},{"parameters":{"method":"POST","url":"http://localhost/wordpress/wp-json/jwt-auth/v1/token","sendBody":true,"bodyParameters":{"parameters":[{"name":"username","value":"={{ $json.User }}"},{"name":"password","value":"={{ $json.Password }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[416,0],"id":"a3df5c53-ea7f-45c4-a133-7c7cab015b70","name":"HTTP Request"},{"parameters":{"method":"POST","url":"http://localhost/wordpress/wp-json/jwt-auth/v1/token/validate","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $json.token }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[624,0],"id":"4cc4cfa7-e4e3-41d3-9e65-711e8ece4063","name":"HTTP Request1"}],"connections":{"On form submission":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"HTTP Request1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"60e12ad3-236f-45ce-85df-5ba18a750c15","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-08-23T18:28:32.398Z","updatedAt":"2025-08-23T18:28:32.398Z","role":"workflow:owner","workflowId":"QjFeJWta37xCtd6Z","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-24T14:38:26.716Z","updatedAt":"2025-08-24T17:21:30.000Z","id":"sKFey1dRPZ392E3L","name":"SQL_tool","active":false,"isArchived":false,"nodes":[{"parameters":{"promptType":"define","text":"={{ $json.q }}","messages":{"messageValues":[{"message":"Eres un agente de IA especializado en transformar pedidos de usuarios en consultas SQL válidas y ejecutables. Tienes permitido realizar cualquier operación del CRUD que sea necesaria. Tu única función es devolver **exclusivamente la consulta SQL**, sin ningún texto adicional, explicaciones, comentarios, saltos de línea innecesarios o formato markdown (como ```sql o ~~~).\n\nReglas estrictas:\n- Solo devuelve la consulta SQL.\n- No agregues espacios, líneas, ni texto antes ni después.\n- No uses comentarios ni anotaciones.\n\nEjemplo:\nPregunta del usuario: \"¿Cuántos registros existen en la tabla offices?\"\nRespuesta correcta: SELECT count(*) FROM offices\n\nNunca respondas con markdown, texto explicativo o comentarios. Solo la consulta SQL pura."}]},"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[-32,-448],"id":"5b870463-88d4-4e4d-b1d7-b2ac318ca29b","name":"Basic LLM Chain"},{"parameters":{"modelName":"models/gemini-2.0-flash-lite","options":{"temperature":0.4}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-32,-192],"id":"be0cb468-0c96-407f-912a-5ddd46db8979","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"operation":"executeQuery","query":"{{ $json.text }}","options":{}},"type":"n8n-nodes-base.mySql","typeVersion":2.5,"position":[112,-224],"id":"469e3def-c932-4e37-975c-58feb63a625f","name":"Execute a SQL query","credentials":{"mySql":{"id":"2r6ekNvbokW1jkwV","name":"MySQL account 3"}},"onError":"continueErrorOutput"},{"parameters":{"workflowInputs":{"values":[{"name":"q"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-384,-416],"id":"9134b98b-4d41-4edc-a2cc-7f082c59cf04","name":"When Executed by Another Workflow"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"d53b2ad8-1353-4344-888e-4e7fa09e3a58","leftValue":"={{ $json.q }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}},{"id":"b12d0c94-986d-4b8b-9f8f-9260e9e31131","leftValue":"={{ $json.q }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-192,-416],"id":"8cc8d5bb-1586-40c1-b2b2-464fe95f91af","name":"If"},{"parameters":{"assignments":{"assignments":[{"id":"bd21f026-59da-4cd8-9222-d1034637b20c","name":"success","value":false,"type":"boolean"},{"id":"590cbb16-29de-4a8a-9f5b-a4c35eb74bff","name":"error.code","value":"MISSING_QUERY","type":"string"},{"id":"c35b922c-4321-400d-91e6-1b45b6e469d4","name":"error.message","value":"No se proporcionó una consulta válida. El campo 'q' es obligatorio y debe contener texto.","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-336,-160],"id":"870081a4-561a-423d-bde0-28f4883fb586","name":"Error"},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[368,-464],"id":"9919e239-7bcd-4290-807d-0cb11b6a5962","name":"Aggregate"},{"parameters":{"promptType":"define","text":"=SQL: {{ $json.data[1].text }}\nmessage: {{ $json.data[0].message }} \ndescription: {{ $json.data[0].error.description }}","messages":{"messageValues":[{"message":"Eres un agente de IA especializado en transformar preguntas de usuarios en consultas SQL válidas y ejecutables. Tu única función es devolver **exclusivamente la consulta SQL**, sin ningún texto adicional, explicaciones, comentarios, saltos de línea innecesarios o formato markdown (como ```sql o ~~~).\n\nReglas estrictas:\n- Solo devuelve la consulta SQL.\n- No agregues espacios, líneas, ni texto antes ni después.\n- No uses comentarios ni anotaciones.\n- La consulta debe ser 100% compatible con la estructura de la base de datos descrita a continuación.\n\nEstructura de la base de datos:\n\nTablas:\n- offices: officeCode (PK), city, phone, addressLine1, addressLine2, state, country, postalCode, territory\n- employees: employeeNumber (PK), lastName, firstName, extension, email, officeCode (FK → offices.officeCode), reportsTo (FK → employees.employeeNumber), jobTitle\n- customers: customerNumber (PK), customerName, contactLastName, contactFirstName, phone, addressLine1, addressLine2, city, state, postalCode, country, salesRepEmployeeNumber (FK → employees.employeeNumber), creditLimit\n- orders: orderNumber (PK), orderDate, requiredDate, shippedDate, status, comments, customerNumber (FK → customers.customerNumber)\n- orderdetails: orderNumber (PK, FK → orders.orderNumber), productCode (PK, FK → products.productCode), quantityOrdered, priceEach, orderLineNumber\n- products: productCode (PK), productName, productLine (FK → productlines.productLine), productScale, productVendor, productDescription, quantityInStock, buyPrice, MSRP\n- productlines: productLine (PK), textDescription, htmlDescription, image\n- payments: customerNumber (PK, FK → customers.customerNumber), checkNumber (PK), paymentDate, amount\n\nRelaciones clave:\n- employees.officeCode → offices.officeCode\n- employees.reportsTo → employees.employeeNumber\n- customers.salesRepEmployeeNumber → employees.employeeNumber\n- orders.customerNumber → customers.customerNumber\n- payments.customerNumber → customers.customerNumber\n- orderdetails.orderNumber → orders.orderNumber\n- orderdetails.productCode → products.productCode\n- products.productLine → productlines.productLine\n\nEjemplo:\nPregunta del usuario: \"¿Cuántas oficinas existen?\"\nRespuesta correcta: SELECT count(*) FROM offices\n\nNunca respondas con markdown, texto explicativo o comentarios. Solo la consulta SQL pura."}]},"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[384,-16],"id":"9a188bac-9bdf-408a-bda4-e43bd009777b","name":"Basic LLM Chain1"},{"parameters":{"numberInputs":3},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[432,-240],"id":"801845f4-63eb-4913-953f-45bb4868ef1f","name":"Merge"},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[624,-224],"id":"b1d4a16d-d5c6-41c0-b7f1-7b107923d454","name":"Aggregate1"},{"parameters":{"operation":"executeQuery","query":"{{ $json.text }}","options":{}},"type":"n8n-nodes-base.mySql","typeVersion":2.5,"position":[672,-16],"id":"9434606b-f63e-4f78-b86b-fcb93e14f198","name":"Execute a SQL query1","credentials":{"mySql":{"id":"2r6ekNvbokW1jkwV","name":"MySQL account 3"}},"onError":"continueErrorOutput"},{"parameters":{"assignments":{"assignments":[{"id":"bd21f026-59da-4cd8-9222-d1034637b20c","name":"success","value":true,"type":"boolean"},{"id":"590cbb16-29de-4a8a-9f5b-a4c35eb74bff","name":"data","value":"={{ $json.data }}","type":"string"},{"id":"c35b922c-4321-400d-91e6-1b45b6e469d4","name":"q","value":"={{ $('If').item.json.query }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[560,-464],"id":"392c1e05-6cf4-4999-8fcf-a5b020834a88","name":"Success"},{"parameters":{"content":"## Input \n","height":272,"width":352},"type":"n8n-nodes-base.stickyNote","position":[-416,-528],"typeVersion":1,"id":"a58fb4d4-5c0c-4dd5-9884-0370fbc46258","name":"Sticky Note"},{"parameters":{"content":"## Error","height":272,"width":352,"color":3},"type":"n8n-nodes-base.stickyNote","position":[-416,-256],"typeVersion":1,"id":"e0a72b40-fbae-49c7-b2b3-44349ebc7496","name":"Sticky Note1"},{"parameters":{"content":"## Run \n","height":544,"width":368,"color":6},"type":"n8n-nodes-base.stickyNote","position":[-64,-528],"typeVersion":1,"id":"a2e69be3-63b0-4842-9237-24041c1ade66","name":"Sticky Note2"},{"parameters":{"content":"## Output ","height":256,"width":480,"color":4},"type":"n8n-nodes-base.stickyNote","position":[304,-528],"typeVersion":1,"id":"a2366f87-eb36-484c-b2c1-223961376453","name":"Sticky Note3"},{"parameters":{"content":"## Fix ","height":480,"width":528,"color":7},"type":"n8n-nodes-base.stickyNote","position":[304,-272],"typeVersion":1,"id":"2a6dea3f-c42a-4e1b-980a-296ea5b626de","name":"Sticky Note4"}],"connections":{"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"Basic LLM Chain","type":"ai_languageModel","index":0},{"node":"Basic LLM Chain1","type":"ai_languageModel","index":0}]]},"Basic LLM Chain":{"main":[[{"node":"Execute a SQL query","type":"main","index":0},{"node":"Merge","type":"main","index":1}]]},"Execute a SQL query":{"main":[[{"node":"Aggregate","type":"main","index":0}],[{"node":"Merge","type":"main","index":0}]]},"When Executed by Another Workflow":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"Basic LLM Chain","type":"main","index":0}],[{"node":"Error","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Success","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Aggregate1","type":"main","index":0}]]},"Aggregate1":{"main":[[{"node":"Basic LLM Chain1","type":"main","index":0}]]},"Basic LLM Chain1":{"main":[[{"node":"Execute a SQL query1","type":"main","index":0}]]},"Execute a SQL query1":{"main":[[{"node":"Aggregate","type":"main","index":0}],[{"node":"Merge","type":"main","index":2}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"When Executed by Another Workflow":[{"json":{"q":"Muestra los empleados que trabajan en oficinas de EE.UU. y sus clientes asociados."}}]},"versionId":"1e648119-6d2b-412b-b722-287a710ed9db","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-08-24T14:38:26.968Z","updatedAt":"2025-08-24T14:38:26.968Z","role":"workflow:owner","workflowId":"sKFey1dRPZ392E3L","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-24T15:44:11.298Z","updatedAt":"2025-08-24T17:10:11.000Z","id":"VS92EzWkLQKtxmL2","name":"My workflow 22","active":false,"isArchived":false,"nodes":[{"parameters":{"options":{"systemMessage":"=Eres un asistente de atención al cliente de una empresa de modelos a escala de vehículos. Tu función es recibir consultas de clientes, clasificarlas y derivarlas a los subagentes especializados correspondientes. Debes coordinarte con ellos para recopilar información precisa y coherente antes de responder al cliente.\n\nResponde siempre con empatía, claridad y brevedad, usando un lenguaje sencillo y profesional. Asegúrate de que la respuesta final sea correcta, consistente y completa, reflejando la colaboración entre los diferentes subagentes.\nAntes de responder al cliente asegurate de tener toda la informacion encesaria de los diferentes agentes. Siempre que el usuario pida un producto indicale nombre y precio, enc aso de existir mas de uno entregale el listado."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[176,-160],"id":"4f31e43d-4f17-4d2d-aa89-f857e5ac942e","name":"AI Agent"},{"parameters":{"contextWindowLength":15},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[304,208],"id":"df749d7e-530b-4c5f-97c9-f86ff97f8890","name":"Simple Memory"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.3,"position":[-320,0],"id":"e6efa09e-7167-4838-a82f-56538553de71","name":"When chat message received","webhookId":"d5197587-9b97-4e39-b85f-c5cb5c2baaee"},{"parameters":{"assignments":{"assignments":[{"id":"d947af78-6db0-463c-8de5-bfc6d6f1327e","name":"sessionId","value":"={{ $json.sessionId }}","type":"string"},{"id":"af821503-5d34-4f50-b4af-124ebf4347c3","name":"chatInput","value":"={{ $json.chatInput }}","type":"string"},{"id":"85e0d7a3-fefd-4740-8fd1-06112a8d9796","name":"Prompt asistente de ventas","value":"Eres un asistente de ventas virtual para una empresa especializada en modelos a escala de vehículos. Tu rol es asistir a los clientes respondiendo consultas sobre productos, disponibilidad, precios y líneas de productos de manera profesional, amigable y concisa.","type":"string"},{"id":"eaa0266d-fb6a-4e4d-8f16-51ae51d19d41","name":"Prompt soporte al cliente","value":"Eres un asistente de soporte al cliente virtual para una empresa de modelos a escala de vehículos. Tu rol es asistir a los clientes respondiendo consultas sobre pedidos, estados de órdenes, pagos y detalles de clientes de manera profesional, amigable y concisa.","type":"string"},{"id":"b4d9335e-b5e1-41a4-a867-2a62a3def145","name":"Prompt analista de inventarios y operaciones","value":"Eres un analista de inventarios y operaciones para una empresa de modelos a escala de vehículos. Tu rol es responder consultas sobre gestión de inventario, existencias, precios de proveedores y análisis de ventas de manera profesional, amigable y concisa.","type":"string"},{"id":"9dca3e7c-74a3-4762-9dd0-1f747937105f","name":"Prompt RH","value":"Eres un representante de recursos humanos interno para una empresa de modelos a escala de vehículos. Tu rol es responder consultas sobre empleados, estructuras organizativas, roles laborales y ubicaciones de oficinas de manera profesional, amigable y concisa.","type":"string"},{"id":"c71c1766-ade2-4139-81f9-c74d73dda0c1","name":"Prompt consultor de inteligencia de negocios","value":"Eres un consultor de inteligencia de negocios para una empresa de modelos a escala de vehículos. Tu rol es responder consultas sobre métricas comerciales, como rendimiento de ventas, clientes destacados e ingresos por región, de manera profesional, amigable y concisa.","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-112,0],"id":"6fa4fbd4-5b00-4a0f-8841-8ec7c5457e6f","name":"Edit Fields"},{"parameters":{"toolDescription":"Quién es: Un agente especializado en interacciones comerciales directas con clientes potenciales o existentes.\nRol: Asistir en la promoción y selección de productos para maximizar las ventas.\nCuándo consultarlo: Cuando la consulta involucra recomendaciones de productos, detalles de precios o exploración de categorías disponibles.\nTipo de información que puede entregar: Detalles sobre productos (nombres, escalas, proveedores, descripciones), precios (de compra y venta sugeridos), disponibilidad general y sugerencias basadas en preferencias del cliente.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"={{ $json['Prompt asistente de ventas'] }}"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[560,16],"id":"c64665cc-c5c4-4536-b4bf-6487afbe13d6","name":"Asistente de ventas"},{"parameters":{"toolDescription":"Quién es: Un agente enfocado en resolver incidencias y consultas postventa de clientes.\nRol: Proporcionar soporte para mantener la satisfacción del cliente y resolver problemas relacionados con transacciones.\nCuándo consultarlo: Cuando la consulta se refiere a estados de pedidos, pagos o detalles específicos de clientes.\nTipo de información que puede entregar: Estados de órdenes (fechas de envío, requeridas o procesadas), detalles de pagos (montos, fechas), información de clientes (contactos, límites de crédito) y desgloses de pedidos (productos incluidos y costos).","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"={{ $json['Prompt soporte al cliente'] }}"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[1472,64],"id":"ee174774-9a50-4854-a80c-4ecb8dac596e","name":"Soporte al cliente"},{"parameters":{"toolDescription":"Quién es: Un agente orientado a la gestión de personal y estructuras organizativas.\nRol: Facilitar información sobre empleados y dinámicas internas para apoyar la colaboración y el desarrollo.\nCuándo consultarlo: Cuando la consulta aborda estructuras jerárquicas, roles laborales o ubicaciones de equipos.\nTipo de información que puede entregar: Detalles de empleados (nombres, cargos, reportes jerárquicos), ubicaciones de oficinas (ciudades, países) y organigramas generales.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"={{ $json['Prompt RH'] }}"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[352,448],"id":"f967e86e-6e37-4a2f-b03f-c6935896baa8","name":"RH"},{"parameters":{"toolDescription":"Quién es: Un agente experto en análisis estratégico y métricas empresariales.\nRol: Generar insights para informar decisiones basadas en datos.\nCuándo consultarlo: Cuando la consulta requiere análisis de rendimiento, tendencias o métricas agregadas.\nTipo de información que puede entregar: Métricas comerciales (ingresos por región, clientes destacados), análisis de ventas (por empleado o línea de productos) y evaluaciones de rendimiento (como límites de crédito o volúmenes de pedidos).","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"={{ $json['Prompt consultor de inteligencia de negocios'] }}"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[1440,400],"id":"361613ef-0464-49bc-9907-0a3f69ec92cd","name":"Inteligencia de negocio"},{"parameters":{"toolDescription":"Quién es: Un agente dedicado al monitoreo y análisis de recursos operativos internos.\nRol: Evaluar y optimizar la gestión de inventarios y procesos logísticos.\nCuándo consultarlo: Cuando la consulta implica verificación de existencias, análisis de suministros o evaluaciones operativas.\nTipo de información que puede entregar: Niveles de stock (cantidades disponibles), precios de adquisición de proveedores, tendencias de ventas por producto o categoría y alertas sobre escasez o excedentes.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"={{ $json['Prompt analista de inventarios y operaciones'] }}"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[1104,80],"id":"d299a44b-d78d-4e90-a0c1-adc3fc177a11","name":"Inventario y operaciones"},{"parameters":{"description":"{\n  \"description\": {\n    \"what_it_does\": {\n      \"functionality\": \"The tool transforms natural language queries (e.g., 'Show employees working in U.S. offices and their associated clients') into executable SQL queries against a predefined relational database with tables such as offices, employees, customers, orders, and products. It receives a text input via the 'q' field and outputs a JSON object containing: 'success' (boolean indicating query success), 'data' (query results if successful), 'q' (original query), and 'error' (code and message, e.g., 'MISSING_QUERY' for invalid input). It uses AI to generate accurate SQL, executes it on a MySQL database, and handles errors with automatic correction attempts.\",\n      \"input\": \"A natural language query in the 'q' field.\",\n      \"output\": \"A JSON object with 'success' (boolean), 'data' (query results), 'q' (original query), and 'error' (code and message if failed).\"\n    },\n    \"how_to_use\": {\n      \"usage\": \"Provide a clear natural language query related to the database structure (e.g., about employees, customers, or sales) via the 'q' field. The tool automatically processes the query, generates and executes the corresponding SQL, and returns results or an error message. No SQL knowledge is required, but the database must be accessible and properly configured. Results can be integrated into external systems like user interfaces, chatbots, or applications.\"\n    },\n    \"when_to_use\": {\n      \"use_cases\": \"Ideal for enabling non-technical users (e.g., sales, support, or management teams) to query data intuitively using natural language, automating data retrieval for reports or quick analyses, and integrating with systems like chatbots or customer portals for dynamic data access. It reduces errors in SQL query generation using AI. Not suitable for queries unrelated to the database structure or for operations modifying data (e.g., insertions or updates), as it is designed solely for read-only queries.\"\n    }\n  }\n}","workflowId":{"__rl":true,"value":"sKFey1dRPZ392E3L","mode":"list","cachedResultName":"SQL_tool"},"workflowInputs":{"mappingMode":"defineBelow","value":{"q":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('q', ``, 'string') }}"},"matchingColumns":["q"],"schema":[{"id":"q","displayName":"q","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[816,496],"id":"99038596-45c7-4467-976e-2a8566096292","name":"SQL_tool"}],"connections":{"Simple Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0},{"node":"Asistente de ventas","type":"ai_memory","index":0},{"node":"Soporte al cliente","type":"ai_memory","index":0}]]},"When chat message received":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Asistente de ventas":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0},{"node":"Inventario y operaciones","type":"ai_tool","index":0}]]},"Soporte al cliente":{"ai_tool":[[]]},"RH":{"ai_tool":[[]]},"Inteligencia de negocio":{"ai_tool":[[]]},"Inventario y operaciones":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0},{"node":"Asistente de ventas","type":"ai_tool","index":0}]]},"SQL_tool":{"ai_tool":[[{"node":"Inventario y operaciones","type":"ai_tool","index":0},{"node":"Asistente de ventas","type":"ai_tool","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"3ad59723-d0df-4666-a826-37791ea2872c","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-08-24T15:44:11.336Z","updatedAt":"2025-08-24T15:44:11.336Z","role":"workflow:owner","workflowId":"VS92EzWkLQKtxmL2","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-24T17:16:40.831Z","updatedAt":"2025-08-26T00:08:07.000Z","id":"83yxi8Ibs2HCaL5x","name":"System","active":true,"isArchived":false,"nodes":[{"parameters":{"promptType":"define","text":"=User:{{ $json.chatInput }}\n{{ $json.data && $json.data.length > 0 ? 'Files:' + JSON.stringify($json.data) : '' }}","options":{"systemMessage":"Eres un experto en SQL y en el uso de la terminal del sistema.\nTu objetivo es gestionar operaciones CRUD sobre tablas y datos de una base de datos, así como manipular archivos, directorios y otros recursos, utilizando únicamente las herramientas disponibles para construir un sistema funcional.\n\nReglas Fundamentales (de cumplimiento obligatorio):\n\nNunca inventes ni supongas resultados.\n\nSi necesitas el contenido de un archivo o el resultado de una consulta, debes ejecutar la herramienta correspondiente para obtenerlo.\n\nSi el usuario pide confirmar un cambio, debes volver a leer o consultar el recurso real con una herramienta y mostrar el resultado exacto.\n\nLa verdad proviene solo de las herramientas.\n\nNo describas, resumas o alteres resultados que no provengan de la ejecución real de una herramienta.\n\nSi no tienes datos aún, responde: “No tengo esta información porque todavía no se ejecutó la herramienta correspondiente”.\n\nUso estricto de herramientas.\n\nCada herramienta tiene un modo de uso específico: síguelo al pie de la letra.\n\nLos errores nunca son de la herramienta, sino del agente que la usa incorrectamente. Si algo falla, corrige tu uso y vuelve a intentarlo.\n\nVerificación obligatoria.\n\nDespués de cada modificación (archivo, tabla, directorio, etc.), debes ejecutar nuevamente una herramienta de lectura, listado o consulta para confirmar que el cambio se aplicó correctamente.\n\nLimita tu actividad con archivos y comandos al directorio D:\\xampp\\htdocs\\demo y sus subdirectorios.\n\nNunca confirmes un resultado sin comprobarlo en la práctica.\n\nProhibido delegar al usuario.\n\nEl usuario no es tu asistente ni empleado, es tu jefe.\n\nNo debes pedir al usuario que ejecute comandos, que busque información, que edite archivos ni que valide resultados.\n\nTú eres el responsable de realizar todas las operaciones necesarias usando las herramientas disponibles.\n\nTransparencia y paso a paso.\n\nExplica siempre qué herramienta usarás y por qué antes de ejecutarla.\n\nMuestra la salida real obtenida de forma literal y explícita, sin alteraciones."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[-1024,-800],"id":"74136add-fb9a-42e7-a8d5-bc990c26f971","name":"AI Agent"},{"parameters":{"description":"=Esta herramienta permite realizar consultas SQL directamente a la DB.\nLas consultas deben ser claras, detallar que accion se debe realizar de CRUD (crear, leer, actualizar o eliminar) y sobre que tabla o elemento. Igualmente en el caso de relaciones se debe detallar lo mas que se pueda la accion para que el resultado sea optimo.\nNo debes utilizar Markdown ni agregar ningun tipo de dato extra ya que estas consultas seran ejecutadas directaemnte en la DB y deben recibir en la entrada unicamente un comando SQL valido.\nEn casod e existir un error la herramienta lo notificara para que puedas corregir tu consulta y reintentar.","workflowId":{"__rl":true,"value":"VcTupcJn8HintGo1","mode":"list","cachedResultName":"SQL_tool copy"},"workflowInputs":{"mappingMode":"defineBelow","value":{"q":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('q', ``, 'string') }}"},"matchingColumns":["q"],"schema":[{"id":"q","displayName":"q","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-640,-736],"id":"00ab1592-2f75-45db-b7b1-333249207e77","name":"SQL_tool"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $json.sessionId }}","contextWindowLength":50},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[-912,-624],"id":"32fbe808-a00c-4866-ae13-865a50a09faa","name":"Simple Memory"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f36576d5-5e4a-4224-b22a-9992eed439d6","leftValue":"={{ $json.files }}","rightValue":"","operator":{"type":"array","operation":"notExists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1248,-768],"id":"83385580-92cc-4ee3-9e7e-4402b25c146b","name":"If"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-1040,-288],"id":"ec356bd5-e65e-44e6-b86d-770acd0f4398","name":"Loop Over Items"},{"parameters":{"resource":"file","inputType":"binary","binaryPropertyName":"=data{{ $runIndex }}"},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[-896,-208],"id":"29984f4a-2e5b-46d1-a2cd-4f1c2663e98e","name":"Upload a file","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"assignments":{"assignments":[{"id":"58082e8b-2fd1-4c1b-abce-7f2c6e029c0a","name":"file.fileName","value":"={{ $('If').item.json.files[0].fileName }}","type":"string"},{"id":"f8c8f7fb-a244-4ad1-b06f-2395a14efb37","name":"file.fileUri","value":"={{ $json.fileUri }}","type":"string"},{"id":"84e857a4-67c8-445e-b458-91197ac2ca67","name":"file.mimeType","value":"={{ $json.mimeType }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-608,-208],"id":"ecb223c4-db7a-470d-89eb-8abd3607ff33","name":"Edit Fields"},{"parameters":{"fieldToSplitOut":"files","include":"allOtherFields","options":{"includeBinary":true}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-1232,-288],"id":"c59642f9-0c89-41d6-9ae7-65740fe90f60","name":"Split Out"},{"parameters":{"aggregate":"aggregateAllItemData","include":"allFieldsExcept","fieldsToExclude":"sessionId, chatInput","options":{"includeBinaries":false}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-768,-304],"id":"eac8e608-25ba-4bfe-ae70-ea9ebecdd075","name":"Aggregate"},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[-432,-416],"id":"5044c141-53fd-4423-9ded-4e7b189c5daf","name":"Merge"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"780376a7-b7d6-49d3-b2af-1698ce4260e9","leftValue":"={{ $runIndex === 0 }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-448,-208],"id":"ddd83384-e612-41cf-8a14-25285477b51f","name":"If1"},{"parameters":{"assignments":{"assignments":[{"id":"0ed2b786-64ba-4033-95b6-c2976f098b9e","name":"file","value":"={{ $json.file }}","type":"object"},{"id":"880eb63d-e715-42de-91ec-8adbb4263cff","name":"sessionId","value":"={{ $('Split Out').item.json.sessionId }}","type":"string"},{"id":"da655b2d-0772-4d76-8f45-bd82727f209d","name":"chatInput","value":"={{ $('Split Out').item.json.chatInput }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-272,-224],"id":"71bf45e8-8eb5-4f3e-a252-90209768388a","name":"Edit Fields1"},{"parameters":{"assignments":{"assignments":[{"id":"aa1da8ab-add6-44ee-8f76-e485e69b2cf1","name":"data","value":"={{ $json.data[1].data }}","type":"string"},{"id":"a0190ca6-46d2-4c98-97e1-444779ef7490","name":"sessionId","value":"={{ $json.data?.[0]?.sessionId ?? $json.sessionId }}","type":"string"},{"id":"3a073510-0b83-495b-80d8-45917efb70f1","name":"chatInput","value":"={{ $json.data?.[0]?.chatInput ?? $json.chatInput }}\n","type":"string"}]},"options":{"ignoreConversionErrors":true}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-96,-416],"id":"4f393c24-5af4-45b1-8f02-40b9fc1fdd70","name":"Edit Fields2"},{"parameters":{"aggregate":"aggregateAllItemData","include":"specifiedFields","fieldsToInclude":"sessionId, chatInput","options":{"includeBinaries":false}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-880,-432],"id":"678412c7-834e-4494-93bf-2b013d4aff4e","name":"Aggregate1"},{"parameters":{"assignments":{"assignments":[{"id":"b39a8103-eda6-4cf7-9b92-039d84f65eb9","name":"sessionId","value":"={{ $json.data[0].sessionId }}","type":"string"},{"id":"020bda7e-afb0-4947-b5b7-f1776fec4680","name":"chatInput","value":"={{ $json.data[0].chatInput }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-640,-432],"id":"2775fd7c-b8ef-4ebf-84a3-027bf10dae83","name":"Edit Fields3"},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-256,-416],"id":"2c56ad34-8632-4496-bb4a-fb7d67b95378","name":"Aggregate2"},{"parameters":{"description":"=Esta herramienta permite ejecutar comandos desde la terminal del sistema Windows.\nLos coandos deben ser claros, y validos para que el resultado sea optimo y unicamente puedes trabajar dentro del directorio D:\\xampp\\htdocs\\demo y sus subdirectorios.\nNo debes utilizar Markdown ni agregar ningun tipo de dato extra ya que estos comandos seran ejecutadas directaemnte en la terminal y deben recibir en la entrada unicamente un comando valido.\nEn caso de existir un error la herramienta lo notificara para que puedas corregir tu consulta y reintentar.\nPrioriza la optimizacion de uso de esta herrameinta ejecutando multiples comandos en una sola iteracion para evitar problemas de saturacion.","workflowId":{"__rl":true,"value":"wsV3kV0s3PEawgfC","mode":"list","cachedResultName":"Run command"},"workflowInputs":{"mappingMode":"defineBelow","value":{"command":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('command', `Comandos a ejecutar.`, 'string') }}"},"matchingColumns":["command"],"schema":[{"id":"command","displayName":"command","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-192,-736],"id":"cb249cd9-b4a4-4d80-991e-04b78a4379e7","name":"Command_tool"},{"parameters":{"toolDescription":"Esta herramienta permite hacer consultas curl a url's para obtener su contenido es obligatorio su uso para verificar que el sitio publicado no contiene errores","url":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', `Url a la que queires hacer una peticion get para obtener y leer su contenido.`, 'string') }}","options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-496,-736],"id":"4e31bc36-1e0b-4f61-acb0-3a3767ab67e0","name":"HTTP Request"},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"models/gemma-3-27b-it","mode":"list","cachedResultName":"models/gemma-3-27b-it"},"text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Text_Input', `Instrucción de que se debe hacer con la imagen (transcribir, describir, etc)`, 'string') }}","imageUrls":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL_s_', ``, 'string') }}","options":{}},"type":"@n8n/n8n-nodes-langchain.googleGeminiTool","typeVersion":1,"position":[-352,-736],"id":"5e3d6192-f79a-4d41-98d3-cf7db8a5171e","name":"Analyze image","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"modelName":"models/gemini-2.5-pro","options":{"temperature":0.1}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-1024,-624],"id":"62577a18-59a9-4da5-829a-be5bb0d00a25","name":"Gemini","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"resource":"document","modelId":{"__rl":true,"value":"models/gemma-3-27b-it","mode":"list","cachedResultName":"models/gemma-3-27b-it"},"text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Text_Input', `Instrucción de que se debe hacer con el documento (transcribir, resumir, etc)`, 'string') }}","documentUrls":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL_s_', ``, 'string') }}","options":{}},"type":"@n8n/n8n-nodes-langchain.googleGeminiTool","typeVersion":1,"position":[-16,-736],"id":"20dc8e84-7419-484e-94b9-0d29ceee6dcb","name":"Analyze document","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"content":"## Input ","height":368,"width":384},"type":"n8n-nodes-base.stickyNote","position":[-1472,-880],"typeVersion":1,"id":"b16c2f80-a29d-4618-8dca-b26bdaf8d8f7","name":"Sticky Note"},{"parameters":{"content":"## Upload file","height":480,"width":1616,"color":5},"type":"n8n-nodes-base.stickyNote","position":[-1472,-512],"typeVersion":1,"id":"41ee35a2-24eb-4fee-bbf7-154188082996","name":"Sticky Note1"},{"parameters":{"content":"## AI Agent","height":368,"width":1232,"color":6},"type":"n8n-nodes-base.stickyNote","position":[-1088,-880],"typeVersion":1,"id":"225ae610-b7f0-445b-8009-0814900afae6","name":"Sticky Note2"},{"parameters":{"public":true,"initialMessages":"","options":{"allowFileUploads":true}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.3,"position":[-1424,-768],"id":"a35b4ecd-3b18-4c01-96a1-33474cb923dc","name":"When chat message received","webhookId":"89fb10ff-8db8-4c67-91e7-a0e263cd4328"}],"connections":{"SQL_tool":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"If":{"main":[[{"node":"AI Agent","type":"main","index":0}],[{"node":"Split Out","type":"main","index":0}]]},"Loop Over Items":{"main":[[{"node":"Aggregate","type":"main","index":0},{"node":"Aggregate1","type":"main","index":0}],[{"node":"Upload a file","type":"main","index":0}]]},"Upload a file":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"If1","type":"main","index":0}]]},"Split Out":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Aggregate2","type":"main","index":0}]]},"If1":{"main":[[{"node":"Edit Fields1","type":"main","index":0}],[{"node":"Loop Over Items","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Edit Fields2":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Aggregate1":{"main":[[{"node":"Edit Fields3","type":"main","index":0}]]},"Edit Fields3":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Aggregate2":{"main":[[{"node":"Edit Fields2","type":"main","index":0}]]},"Command_tool":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"HTTP Request":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Analyze image":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Gemini":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Analyze document":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"When chat message received":{"main":[[{"node":"If","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"98648d23-36ca-4a2b-b9c2-fa7348e0ed5a","triggerCount":1,"tags":[],"shared":[{"createdAt":"2025-08-24T17:16:40.848Z","updatedAt":"2025-08-24T17:16:40.848Z","role":"workflow:owner","workflowId":"83yxi8Ibs2HCaL5x","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-24T17:27:17.989Z","updatedAt":"2025-08-25T14:09:29.000Z","id":"VcTupcJn8HintGo1","name":"SQL_tool copy","active":false,"isArchived":false,"nodes":[{"parameters":{"operation":"executeQuery","query":"{{ $json.q }}","options":{}},"type":"n8n-nodes-base.mySql","typeVersion":2.5,"position":[64,-432],"id":"5462d29f-1b51-4072-9e91-2f67c569effc","name":"Execute a SQL query","credentials":{"mySql":{"id":"5WN2RKSM234W4gAL","name":"MySQL account 2"}},"onError":"continueErrorOutput"},{"parameters":{"workflowInputs":{"values":[{"name":"q"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-384,-416],"id":"da378abb-67e3-4133-abb3-a731d67ef67d","name":"When Executed by Another Workflow"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"d53b2ad8-1353-4344-888e-4e7fa09e3a58","leftValue":"={{ $json.q }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}},{"id":"b12d0c94-986d-4b8b-9f8f-9260e9e31131","leftValue":"={{ $json.q }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-192,-416],"id":"c22a4b5d-7bd0-44dc-993b-1ecad402ea69","name":"If"},{"parameters":{"assignments":{"assignments":[{"id":"bd21f026-59da-4cd8-9222-d1034637b20c","name":"success","value":false,"type":"boolean"},{"id":"590cbb16-29de-4a8a-9f5b-a4c35eb74bff","name":"error.code","value":"MISSING_QUERY","type":"string"},{"id":"c35b922c-4321-400d-91e6-1b45b6e469d4","name":"error.message","value":"No se proporcionó una consulta válida. El campo 'q' es obligatorio y debe contener texto.","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-336,-160],"id":"d5e0cf9f-cfea-4aec-8647-7f81e997af76","name":"Error"},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[368,-448],"id":"41a4e658-bcd8-4cab-b0d3-fe5a5f546c4e","name":"Aggregate"},{"parameters":{"assignments":{"assignments":[{"id":"bd21f026-59da-4cd8-9222-d1034637b20c","name":"success","value":true,"type":"boolean"},{"id":"590cbb16-29de-4a8a-9f5b-a4c35eb74bff","name":"data","value":"={{ $json.data }}","type":"string"},{"id":"c35b922c-4321-400d-91e6-1b45b6e469d4","name":"q","value":"={{ $('If').item.json.query }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[560,-448],"id":"6afff4d5-71f9-4b5f-82e7-7abe7b765b21","name":"Success"},{"parameters":{"content":"## Input \n","height":272,"width":352},"type":"n8n-nodes-base.stickyNote","position":[-416,-528],"typeVersion":1,"id":"ea526fca-d307-433c-b43d-eb93913c8a4d","name":"Sticky Note"},{"parameters":{"content":"## Error","height":272,"width":720,"color":3},"type":"n8n-nodes-base.stickyNote","position":[-416,-256],"typeVersion":1,"id":"d30c0d09-55a6-433d-8053-54211c777068","name":"Sticky Note1"},{"parameters":{"content":"## Run \n","height":272,"width":368,"color":6},"type":"n8n-nodes-base.stickyNote","position":[-64,-528],"typeVersion":1,"id":"156d6321-12be-4987-8b70-3dd308ad77a0","name":"Sticky Note2"},{"parameters":{"content":"## Output ","height":272,"width":480,"color":4},"type":"n8n-nodes-base.stickyNote","position":[304,-528],"typeVersion":1,"id":"6b73569d-e637-4036-b045-d75b1831c2f3","name":"Sticky Note3"},{"parameters":{"assignments":{"assignments":[{"id":"bd21f026-59da-4cd8-9222-d1034637b20c","name":"success","value":false,"type":"boolean"},{"id":"590cbb16-29de-4a8a-9f5b-a4c35eb74bff","name":"error.code","value":"={{ $json.error.description }}","type":"string"},{"id":"c35b922c-4321-400d-91e6-1b45b6e469d4","name":"error.message","value":"={{ $json.message }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[64,-144],"id":"5c3b777f-634d-4942-a976-530269f3b42f","name":"Error1"}],"connections":{"Execute a SQL query":{"main":[[{"node":"Aggregate","type":"main","index":0}],[{"node":"Error1","type":"main","index":0}]]},"When Executed by Another Workflow":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"Execute a SQL query","type":"main","index":0}],[{"node":"Error","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Success","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"When Executed by Another Workflow":[{"json":{"q":"SELECT * FROM projects;"}}]},"versionId":"5ebbe3c5-c230-49d0-b37d-5dfeb6961655","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-08-24T17:27:18.252Z","updatedAt":"2025-08-24T17:27:18.252Z","role":"workflow:owner","workflowId":"VcTupcJn8HintGo1","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-24T22:17:14.795Z","updatedAt":"2025-08-24T23:54:17.000Z","id":"wsV3kV0s3PEawgfC","name":"Run command","active":false,"isArchived":false,"nodes":[{"parameters":{"workflowInputs":{"values":[{"name":"command"}]}},"id":"c055762a-8fe7-4141-a639-df2372f30060","typeVersion":1.1,"name":"When Executed by Another Workflow","type":"n8n-nodes-base.executeWorkflowTrigger","position":[272,352]},{"parameters":{"command":"={{ $json.command }}"},"type":"n8n-nodes-base.executeCommand","typeVersion":1,"position":[480,352],"id":"0b8d43ec-c70f-49a2-8b3b-0702eb362441","name":"Execute Command","onError":"continueErrorOutput"},{"parameters":{"assignments":{"assignments":[{"id":"30b6afd4-d8fd-4720-baff-10f43ebc7d11","name":"command","value":"={{ $json.command }}","type":"string"},{"id":"af196b43-054c-4010-895d-4dad061b68db","name":"error","value":"={{ $json.error }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[720,368],"id":"60f5b5b7-9824-4185-b786-253fe2ad48a8","name":"Error"},{"parameters":{"assignments":{"assignments":[{"id":"6e32c6ad-5732-46cf-bef0-32d63caf9967","name":"response","value":"={{ $json.stdout }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[720,224],"id":"6589344d-bf8d-45ff-82cd-125a5443c7a2","name":"Edit Fields"}],"connections":{"When Executed by Another Workflow":{"main":[[{"node":"Execute Command","type":"main","index":0}]]},"Execute Command":{"main":[[{"node":"Edit Fields","type":"main","index":0}],[{"node":"Error","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{"When Executed by Another Workflow":[{"json":{"command":"dir D:\\xampp\\htdocs\\project"}}]},"versionId":"217451ae-ebfc-4482-8fc8-79a4219635c9","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-08-24T22:17:14.824Z","updatedAt":"2025-08-24T22:17:14.824Z","role":"workflow:owner","workflowId":"wsV3kV0s3PEawgfC","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-28T12:58:36.328Z","updatedAt":"2025-08-28T12:58:36.328Z","id":"Ory7IYQ2szkNdQq6","name":"My workflow 23","active":false,"isArchived":false,"nodes":[{"parameters":{"jsonMode":"expressionData","jsonData":"={{ $('Extract from File').item.json.text }}","options":{"metadata":{"metadataValues":[{"name":"=doc_id","value":"={{ $('Set File Data').item.json.doc_id }}"},{"name":"doc_title","value":"={{ $('Set File Data').item.json.doc_title }}"},{"name":"doc_type","value":"={{ $('Set File Data').item.json.doc_type }}"},{"name":"source","value":"={{ $('Set File Data').item.json.source }}"},{"name":"processed","value":"false"}]}}},"id":"a8d806e7-128e-4f81-8d26-b011ece6395d","name":"Default Data Loader","type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1,"position":[1728,1088]},{"parameters":{"content":"## File Ingestion pipeline","height":672,"width":1751,"color":5},"id":"b8b438f4-8191-4ff0-aafc-85c1041a63df","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[368,832]},{"parameters":{"chunkSize":1500,"chunkOverlap":150,"options":{}},"id":"51aac797-9aae-4b56-931a-c049c632c003","name":"Recursive Character Text Splitter","type":"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter","typeVersion":1,"position":[1808,1296]},{"parameters":{"operation":"delete","tableId":"documents","filterType":"string","filterString":"=metadata->>doc_id=eq.{{ $('On form submission').item.json.File[0].filename }}"},"id":"148f638c-e2a2-4f66-a386-6370cffa022c","name":"Delete Old Doc Rows","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[1152,1152],"alwaysOutputData":true},{"parameters":{"public":true,"options":{}},"id":"4933bd98-fe0a-4234-99d0-2482da9b5dbe","name":"When chat message received","type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[672,352],"webhookId":"f3071b55-8fd9-4aea-ba97-8aeaaa6cf953"},{"parameters":{"mode":"insert","tableName":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"options":{"queryName":"match_documents"}},"id":"52fddec0-a878-43d4-99fa-a9f08029da25","name":"Insert into Supabase Vectorstore","type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1,"position":[1632,864]},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.embeddingsGoogleGemini","typeVersion":1,"position":[1600,1088],"id":"69a3b143-ed39-48ae-8452-a87e974c6f1e","name":"Embeddings Google Gemini1"},{"parameters":{"formTitle":"Archivo","formFields":{"values":[{"fieldLabel":"File","fieldType":"file","multipleFiles":false,"acceptFileTypes":".pdf","requiredField":true}]},"options":{}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[480,1056],"id":"7c3c6327-4bf8-46b9-b28c-82874d897d7b","name":"On form submission","webhookId":"6c4668b3-6d00-4902-ace7-a9155048779a"},{"parameters":{"operation":"pdf","binaryPropertyName":"File","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[704,1056],"id":"b1ee0882-d2fa-4c42-92e7-81e320013a33","name":"Extract from File"},{"parameters":{"batchSize":5,"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[896,1744],"id":"426d397f-9dbb-4a02-8540-45d66a7f153f","name":"Loop Over Items"},{"parameters":{"content":"## Enrichment Pipeline","height":672,"width":1751},"id":"39a7d3c4-b6c5-41f7-bb43-7369b095db36","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[368,1520]},{"parameters":{"operation":"getAll","tableId":"documents","limit":150,"filterType":"string","filterString":"metadata->>processed=not.eq.true"},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[672,1744],"id":"855dfd6b-d07a-4952-b414-3c76a1646ded","name":"Get many rows"},{"parameters":{"operation":"update","tableId":"documents","matchType":"allFilters","filters":{"conditions":[{"keyName":"=id","condition":"eq","keyValue":"={{ $('Edit Fields').item.json.row_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"metadata","fieldValue":"={{ JSON.stringify(\n  (() => {\n    const prev = $item(0).$node[\"Get many rows\"].json.metadata || {};\n    let enriched = {};\n    try {\n      const raw = $('Metadata Obtention').item.json.content?.parts?.[0]?.text || \"{}\";\n      enriched = JSON.parse(raw);\n    } catch(_) {}\n    return {\n      ...prev,\n      ...enriched,\n      processed: true,\n      enricher_version: \"v2-generic-2025-08\",\n      enriched_at: new Date().toISOString(),\n    };\n  })()\n) }}\n"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[1728,1744],"id":"2994f212-9f27-48d6-ba32-2de7898b77de","name":"Update a row"},{"parameters":{"mode":"chooseBranch"},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[1376,1072],"id":"a8f6125c-a1ef-4bd9-aabf-63a0958280b5","name":"Merge"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1920,1744],"id":"439069ff-7128-462b-8629-27cfe2fc33f0","name":"Wait","webhookId":"f99c8e49-43ad-4b63-b788-2c91981647e7"},{"parameters":{"assignments":{"assignments":[{"id":"10646eae-ae46-4327-a4dc-9987c2d76173","name":"doc_id","value":"={{ $('On form submission').item.json.File.filename }}","type":"string"},{"id":"d75d991a-98ce-4070-943d-22e555a074c5","name":"doc_title","value":"={{ $json.info.Title || $json.data.filename }}","type":"string"},{"id":"d7cff574-0e40-4d67-9c88-dacb8e97c45e","name":"doc_type","value":"={{ \"guide\" }}","type":"string"},{"id":"82b5bfb4-f33d-4268-b9d4-8dd3c2f0f097","name":"source","value":"={{ \"uploaded_pdf\" }}","type":"string"}]},"includeOtherFields":true,"options":{}},"id":"af99c4a4-1fcf-4fcf-b420-37a2fca47e8f","name":"Set File Data","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[928,1056]},{"parameters":{"modelId":{"__rl":true,"value":"models/gemma-3-12b-it","mode":"list","cachedResultName":"models/gemma-3-12b-it"},"messages":{"values":[{"content":"=You are a metadata enricher for arbitrary business documents (guides, manuals, best practices, policies, FAQs, playbooks).\n\nTASK\nAnalyze the provided TEXT CHUNK and return a SINGLE-LINE, MINIFIED JSON object (no backticks, no prose). Use ONLY what is explicitly present or safely implied by the chunk. If a field does not apply, use null or [] accordingly.\n\nINPUTS\n- chunk_text: {{ $json.content }}\n- file metadata (for disambiguation only; DO NOT copy values if not present in the chunk):\n  - doc_title: {{ $json.metadata.doc_title }}\n  - doc_type: {{ $json.metadata.doc_type }}\n\nOUTPUT SCHEMA (exact keys; keep values short and consistent):\n{\n  \"topics\": [\"keyword1\",\"keyword2\"],             // up to 8\n  \"feature\": \"short_tag\",                         // e.g., \"workspaces\", \"databases\", \"onboarding\", \"security\"\n  \"use_case\": \"short_tag\",                        // e.g., \"workspace_structure\", \"communication\", \"setup\", \"policy\"\n  \"audience\": \"beginner|intermediate|advanced|null\",\n  \"section\": \"section_or_heading_if_any\",\n  \"entities\": [\"product|role|team|concept\"],      // proper names or domain terms\n  \"key_recommendations\": [\"bullet1\",\"bullet2\"],   // up to 5 concise, actionable bullets\n  \"risks_or_pitfalls\": [\"risk1\",\"risk2\"],         // up to 5; [] if none\n  \"examples_present\": true,                       // whether the chunk includes an example\n  \"language\": \"auto_detected_iso_639_1\",          // e.g., \"en\", \"es\", \"pt\", \"it\"; infer from chunk_text\n  \"chunk_summary\": \"1-2 sentence neutral summary\" // plain, factual, grounded in the chunk\n}\n\nGUIDELINES\n- Prefer concrete nouns/verbs over vague words.\n- Do not invent entities or recommendations; keep them grounded in the text.\n- If multiple candidates exist, choose the most central one (or null).\n- Deduplicate arrays; keep strings on a single line; no trailing punctuation in bullets.\n\nRETURN ONLY THE MINIFIED JSON, ONE LINE.\n"}]},"options":{"maxOutputTokens":512,"temperature":0.1}},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[1376,1744],"id":"81bbca74-f969-474a-88b1-fe380d54301c","name":"Metadata Obtention","retryOnFail":true,"waitBetweenTries":5000,"onError":"continueErrorOutput"},{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":25}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[448,1744],"id":"ab381a43-a081-4898-addd-188cb3f593ad","name":"Schedule Trigger"},{"parameters":{"assignments":{"assignments":[{"id":"ea722112-aad6-419d-b187-f40044bf3b8a","name":"row_id","value":"={{$json.id}}","type":"number"}]},"includeOtherFields":true,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1152,1744],"id":"07c26c41-4751-49c5-b038-7d818e3d19a7","name":"Edit Fields"},{"parameters":{"content":"## RAG Chat Agent","height":800,"width":1744,"color":4},"type":"n8n-nodes-base.stickyNote","position":[368,0],"typeVersion":1,"id":"aef7f24e-720c-4aec-91fd-2ddadc7009bb","name":"Sticky Note5"},{"parameters":{"modelId":{"__rl":true,"value":"models/gemma-3-4b-it","mode":"list","cachedResultName":"models/gemma-3-4b-it"},"messages":{"values":[{"content":"=You are a query builder for a document retrieval system (RAG). \nYour task: analyze the user’s question and output ONE SINGLE-LINE, MINIFIED JSON. No prose.\n\nOUTPUT SCHEMA (always valid JSON, one line):\n{\n  \"keywords\": [\"k1\",\"k2\",\"k3\"],          // up to 6 short terms from the question\n    \"filters\": {                           // OPTIONAL filters; include only if clearly implied, domain specific.\n  }\n\n\nRULES\n- Keep keywords concise; avoid stop-words or full sentences.\n- Only add filters if the intent is clear from the question.\n- If the user just greets or provides no query, return {\"keywords\":[]} with no filters.\n\n\nOUTPUT\n- Output ONLY valid JSON, minified, one single line.\n- Do NOT add ```json, code fences, or any text before/after.\n- Do NOT include newlines.\n\nINPUT\n{{ $json.chatInput }}\n\nNOTE\n- Domain-specific logic (e.g., mapping to product features, principles, policies) can be added here in future.\n"}]},"options":{"maxOutputTokens":128,"temperature":0.1}},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[896,352],"id":"aba28672-7d68-412d-afd3-33c2bf8d2fbb","name":"Query Builder","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"promptType":"define","text":"={{ $('When chat message received').item.json.chatInput }}","options":{"systemMessage":"=You are a friendly but objective RAG assistant. You may only answer using passages returned by the tool \"Supabase Vector Store\". \nIf in this turn you did not call the tool at least once, reply:\n\"I don't have enough evidence in the indexed documents to answer this.\"\n\nLANGUAGE\n- Always answer in the user's language. Detect automatically from the user message.\n\nRECOVERY QUERY\n- Use the JSON line produced by \"Query Builder\". If it contains multiple keywords or filters, pass them to the retrieval tool.\n- If the query is ambiguous, still retrieve with general keywords and let the reranker select the best contexts.\n\nANSWER RULES\n\"\n- Prefer 2–4 distinct passages. If only 1 is available, say evidence is limited. Always form a concrete answer with the passages, not lost sentences.\n- Do NOT import outside knowledge. If relevant passages are weak or missing, say so and suggest a clearer question.\n- If the user's message is just a greeting (e.g., \"hi\"), do NOT call tools. Respond with a short greeting and invite a question.\n\nOUTPUT STYLE\n- Concise, friendly but objective.\n- Add a section below with References, with the format\n  \"Source: <doc_title> — <section>. Use a title for the section and bullets.\n- No hallucinations; everything must be grounded in retrieved text.\n\nFAILSAFE\n- If retrieval returns authors/topics unrelated to the user's intent, ignore them and state that no relevant evidence was found.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[1312,144],"id":"28bd069d-baac-455d-acc0-0be8f198577f","name":"RAG Agent"},{"parameters":{"topN":8},"type":"@n8n/n8n-nodes-langchain.rerankerCohere","typeVersion":1,"position":[1648,576],"id":"b5c22405-56cf-47ce-a332-f99d35e9e631","name":"Reranker"},{"parameters":{"modelName":"models/gemini-2.0-flash","options":{"temperature":0.2}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[1248,368],"id":"e29ecbef-ffb7-403f-a879-47b2c27b8373","name":"Google Gemini 2.0 Flash","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[1376,368],"id":"008c8e4f-53ce-4dda-a5ca-f5572ff9f28f","name":"Postgres Chat Memory"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.embeddingsGoogleGemini","typeVersion":1,"position":[1520,576],"id":"5b60ad98-e6b0-402e-b24a-e0a206321fe4","name":"Embeddings Google Gemini","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"mode":"retrieve-as-tool","toolDescription":"=Semantic retrieval tool. Queries the \"documents\" table and returns passages with metadata.\n\nUsage by the agent:\n- Always use the JSON line produced by the Query Builder to form keywords and (optional) metadata filters.\n- If scope is \"multi_document\", allow results from multiple documents; otherwise bias to a single document if clearly implied.\nOutput: fragments with metadata.doc_title, section (if any), feature, use_case, topics, chunk_summary.\n","tableName":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"topK":48,"useReranker":true,"options":{"metadata":{"metadataValues":[{"name":"doc_type","value":"={{ (() => { try { return (JSON.parse(($('Query Builder').item.json.content?.parts?.[0]?.text || '{}')).filters?.doc_type) } catch(e){ return undefined } })() }}"},{"name":"feature","value":"={{ (() => { try { return (JSON.parse(($('Query Builder').item.json.content?.parts?.[0]?.text || '{}')).filters?.feature) } catch(e){ return undefined } })() }}"},{"name":"use_case","value":"={{ (() => { try { return (JSON.parse(($('Query Builder').item.json.content?.parts?.[0]?.text || '{}')).filters?.use_case) } catch(e){ return undefined } })() }}"},{"name":"topics","value":"={{ (() => { try { const t = JSON.parse(($('Query Builder').item.json.content?.parts?.[0]?.text || '{}')).filters?.topics; return Array.isArray(t) && t.length ? t : undefined } catch(e){ return undefined } })() }}"},{"name":"entities","value":"={{ (() => { try { const t = JSON.parse(($('Query Builder').item.json.content?.parts?.[0]?.text || '{}')).filters?.entities; return Array.isArray(t) && t.length ? t : undefined } catch(e){ return undefined } })() }}"}]}}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[1520,368],"id":"ff35adcf-b3c5-4cd1-9c9e-c34ea08c29e1","name":"Supabase Vector Store"},{"parameters":{"content":"## 🟩 File Ingestion Pipeline\n\nExtracts and chunks uploaded PDFs.\nEmbeds content and stores it in Supabase vector DB.\nClean and modular, ready for other sources (Notion, Drive, etc).","height":256,"width":272},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-16,864],"id":"bfddeb66-3b71-40c1-aa85-c9d214676ff8","name":"Sticky Note"},{"parameters":{"content":"## 🟨 Enrichment Pipeline (Async)\n\nEnriches chunks with semantic metadata using a lightweight LLM.\nImproves retrieval and enables filters like audience, use_case, risks.\nRuns asynchronously to reduce cost — ideal for free-tier models.","height":256,"width":272},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,1536],"id":"8b11ddaf-e5ed-4e4b-9455-2c007506d1c0","name":"Sticky Note2"},{"parameters":{"content":"## 🟦 RAG Agent Pipeline\n\nHandles user questions with memory, filtering, reranking, and references.\nPowered by a Query Builder + Cohere Reranker + Gemini LLM.\nAnswers only with retrieved content — safe, explainable, production-grade.","height":288,"width":272},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0],"id":"84da3555-5bb8-4579-877d-fdea018c5d92","name":"Sticky Note4"}],"connections":{"Default Data Loader":{"ai_document":[[{"node":"Insert into Supabase Vectorstore","type":"ai_document","index":0}]]},"Recursive Character Text Splitter":{"ai_textSplitter":[[{"node":"Default Data Loader","type":"ai_textSplitter","index":0}]]},"Delete Old Doc Rows":{"main":[[{"node":"Merge","type":"main","index":1}]]},"When chat message received":{"main":[[{"node":"Query Builder","type":"main","index":0}]]},"Embeddings Google Gemini1":{"ai_embedding":[[{"node":"Insert into Supabase Vectorstore","type":"ai_embedding","index":0}]]},"On form submission":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"Set File Data","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Edit Fields","type":"main","index":0}]]},"Get many rows":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Update a row":{"main":[[{"node":"Wait","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Insert into Supabase Vectorstore","type":"main","index":0}]]},"Wait":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Set File Data":{"main":[[{"node":"Delete Old Doc Rows","type":"main","index":0},{"node":"Merge","type":"main","index":0}]]},"Metadata Obtention":{"main":[[{"node":"Update a row","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Get many rows","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Metadata Obtention","type":"main","index":0}]]},"Query Builder":{"main":[[]]},"Reranker":{"ai_reranker":[[{"node":"Supabase Vector Store","type":"ai_reranker","index":0}]]},"Google Gemini 2.0 Flash":{"ai_languageModel":[[{"node":"RAG Agent","type":"ai_languageModel","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"RAG Agent","type":"ai_memory","index":0}]]},"Embeddings Google Gemini":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]},"Supabase Vector Store":{"ai_tool":[[{"node":"RAG Agent","type":"ai_tool","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"2e72adf5-06bf-4b60-939e-aee9e361a34f","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-08-28T12:58:36.362Z","updatedAt":"2025-08-28T12:58:36.362Z","role":"workflow:owner","workflowId":"Ory7IYQ2szkNdQq6","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-08-28T12:59:05.997Z","updatedAt":"2025-08-28T13:33:34.000Z","id":"xLLdfjf22nibhC0x","name":"My workflow 23","active":false,"isArchived":false,"nodes":[{"parameters":{"jsonMode":"expressionData","jsonData":"={{ $('Extract from File').item.json.text }}","options":{"metadata":{"metadataValues":[{"name":"=doc_id","value":"={{ $('Set File Data').item.json.doc_id }}"},{"name":"doc_title","value":"={{ $('Set File Data').item.json.doc_title }}"},{"name":"doc_type","value":"={{ $('Set File Data').item.json.doc_type }}"},{"name":"source","value":"={{ $('Set File Data').item.json.source }}"},{"name":"processed","value":"false"}]}}},"id":"a8d806e7-128e-4f81-8d26-b011ece6395d","name":"Default Data Loader","type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1,"position":[1728,1088]},{"parameters":{"content":"## File Ingestion pipeline","height":672,"width":1751,"color":5},"id":"b8b438f4-8191-4ff0-aafc-85c1041a63df","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[368,832]},{"parameters":{"chunkSize":1500,"chunkOverlap":150,"options":{}},"id":"51aac797-9aae-4b56-931a-c049c632c003","name":"Recursive Character Text Splitter","type":"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter","typeVersion":1,"position":[1808,1296]},{"parameters":{"operation":"delete","tableId":"documents","filterType":"string","filterString":"=metadata->>doc_id=eq.{{ $('On form submission').item.json.File[0].filename }}"},"id":"148f638c-e2a2-4f66-a386-6370cffa022c","name":"Delete Old Doc Rows","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[1152,1152],"alwaysOutputData":true},{"parameters":{"public":true,"options":{}},"id":"4933bd98-fe0a-4234-99d0-2482da9b5dbe","name":"When chat message received","type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[672,352],"webhookId":"f3071b55-8fd9-4aea-ba97-8aeaaa6cf953"},{"parameters":{"mode":"insert","tableName":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"options":{"queryName":"match_documents"}},"id":"52fddec0-a878-43d4-99fa-a9f08029da25","name":"Insert into Supabase Vectorstore","type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1,"position":[1632,864]},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.embeddingsGoogleGemini","typeVersion":1,"position":[1600,1088],"id":"69a3b143-ed39-48ae-8452-a87e974c6f1e","name":"Embeddings Google Gemini1","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"formTitle":"Archivo","formFields":{"values":[{"fieldLabel":"File","fieldType":"file","multipleFiles":false,"acceptFileTypes":".pdf","requiredField":true}]},"options":{}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[480,1056],"id":"7c3c6327-4bf8-46b9-b28c-82874d897d7b","name":"On form submission","webhookId":"6c4668b3-6d00-4902-ace7-a9155048779a"},{"parameters":{"operation":"pdf","binaryPropertyName":"File","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[704,1056],"id":"b1ee0882-d2fa-4c42-92e7-81e320013a33","name":"Extract from File"},{"parameters":{"batchSize":5,"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[896,1744],"id":"426d397f-9dbb-4a02-8540-45d66a7f153f","name":"Loop Over Items"},{"parameters":{"content":"## Enrichment Pipeline","height":672,"width":1751},"id":"39a7d3c4-b6c5-41f7-bb43-7369b095db36","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[368,1520]},{"parameters":{"operation":"getAll","tableId":"documents","limit":150,"filterType":"string","filterString":"metadata->>processed=not.eq.true"},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[672,1744],"id":"855dfd6b-d07a-4952-b414-3c76a1646ded","name":"Get many rows"},{"parameters":{"operation":"update","tableId":"documents","matchType":"allFilters","filters":{"conditions":[{"keyName":"=id","condition":"eq","keyValue":"={{ $('Edit Fields').item.json.row_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"metadata","fieldValue":"={{ JSON.stringify(\n  (() => {\n    const prev = $item(0).$node[\"Get many rows\"].json.metadata || {};\n    let enriched = {};\n    try {\n      const raw = $('Metadata Obtention').item.json.content?.parts?.[0]?.text || \"{}\";\n      enriched = JSON.parse(raw);\n    } catch(_) {}\n    return {\n      ...prev,\n      ...enriched,\n      processed: true,\n      enricher_version: \"v2-generic-2025-08\",\n      enriched_at: new Date().toISOString(),\n    };\n  })()\n) }}\n"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[1728,1744],"id":"2994f212-9f27-48d6-ba32-2de7898b77de","name":"Update a row"},{"parameters":{"mode":"chooseBranch"},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[1376,1072],"id":"a8f6125c-a1ef-4bd9-aabf-63a0958280b5","name":"Merge"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1920,1744],"id":"439069ff-7128-462b-8629-27cfe2fc33f0","name":"Wait","webhookId":"f99c8e49-43ad-4b63-b788-2c91981647e7"},{"parameters":{"assignments":{"assignments":[{"id":"10646eae-ae46-4327-a4dc-9987c2d76173","name":"doc_id","value":"={{ $('On form submission').item.json.File.filename }}","type":"string"},{"id":"d75d991a-98ce-4070-943d-22e555a074c5","name":"doc_title","value":"={{ $json.info.Title || $json.data.filename }}","type":"string"},{"id":"d7cff574-0e40-4d67-9c88-dacb8e97c45e","name":"doc_type","value":"={{ \"guide\" }}","type":"string"},{"id":"82b5bfb4-f33d-4268-b9d4-8dd3c2f0f097","name":"source","value":"={{ \"uploaded_pdf\" }}","type":"string"}]},"includeOtherFields":true,"options":{}},"id":"af99c4a4-1fcf-4fcf-b420-37a2fca47e8f","name":"Set File Data","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[928,1056]},{"parameters":{"modelId":{"__rl":true,"value":"models/gemma-3-12b-it","mode":"list","cachedResultName":"models/gemma-3-12b-it"},"messages":{"values":[{"content":"=You are a metadata enricher for arbitrary business documents (guides, manuals, best practices, policies, FAQs, playbooks).\n\nTASK\nAnalyze the provided TEXT CHUNK and return a SINGLE-LINE, MINIFIED JSON object (no backticks, no prose). Use ONLY what is explicitly present or safely implied by the chunk. If a field does not apply, use null or [] accordingly.\n\nINPUTS\n- chunk_text: {{ $json.content }}\n- file metadata (for disambiguation only; DO NOT copy values if not present in the chunk):\n  - doc_title: {{ $json.metadata.doc_title }}\n  - doc_type: {{ $json.metadata.doc_type }}\n\nOUTPUT SCHEMA (exact keys; keep values short and consistent):\n{\n  \"topics\": [\"keyword1\",\"keyword2\"],             // up to 8\n  \"feature\": \"short_tag\",                         // e.g., \"workspaces\", \"databases\", \"onboarding\", \"security\"\n  \"use_case\": \"short_tag\",                        // e.g., \"workspace_structure\", \"communication\", \"setup\", \"policy\"\n  \"audience\": \"beginner|intermediate|advanced|null\",\n  \"section\": \"section_or_heading_if_any\",\n  \"entities\": [\"product|role|team|concept\"],      // proper names or domain terms\n  \"key_recommendations\": [\"bullet1\",\"bullet2\"],   // up to 5 concise, actionable bullets\n  \"risks_or_pitfalls\": [\"risk1\",\"risk2\"],         // up to 5; [] if none\n  \"examples_present\": true,                       // whether the chunk includes an example\n  \"language\": \"auto_detected_iso_639_1\",          // e.g., \"en\", \"es\", \"pt\", \"it\"; infer from chunk_text\n  \"chunk_summary\": \"1-2 sentence neutral summary\" // plain, factual, grounded in the chunk\n}\n\nGUIDELINES\n- Prefer concrete nouns/verbs over vague words.\n- Do not invent entities or recommendations; keep them grounded in the text.\n- If multiple candidates exist, choose the most central one (or null).\n- Deduplicate arrays; keep strings on a single line; no trailing punctuation in bullets.\n\nRETURN ONLY THE MINIFIED JSON, ONE LINE.\n"}]},"options":{"maxOutputTokens":512,"temperature":0.1}},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[1376,1744],"id":"81bbca74-f969-474a-88b1-fe380d54301c","name":"Metadata Obtention","retryOnFail":true,"waitBetweenTries":5000,"credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}},"onError":"continueErrorOutput"},{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":25}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[448,1744],"id":"ab381a43-a081-4898-addd-188cb3f593ad","name":"Schedule Trigger"},{"parameters":{"assignments":{"assignments":[{"id":"ea722112-aad6-419d-b187-f40044bf3b8a","name":"row_id","value":"={{$json.id}}","type":"number"}]},"includeOtherFields":true,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1152,1744],"id":"07c26c41-4751-49c5-b038-7d818e3d19a7","name":"Edit Fields"},{"parameters":{"content":"## RAG Chat Agent","height":800,"width":1744,"color":4},"type":"n8n-nodes-base.stickyNote","position":[368,0],"typeVersion":1,"id":"aef7f24e-720c-4aec-91fd-2ddadc7009bb","name":"Sticky Note5"},{"parameters":{"modelId":{"__rl":true,"value":"=models/gemma-3n-e2b-it","mode":"id"},"messages":{"values":[{"content":"=You are a query builder for a document retrieval system (RAG). \nYour task: analyze the user’s question and output ONE SINGLE-LINE, MINIFIED JSON. No prose.\n\nOUTPUT SCHEMA (always valid JSON, one line):\n{\n  \"keywords\": [\"k1\",\"k2\",\"k3\"],          // up to 6 short terms from the question\n    \"filters\": {                           // OPTIONAL filters; include only if clearly implied, domain specific.\n  }\n\n\nRULES\n- Keep keywords concise; avoid stop-words or full sentences.\n- Only add filters if the intent is clear from the question.\n- If the user just greets or provides no query, return {\"keywords\":[]} with no filters.\n\n\nOUTPUT\n- Output ONLY valid JSON, minified, one single line.\n- Do NOT add ```json, code fences, or any text before/after.\n- Do NOT include newlines.\n\nINPUT\n{{ $json.chatInput }}\n\nNOTE\n- Domain-specific logic (e.g., mapping to product features, principles, policies) can be added here in future.\n"}]},"options":{"maxOutputTokens":128,"temperature":0.1}},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[896,352],"id":"aba28672-7d68-412d-afd3-33c2bf8d2fbb","name":"Query Builder","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"promptType":"define","text":"={{ $('When chat message received').item.json.chatInput }}","options":{"systemMessage":"=You are a friendly but objective RAG assistant. You may only answer using passages returned by the tool \"Supabase Vector Store\". \nIf in this turn you did not call the tool at least once, reply:\n\"I don't have enough evidence in the indexed documents to answer this.\"\n\nLANGUAGE\n- Always answer in the user's language. Detect automatically from the user message.\n\nRECOVERY QUERY\n- Use the JSON line produced by \"Query Builder\". If it contains multiple keywords or filters, pass them to the retrieval tool.\n- If the query is ambiguous, still retrieve with general keywords and let the reranker select the best contexts.\n\nANSWER RULES\n\"\n- Prefer 2–4 distinct passages. If only 1 is available, say evidence is limited. Always form a concrete answer with the passages, not lost sentences.\n- Do NOT import outside knowledge. If relevant passages are weak or missing, say so and suggest a clearer question.\n- If the user's message is just a greeting (e.g., \"hi\"), do NOT call tools. Respond with a short greeting and invite a question.\n\nOUTPUT STYLE\n- Concise, friendly but objective.\n- Add a section below with References, with the format\n  \"Source: <doc_title> — <section>. Use a title for the section and bullets.\n- No hallucinations; everything must be grounded in retrieved text.\n\nFAILSAFE\n- If retrieval returns authors/topics unrelated to the user's intent, ignore them and state that no relevant evidence was found.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[1312,144],"id":"28bd069d-baac-455d-acc0-0be8f198577f","name":"RAG Agent"},{"parameters":{"topN":8},"type":"@n8n/n8n-nodes-langchain.rerankerCohere","typeVersion":1,"position":[1648,576],"id":"b5c22405-56cf-47ce-a332-f99d35e9e631","name":"Reranker"},{"parameters":{"modelName":"models/gemini-2.0-flash","options":{"temperature":0.2}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[1248,368],"id":"e29ecbef-ffb7-403f-a879-47b2c27b8373","name":"Google Gemini 2.0 Flash","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[1376,368],"id":"008c8e4f-53ce-4dda-a5ca-f5572ff9f28f","name":"Postgres Chat Memory"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.embeddingsGoogleGemini","typeVersion":1,"position":[1520,576],"id":"5b60ad98-e6b0-402e-b24a-e0a206321fe4","name":"Embeddings Google Gemini","credentials":{"googlePalmApi":{"id":"YRMp3GqYOBMNJvBe","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"mode":"retrieve-as-tool","toolDescription":"=Semantic retrieval tool. Queries the \"documents\" table and returns passages with metadata.\n\nUsage by the agent:\n- Always use the JSON line produced by the Query Builder to form keywords and (optional) metadata filters.\n- If scope is \"multi_document\", allow results from multiple documents; otherwise bias to a single document if clearly implied.\nOutput: fragments with metadata.doc_title, section (if any), feature, use_case, topics, chunk_summary.\n","tableName":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"topK":48,"useReranker":true,"options":{"metadata":{"metadataValues":[{"name":"doc_type","value":"={{ (() => { try { return (JSON.parse(($('Query Builder').item.json.content?.parts?.[0]?.text || '{}')).filters?.doc_type) } catch(e){ return undefined } })() }}"},{"name":"feature","value":"={{ (() => { try { return (JSON.parse(($('Query Builder').item.json.content?.parts?.[0]?.text || '{}')).filters?.feature) } catch(e){ return undefined } })() }}"},{"name":"use_case","value":"={{ (() => { try { return (JSON.parse(($('Query Builder').item.json.content?.parts?.[0]?.text || '{}')).filters?.use_case) } catch(e){ return undefined } })() }}"},{"name":"topics","value":"={{ (() => { try { const t = JSON.parse(($('Query Builder').item.json.content?.parts?.[0]?.text || '{}')).filters?.topics; return Array.isArray(t) && t.length ? t : undefined } catch(e){ return undefined } })() }}"},{"name":"entities","value":"={{ (() => { try { const t = JSON.parse(($('Query Builder').item.json.content?.parts?.[0]?.text || '{}')).filters?.entities; return Array.isArray(t) && t.length ? t : undefined } catch(e){ return undefined } })() }}"}]}}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[1520,368],"id":"ff35adcf-b3c5-4cd1-9c9e-c34ea08c29e1","name":"Supabase Vector Store","credentials":{"supabaseApi":{"id":"gbJXO6tFvKk1P043","name":"Supabase account"}}},{"parameters":{"content":"## 🟩 File Ingestion Pipeline\n\nExtracts and chunks uploaded PDFs.\nEmbeds content and stores it in Supabase vector DB.\nClean and modular, ready for other sources (Notion, Drive, etc).","height":256,"width":272},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-16,864],"id":"bfddeb66-3b71-40c1-aa85-c9d214676ff8","name":"Sticky Note"},{"parameters":{"content":"## 🟨 Enrichment Pipeline (Async)\n\nEnriches chunks with semantic metadata using a lightweight LLM.\nImproves retrieval and enables filters like audience, use_case, risks.\nRuns asynchronously to reduce cost — ideal for free-tier models.","height":256,"width":272},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,1536],"id":"8b11ddaf-e5ed-4e4b-9455-2c007506d1c0","name":"Sticky Note2"},{"parameters":{"content":"## 🟦 RAG Agent Pipeline\n\nHandles user questions with memory, filtering, reranking, and references.\nPowered by a Query Builder + Cohere Reranker + Gemini LLM.\nAnswers only with retrieved content — safe, explainable, production-grade.","height":288,"width":272},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0],"id":"84da3555-5bb8-4579-877d-fdea018c5d92","name":"Sticky Note4"}],"connections":{"Default Data Loader":{"ai_document":[[{"node":"Insert into Supabase Vectorstore","type":"ai_document","index":0}]]},"Recursive Character Text Splitter":{"ai_textSplitter":[[{"node":"Default Data Loader","type":"ai_textSplitter","index":0}]]},"Delete Old Doc Rows":{"main":[[{"node":"Merge","type":"main","index":1}]]},"When chat message received":{"main":[[{"node":"Query Builder","type":"main","index":0}]]},"Embeddings Google Gemini1":{"ai_embedding":[[{"node":"Insert into Supabase Vectorstore","type":"ai_embedding","index":0}]]},"On form submission":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"Set File Data","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Edit Fields","type":"main","index":0}]]},"Get many rows":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Update a row":{"main":[[{"node":"Wait","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Insert into Supabase Vectorstore","type":"main","index":0}]]},"Wait":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Set File Data":{"main":[[{"node":"Delete Old Doc Rows","type":"main","index":0},{"node":"Merge","type":"main","index":0}]]},"Metadata Obtention":{"main":[[{"node":"Update a row","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Get many rows","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Metadata Obtention","type":"main","index":0}]]},"Query Builder":{"main":[[{"node":"RAG Agent","type":"main","index":0}]]},"Reranker":{"ai_reranker":[[{"node":"Supabase Vector Store","type":"ai_reranker","index":0}]]},"Google Gemini 2.0 Flash":{"ai_languageModel":[[{"node":"RAG Agent","type":"ai_languageModel","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"RAG Agent","type":"ai_memory","index":0}]]},"Embeddings Google Gemini":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]},"Supabase Vector Store":{"ai_tool":[[{"node":"RAG Agent","type":"ai_tool","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"18b560aa-2dfb-407f-93c8-776cc61c6069","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-08-28T12:59:06.023Z","updatedAt":"2025-08-28T12:59:06.023Z","role":"workflow:owner","workflowId":"xLLdfjf22nibhC0x","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-09-01T13:24:00.622Z","updatedAt":"2025-09-01T13:24:00.622Z","id":"fd5b0trz0Yd2bHvJ","name":"My workflow 24","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[0,0],"id":"d2787e0b-80ba-4171-b868-da7a9991598f","name":"When clicking ‘Execute workflow’"},{"parameters":{"url":"https://automations-n8nwithpostgres-4b5f29-93-127-215-152.traefik.me/api/v1/workflows","sendQuery":true,"queryParameters":{"parameters":[{"name":"active","value":"true"},{"name":"projectId","value":"VmwOO9HeTEj20kxM"},{"name":"excludePinnedData","value":"true"},{"name":"limit","value":"100"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"application/json"},{"name":"X-N8N-API-KEY","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIwYmY0NjRjYS04MjEzLTRlOWUtOThlOS02MzgxODI3NDBlZGMiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzU2NzMxNTE3LCJleHAiOjE3NTkyNjk2MDB9.xJC7AEn0l3emVsIk8rGnM48zDqCae3RwVmjZ4A1ZOqQ"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[208,0],"id":"b2df17d5-c09e-4bc0-82bf-1586e45afe3d","name":"HTTP Request"}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"235e78a6-e577-438f-98e6-05ed5b83e71a","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-09-01T13:24:00.645Z","updatedAt":"2025-09-01T13:24:00.645Z","role":"workflow:owner","workflowId":"fd5b0trz0Yd2bHvJ","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-09-01T17:59:47.981Z","updatedAt":"2025-09-01T17:59:47.981Z","id":"0fiQgoJ2JGv4GETb","name":"Workflow 1","active":false,"isArchived":false,"nodes":[{"id":"0f5532f9-36ba-4bef-86c7-30d607400b15","name":"Jira","webhookId":"string","disabled":true,"notesInFlow":true,"notes":"string","type":"n8n-nodes-base.Jira","typeVersion":1,"executeOnce":false,"alwaysOutputData":false,"retryOnFail":false,"maxTries":0,"waitBetweenTries":0,"onError":"stopWorkflow","position":[-100,80],"parameters":{"additionalProperties":{}},"credentials":{"jiraSoftwareCloudApi":{"id":"35","name":"jiraApi"}}}],"connections":{"main":[{"node":"Jira","type":"main","index":0}]},"settings":{"saveExecutionProgress":true,"saveManualExecutions":true,"saveDataErrorExecution":"all","saveDataSuccessExecution":"all","executionTimeout":3600,"errorWorkflow":"VzqKEW0ShTXA5vPj","timezone":"America/New_York","executionOrder":"v1"},"staticData":{"lastId":1},"meta":null,"pinData":null,"versionId":"d1281770-6fae-4462-b413-230eb726ce8d","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-09-01T17:59:48.020Z","updatedAt":"2025-09-01T17:59:48.020Z","role":"workflow:owner","workflowId":"0fiQgoJ2JGv4GETb","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-09-04T05:40:10.004Z","updatedAt":"2025-09-04T05:40:10.004Z","id":"97OTg5POSVpD1HY9","name":"My workflow 25","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[0,0],"id":"02479a01-6664-4349-bd74-5b93ccd95afb","name":"When clicking ‘Execute workflow’"}],"connections":{},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"1a1b06f5-55bf-4f63-9943-5bc3826e9cb2","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-09-04T05:40:10.021Z","updatedAt":"2025-09-04T05:40:10.021Z","role":"workflow:owner","workflowId":"97OTg5POSVpD1HY9","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-09-04T05:51:51.254Z","updatedAt":"2025-09-04T05:51:51.254Z","id":"e1T025s3X1sqSA2m","name":"My workflow 26","active":false,"isArchived":false,"nodes":[{"parameters":{"operation":"authenticate","username":"mauricio.perera@gmail.com","password":"Lupe1717"},"type":"n8n-nodes-rckflr-textembeddings.userManager","typeVersion":1,"position":[208,0],"id":"b054ac0e-a8c7-43e0-b99b-223de84f68e8","name":"User Manager"},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[0,0],"id":"9e879149-407a-411d-ba96-ca48b3d41c3f","name":"When clicking ‘Execute workflow’"}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"User Manager","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"4bba6e1d-1d97-47e5-8bf3-592d3bbfb2a5","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-09-04T05:51:51.283Z","updatedAt":"2025-09-04T05:51:51.283Z","role":"workflow:owner","workflowId":"e1T025s3X1sqSA2m","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-09-26T13:22:55.032Z","updatedAt":"2025-09-26T13:22:55.032Z","id":"f63ca27b2b1448f5","name":"MCP Custom Server Demo","active":false,"isArchived":false,"nodes":[{"parameters":{"path":"mcp-server","enableCors":true,"serverName":"Custom MCP Server","serverVersion":"1.0.0","prompts":{"prompt":[{"name":"status","title":"Check Server Status","description":"Provides a simple status message for MCP clients.","messages":{"message":[{"role":"assistant","content":"Custom MCP server node operativo. Usa argumentos opcionales para incluir notas."}]},"arguments":{"argument":[{"name":"note","description":"Nota opcional que se devolver? junto con el mensaje de estado.","required":false,"defaultValue":"","suggestions":{"suggestion":[{"value":"Testing MCP endpoint"},{"value":"Diagnostics request"}]}}]}}]},"resources":{"resource":[{"uri":"resource://status/overview","name":"status-overview","title":"Status Overview","description":"Descripci?n est?tica del estado actual del servidor MCP.","mimeType":"text/plain","textContent":"Custom MCP server node is operational and ready."}]},"tools":{"tool":[{"name":"echoText","title":"Echo Text","description":"Devuelve exactamente el texto proporcionado.","arguments":{"argument":[{"name":"text","description":"Texto que se devolver? tal cual.","type":"string","required":true,"suggestions":{"suggestion":[{"value":"Hello from MCP"},{"value":"n8n custom node ready"}]}}]},"responseMode":"echo"}]}},"id":"1","name":"MCP Server (Custom)","type":"CUSTOM.mcpServerTrigger","typeVersion":1,"position":[260,300]}],"connections":{},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"4bfa416972ce416a","triggerCount":0,"tags":[],"shared":[{"createdAt":"2025-09-26T13:22:55.032Z","updatedAt":"2025-09-26T13:22:55.032Z","role":"workflow:owner","workflowId":"f63ca27b2b1448f5","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]},{"createdAt":"2025-10-01T13:55:50.751Z","updatedAt":"2025-10-01T13:55:50.751Z","id":"complete-travel-atdf-mcp","name":"Complete Travel Booking via ATDF-MCP","active":false,"isArchived":false,"nodes":[{"parameters":{},"id":"start-trigger-001","name":"When clicking 'Test workflow'","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[240,300]},{"parameters":{"values":{"string":[{"name":"traveler_name","value":"Carlos Mendez"},{"name":"email","value":"carlos.mendez@example.com"},{"name":"departure_city","value":"Madrid"},{"name":"arrival_city","value":"Barcelona"},{"name":"travel_date","value":"2025-12-28T10:00:00"},{"name":"check_in","value":"2025-12-28T15:00:00"},{"name":"check_out","value":"2025-12-30T11:00:00"},{"name":"room_type","value":"suite"}],"number":[{"name":"guests","value":2}]},"options":{}},"id":"set-travel-data-002","name":"Set Travel Data","type":"n8n-nodes-base.set","typeVersion":3.3,"position":[460,300]},{"parameters":{"url":"http://localhost:8001/mcp","options":{"headers":{"Content-Type":"application/json"}},"sendBody":true,"specifyBody":"json","jsonBody":"{\n  \"method\": \"tools/call\",\n  \"params\": {\n    \"name\": \"hotel_reservation\",\n    \"arguments\": {\n      \"guest_name\": \"{{ $json.traveler_name }}\",\n      \"email\": \"{{ $json.email }}\",\n      \"check_in\": \"{{ $json.check_in }}\",\n      \"check_out\": \"{{ $json.check_out }}\",\n      \"room_type\": \"{{ $json.room_type }}\",\n      \"guests\": {{ $json.guests }}\n    }\n  }\n}"},"id":"hotel-reservation-003","name":"Book Hotel","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[680,300]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"hotel_success_condition","leftValue":"={{ $json.result.content[0].text }}","rightValue":"confirmed","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"options":{}},"id":"check-hotel-status-004","name":"Check Hotel Status","type":"n8n-nodes-base.if","typeVersion":2,"position":[900,300]},{"parameters":{"url":"http://localhost:8001/mcp","options":{"headers":{"Content-Type":"application/json"}},"sendBody":true,"specifyBody":"json","jsonBody":"{\n  \"method\": \"tools/call\",\n  \"params\": {\n    \"name\": \"flight_booking\",\n    \"arguments\": {\n      \"passenger_name\": \"{{ $('Set Travel Data').item.json.traveler_name }}\",\n      \"email\": \"{{ $('Set Travel Data').item.json.email }}\",\n      \"departure_city\": \"{{ $('Set Travel Data').item.json.departure_city }}\",\n      \"arrival_city\": \"{{ $('Set Travel Data').item.json.arrival_city }}\",\n      \"departure_date\": \"{{ $('Set Travel Data').item.json.travel_date }}\",\n      \"seat_class\": \"business\"\n    }\n  }\n}"},"id":"flight-booking-005","name":"Book Flight","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1120,200]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"flight_success_condition","leftValue":"={{ $json.result.content[0].text }}","rightValue":"confirmed","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"options":{}},"id":"check-flight-status-006","name":"Check Flight Status","type":"n8n-nodes-base.if","typeVersion":2,"position":[1340,200]},{"parameters":{"message":"🎉 Complete travel booking successful!\n\n✅ Hotel: {{ JSON.parse($('Book Hotel').item.json.result.content[0].text).reservation_id }}\n✈️ Flight: {{ JSON.parse($('Book Flight').item.json.result.content[0].text).booking_id }}\n\nTraveler: {{ $('Set Travel Data').item.json.traveler_name }}\nEmail: {{ $('Set Travel Data').item.json.email }}","options":{}},"id":"complete-success-007","name":"Complete Success Notification","type":"n8n-nodes-base.slack","typeVersion":2.1,"position":[1560,100]},{"parameters":{"message":"❌ Hotel booking failed!\n\nError: {{ $('Book Hotel').item.json.result.content[0].text }}\n\nTravel booking cancelled.","options":{}},"id":"hotel-error-008","name":"Hotel Error Notification","type":"n8n-nodes-base.slack","typeVersion":2.1,"position":[1120,400]},{"parameters":{"message":"❌ Flight booking failed!\n\nHotel was booked successfully but flight failed:\n{{ $('Book Flight').item.json.result.content[0].text }}\n\nPlease book flight manually or cancel hotel reservation.","options":{}},"id":"flight-error-009","name":"Flight Error Notification","type":"n8n-nodes-base.slack","typeVersion":2.1,"position":[1560,300]}],"connections":{"When clicking 'Test workflow'":{"main":[[{"node":"Set Travel Data","type":"main","index":0}]]},"Set Travel Data":{"main":[[{"node":"Book Hotel","type":"main","index":0}]]},"Book Hotel":{"main":[[{"node":"Check Hotel Status","type":"main","index":0}]]},"Check Hotel Status":{"main":[[{"node":"Book Flight","type":"main","index":0}],[{"node":"Hotel Error Notification","type":"main","index":0}]]},"Book Flight":{"main":[[{"node":"Check Flight Status","type":"main","index":0}]]},"Check Flight Status":{"main":[[{"node":"Complete Success Notification","type":"main","index":0}],[{"node":"Flight Error Notification","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true,"instanceId":"local"},"pinData":null,"versionId":"1","triggerCount":0,"tags":[{"createdAt":"2025-10-01T07:35:00.000Z","updatedAt":"2025-10-01T07:35:00.000Z","id":"atdf-integration","name":"ATDF Integration"}],"shared":[{"createdAt":"2025-10-01T13:55:50.768Z","updatedAt":"2025-10-01T13:55:50.768Z","role":"workflow:owner","workflowId":"complete-travel-atdf-mcp","projectId":"cVDyM7zNwAjeZBmc","project":{"createdAt":"2025-06-20T20:24:26.502Z","updatedAt":"2025-06-20T20:34:29.793Z","id":"cVDyM7zNwAjeZBmc","name":"Mauricio Perera <mauricio.perera@gmail.com>","type":"personal","icon":null,"description":null}}]}]